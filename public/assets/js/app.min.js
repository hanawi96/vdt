document.addEventListener("alpine:init",()=>{Alpine.data("shop",()=>({SHIPPING_FEE:21e3,view:"products",isBabyNameModalOpen:!1,babyNameInput:"",babyNameError:"",babyNameProductInfo:{},pendingBabyNameProduct:null,babyNameRequiredProducts:["Thẻ hình rắn khắc tên bé mặt sau","Thẻ 4 lá khắc tên bé (2 mặt)","Thẻ tròn khắc tên bé (2 mặt)"],categories:[{id:"all",name:"Tất cả sản phẩm",isPopular:!0,image:"./assets/images/product_img/tat-ca-mau.jpg"},{id:"vong_tron",name:"Vòng trơn",isPopular:!0,image:"./assets/images/product_img/vong_tron_co_dien_day_do.jpg"},{id:"mix_bi_bac",name:"Mix bi bạc",isPopular:!0,image:"./assets/images/product_img/Sole bac/vong_dau_tam_sole_bac_4ly.jpg"},{id:"mix_charm_ran",name:"Mix charm rắn",isPopular:!0,image:"./assets/images/product_img/charm ran/vong-dau-tam-tron-charm-ran.jpg"},{id:"vong_co_gian",name:"Vòng co giãn",image:"./assets/images/product_img/co gian/vong_tron_co_gian.jpg"},{id:"mix_day_ngu_sac",name:"Mix dây ngũ sắc",image:"./assets/images/product_img/vong-ngu-sac/ngu-sac-mix-1-hat-dau.jpg"},{id:"mix_hat_bo_de",name:"Mix hạt bồ đề",image:"./assets/images/product_img/bo de/vong_dau_tam_sole_9_hat_bo_de.jpg"},{id:"hat_dau_tam_mai_san",name:"Hạt dâu tằm mài sẵn",image:"./assets/images/product_img/hat_dau_tam.jpg"},{id:"mix_charm_chuong",name:"Mix charm chuông",image:"./assets/images/product_img/chuong/vong-tron-charm-chuong.jpg"},{id:"mix_ho_phach",name:"Mix hổ phách",image:"./assets/images/product_img/Sole ho phach/vong-mix-ho-phach.jpg"},{id:"mix_thanh_gia",name:"Mix thánh giá",image:"./assets/images/product_img/thanh-gia/sole-3ly-thanh-gia-co-gian.jpg"},{id:"mix_hoa_sen",name:"Mix hoa sen",image:"./assets/images/product_img/hoa-sen/vong-sole-3ly-hoa-sen.jpg"},{id:"mix_da_do_tu_nhien",name:"Mix đá đỏ tự nhiên",image:"./assets/images/product_img/da do/vong_dau_tam_tron_da_do.jpg"},{id:"mix_chi_mau_cac_loai",name:"Mix chỉ màu các loại",image:"./assets/images/product_img/tat-ca-mau.jpg"},{id:"mix_the_ten_be",name:"Mix thẻ tên bé",image:"./assets/images/product_img/the-ten/vong-tron-mix-the-ten-tron.jpg"},{id:"vong_nguoi_lon",name:"Vòng người lớn",image:"./assets/images/product_img/nguoi-lon/vong-tron-nguoi-lon.jpg"},{id:"san_pham_ban_kem",name:"Sản phẩm bán kèm",image:"./assets/images/product_img/bo-dau-tam-de-phong.jpg"},{id:"bi_charm_bac",name:"Bi, charm bạc",image:"./assets/images/product_img/bi-bac/bi-bac-ta.jpg"}],products:[],shopInfo:{stats:{}},cart:Alpine.$persist([]).as("shoppingCart"),selectedCartItems:Alpine.$persist([]).as("selectedCartItems"),miniCartError:"",activeTab:"combo",addonProducts:[{id:"addon_tui_dau_tam",name:"Túi Dâu Tằm Để Giường",description:"Khúc dâu tằm để phòng, trong túi nhung",price:39e3,original_price:45e3,image:"./assets/images/product_img/tui_dau_tam.jpg",rating:4.9,purchases:456,detailedInfo:{fullDescription:"Túi Dâu Tằm Để Giường cao cấp được làm từ khúc cành dâu tằm tự nhiên, cắt nhỏ và đóng gói trong túi nhung sang trọng. Sản phẩm giúp bé ngủ ngon, giảm stress và tăng cường sức khỏe tự nhiên.",benefits:["🌿 Giúp bé ngủ ngon và sâu giấc","😌 Giảm căng thẳng, lo âu cho bé","🛡️ Tăng cường hệ miễn dịch tự nhiên","🌱 100% từ thiên nhiên, an toàn cho bé","💝 Đóng gói trong túi nhung cao cấp"],usage:"Đặt Túi Dâu Tằm Để Giường gần gối hoặc trong cũi của bé. Có thể bóp nhẹ để tỏa hương thơm tự nhiên. Thay thế sau 3-6 tháng sử dụng.",materials:"Cành dâu tằm tự nhiên, túi nhung cotton cao cấp",origin:"Thôn Đông Cao, Tráng Việt, Hà Nội"}},{id:"addon_moc_chia_khoa",name:"Móc chìa khóa dâu tằm",description:"Móc chìa khóa từ khúc dâu tằm tự nhiên",price:39e3,original_price:49e3,image:"./assets/images/product_img/moc_chia_khoa_dau_tam_ko_hop_kim.jpg",rating:4.8,purchases:912,detailedInfo:{fullDescription:"Móc chìa khóa độc đáo được chế tác từ khúc dâu tằm tự nhiên, mang lại may mắn và bình an. Thiết kế nhỏ gọn, tiện lợi, phù hợp làm quà tặng hoặc vật phẩm phong thủy.",benefits:["🍀 Mang lại may mắn và bình an","🎨 Thiết kế độc đáo, không trùng lặp","🌿 Chất liệu tự nhiên, thân thiện môi trường","💼 Nhỏ gọn, tiện lợi mang theo","🎁 Ý nghĩa làm quà tặng đặc biệt"],usage:"Gắn vào chùm chìa khóa, túi xách hoặc balo. Có thể sử dụng làm vật phẩm trang trí hoặc quà lưu niệm.",materials:"Khúc dâu tằm tự nhiên, dây móc inox không gỉ",origin:"Thôn Đông Cao, Tráng Việt, Hà Nội"}},{id:"addon_bo_dau_tam_7_canh",name:"Bó dâu tằm 7 CÀNH cho bé trai",description:"Bó dâu tằm 7 cành tự nhiên dành riêng cho bé trai",price:89e3,original_price:109e3,image:"./assets/images/product_img/bo-dau-tam-de-phong.jpg",rating:4.7,purchases:0,detailedInfo:{fullDescription:"Bó dâu tằm 7 cành tự nhiên dành riêng cho bé trai, giúp bé ngủ ngon, giảm stress và tăng cường sức khỏe tự nhiên. Số lượng 7 cành mang ý nghĩa may mắn và bình an.",benefits:["🌿 Giúp bé trai ngủ ngon và sâu giấc","😌 Giảm căng thẳng, lo âu cho bé","🛡️ Tăng cường hệ miễn dịch tự nhiên","🌱 100% từ thiên nhiên, an toàn cho bé","🎯 Dành riêng cho bé trai với 7 cành may mắn"],usage:"Đặt bó dâu tằm trong phòng bé hoặc gần giường ngủ. Có thể treo lên tường hoặc đặt trên kệ. Thay thế sau 6-12 tháng sử dụng.",materials:"Cành dâu tằm tự nhiên, dây buộc cotton",origin:"Thôn Đông Cao, Tráng Việt, Hà Nội"}},{id:"addon_bo_dau_tam_9_canh",name:"Bó dâu tằm 9 CÀNH cho bé gái",description:"Bó dâu tằm 9 cành tự nhiên dành riêng cho bé gái",price:99e3,original_price:119e3,image:"./assets/images/product_img/bo-dau-tam-de-phong.jpg",rating:4.8,purchases:0,detailedInfo:{fullDescription:"Bó dâu tằm 9 cành tự nhiên dành riêng cho bé gái, giúp bé ngủ ngon, giảm căng thẳng và mang lại may mắn cho bé yêu. Số lượng 9 cành mang ý nghĩa trọn vẹn và thịnh vượng.",benefits:["🌸 Giúp bé gái ngủ ngon và sâu giấc","😌 Giảm căng thẳng, lo âu cho bé","🛡️ Tăng cường hệ miễn dịch tự nhiên","🌱 100% từ thiên nhiên, an toàn cho bé","💖 Dành riêng cho bé gái với 9 cành may mắn"],usage:"Đặt bó dâu tằm trong phòng bé hoặc gần giường ngủ. Có thể treo lên tường hoặc đặt trên kệ. Thay thế sau 6-12 tháng sử dụng.",materials:"Cành dâu tằm tự nhiên, dây buộc cotton",origin:"Thôn Đông Cao, Tráng Việt, Hà Nội"}}],currentCategory:{id:"all",name:"Tất cả sản phẩm",description:"Những sản phẩm được yêu thích và mua nhiều nhất."},activeFilter:"best_selling",visibleProductCount:8,productsPerLoad:8,loading:!0,error:null,isSubmitting:!1,searchQuery:"",activeSearchQuery:"",isShowingTopSelling:!1,isComboImageModalOpen:!1,isBuyingCombo:!1,currentComboTitle:"",currentComboType:"",currentComboImages:{product1:{image:"",name:"",description:"",benefits:[]},product2:{image:"",name:"",description:"",benefits:[]},originalPrice:0,shippingFee:0,totalWithoutCombo:0,comboPrice:0,savings:0},isImageModalOpen:!1,currentImage:"",isAlertModalOpen:!1,alertModalMessage:"",alertModalType:"success",isSuccessModalOpen:!1,isConfirmModalOpen:!1,lastOrderId:"",isCheckoutModalOpen:!1,isMiniCartOpen:!1,checkoutOpenedFromConfirm:!1,miniCartTimeout:null,isDiscountModalOpen:!1,isCartAnimating:!1,isShowingBestSellers:!1,preventMiniCartCloseOnClickOutside:!1,isItemOptionsModalOpen:!1,currentItemForOptions:null,itemOptions:{quantity:1,note:""},showSizeGuide:!1,isHandSizeModalOpen:!1,currentItemForHandSize:null,handSizeOptions:{quantity:1,note:"",selectedSize:""},showHandSizeGuide:!1,isBeadQuantityModalOpen:!1,currentBeadProduct:null,beadOptions:{quantity:14,note:""},isProcessModalOpen:!1,socialProofViewers:Math.floor(5*Math.random())+1,socialProofInterval:null,quickBuyCopySuccess:!1,checkoutCopySuccess:!1,isQuickBuyModalOpen:!1,isSizingGuideModalOpen:!1,isSizingGuideModalOpen:!1,isSizingGuideModalOpen:!1,quickBuyProduct:null,quickBuyQuantity:1,quickBuyWeight:"",quickBuyCustomWeight:"",quickBuyBabyName:"",quickBuyNotes:"",quickBuyPaymentMethod:"cod",isQuickBuySubmitting:!1,isQuickBuyTransferConfirmed:!1,isCheckoutTransferConfirmed:!1,isCheckoutConfirmTransferModalOpen:!1,isDiscountModalFromQuickBuy:!1,preventQuickBuyCloseOnEscape:!1,quickBuySelectedAddons:[],isFaqModalOpen:!1,faqOpenItems:[],showWeightInQuickBuy:!0,isAdultInQuickBuy:!1,get weightOptions(){const t=["🤱 Chưa sinh"];for(let i=3;i<=15;i+=.5)t.push(`${i}kg`);for(let i=16;i<=19;i+=1)t.push(`${i}kg (+20k)`);return t.push("✏️ Nhập cân nặng > 20kg"),t},get handSizeList(){return["13cm","14cm","15cm","16cm","17cm","18cm","19cm","20cm"]},isAdultProduct:t=>!!t&&("vong_nguoi_lon"===t.category||t.categories&&t.categories.includes("vong_nguoi_lon")),openHandSizeModal(t){this.currentItemForHandSize=t,this.handSizeOptions={quantity:1,note:"",selectedSize:"",customSize:""},this.showHandSizeGuide=!1,this.isHandSizeModalOpen=!0,document.body.style.overflow="hidden"},closeHandSizeModal(){this.isHandSizeModalOpen=!1,this.showHandSizeGuide=!1,this.currentItemForHandSize=null,this.handSizeOptions={quantity:1,note:"",selectedSize:""},document.body.style.overflow=""},selectHandSize(t){this.handSizeOptions.selectedSize=t},addItemWithHandSize(){if(!this.currentItemForHandSize)return;if(!this.handSizeOptions.selectedSize)return void this.showAlert("Vui lòng chọn size tay","error");const{id:t}=this.currentItemForHandSize,i=this.handSizeOptions.selectedSize,e=`${t}-${Date.now()}-${Math.random().toString(36).substring(2,11)}`,s={...this.currentItemForHandSize,cartId:e,quantity:this.handSizeOptions.quantity,note:this.handSizeOptions.note,selectedSize:this.handSizeOptions.selectedSize,handSize:i,weight:i,selectedWeight:this.handSizeOptions.selectedSize,basePrice:this.currentItemForHandSize.price,finalPrice:this.currentItemForHandSize.price,customWeight:"",surcharge:0,hasSurcharge:!1},o=this.currentItemForHandSize.name;console.log("Adding adult product with hand size:",{product:o,selectedSize:this.handSizeOptions.selectedSize,finalSize:i,cartId:e,itemToAdd:s}),this.addToCart(s),this.closeHandSizeModal(),this.isProductDetailOpen&&this.closeProductDetail(),this.showAlert(`Đã thêm ${o} (${i}) vào giỏ hàng!`,"success")},isAddonProduct:t=>!!t&&(!0===t.isAddon||"san_pham_ban_kem"===t.category||"bi_charm_bac"===t.category||t.categories&&t.categories.includes("san_pham_ban_kem")||t.categories&&t.categories.includes("bi_charm_bac")),isBeadProduct:t=>!!t&&("hat_dau_tam_mai_san"===t.category||t.categories&&t.categories.includes("hat_dau_tam_mai_san")),pricingConfig:{standardMaxWeight:15,largeSizeSurcharge:2e4,description:{standard:"Size tiêu chuẩn",large:"Size lớn (phụ thu 20k)"}},get isEngravingProductInQuickBuy(){return this.quickBuyProduct&&this.requiresBabyName(this.quickBuyProduct)},get quickBuySubtotal(){if(!this.quickBuyProduct)return 0;let t=this.quickBuyWeight;"✏️ Nhập cân nặng > 20kg"===this.quickBuyWeight&&this.quickBuyCustomWeight&&(t=this.quickBuyCustomWeight+"kg");return this.calculateDynamicPrice(this.quickBuyProduct,t).finalPrice*this.quickBuyQuantity+this.quickBuySelectedAddons.reduce((t,i)=>t+i.price,0)},get quickBuyAddons(){return this.quickBuySelectedAddons},get filteredAddonProducts(){let t=this.addonProducts;return this.isBuyingCombo&&(t=t.filter(t=>"addon_moc_chia_khoa"===t.id)),console.log("=== DEBUG filteredAddonProducts ==="),console.log("Cart items:",this.cart.map(t=>({id:t.id,cartId:t.cartId,name:t.name}))),console.log("Addon products:",this.addonProducts.map(t=>({id:t.id,name:t.name}))),t=t.filter(t=>{const i=this.cart.some(i=>i.id===t.id||(!(!i.cartId||!i.cartId.startsWith(t.id+"-"))||i.name===t.name));return console.log(`Addon ${t.name} (${t.id}) - In cart: ${i}`),!i}),console.log("Filtered addons:",t.map(t=>({id:t.id,name:t.name}))),console.log("=== END DEBUG ==="),t},get filteredAddonProductsForQuickBuy(){let t=this.addonProducts;return this.isBuyingCombo&&(t=t.filter(t=>"addon_moc_chia_khoa"===t.id)),t=t.filter(t=>!this.quickBuySelectedAddons.some(i=>i.id===t.id)),t},get filteredAddonProductsForProductDetail(){let t=this.addonProducts;return this.isBuyingCombo&&(t=t.filter(t=>"addon_moc_chia_khoa"===t.id)),t=t.filter(t=>!this.productDetailSelectedAddons.some(i=>i.id===t.id)),t},isAddonInCartForDisplay(t){return this.isQuickBuyModalOpen?this.quickBuySelectedAddons.some(i=>i.id===t):this.isProductDetailOpen?this.productDetailSelectedAddons.some(i=>i.id===t):this.cart.some(i=>i.id===t)},get quickBuyAddonDiscount(){return this.quickBuySelectedAddons.some(t=>"addon_moc_chia_khoa"===t.id)?5e3:0},get quickBuyAvailableDiscounts(){return this.availableDiscounts.map(t=>{const i=this._normalizeDiscount(t);if(!i||!i.active)return{...t,availability:{available:!1,reason:"Mã không hợp lệ"}};const e=this.quickBuySubtotal>=i.minOrder&&(!i.minItems||this.quickBuyQuantity>=i.minItems),s=e?"":this.quickBuySubtotal<i.minOrder?`Cần mua thêm ${this.formatCurrency(i.minOrder-this.quickBuySubtotal)}`:`Cần thêm ${i.minItems-this.quickBuyQuantity} sản phẩm`;return{...t,availability:{available:e,reason:s},effectiveValue:e?this.calculateQuickBuyDiscountValue(i):0}})},calculateQuickBuyDiscountValue(t){return"shipping"===t.type?this.SHIPPING_FEE:"fixed"===t.type?Math.min(t.value,this.quickBuySubtotal):"percentage"===t.type?Math.floor(this.quickBuySubtotal*t.value/100):0},get quickBuyFreeShipping(){const t=this.availableDiscounts.find(t=>t.code?.toUpperCase()===this.appliedDiscountCode&&"shipping"===t.type),i=this.quickBuySelectedAddons.some(t=>"addon_tui_dau_tam"===t.id||"addon_bo_dau_tam_7_canh"===t.id||"addon_bo_dau_tam_9_canh"===t.id);return!(!t&&!i)},get quickBuyShippingFee(){return this.quickBuyFreeShipping?0:this.SHIPPING_FEE},get quickBuyShippingDiscount(){return this.quickBuyFreeShipping?this.SHIPPING_FEE:0},get quickBuyTotal(){const t=this.quickBuySubtotal+this.SHIPPING_FEE-this.quickBuyShippingDiscount-(this.quickBuyProduct&&this.quickBuyProduct.freeShipping?this.SHIPPING_FEE:0)-this.discountAmount-this.quickBuyAddonDiscount;return t>0?t:0},isQuickViewOpen:!1,quickViewProduct:null,isProductDetailOpen:!1,sharedDetails:null,productDetailContent:null,currentProductDetail:null,productDetailQuantity:1,productDetailViewers:Math.floor(5*Math.random())+1,productDetailViewersTimer:null,productDetailSelectedAddons:[],isQuickViewOpen:!1,quickViewProduct:null,sharedDetails:{},freeshipOfferEndTime:Alpine.$persist(0).as("freeshipOfferEndTime"),countdownTimer:{interval:null,display:"02 : 00 : 00"},isAddonDetailModalOpen:!1,currentAddonDetail:null,addonDetailOpenedFrom:null,notification:{visible:!1,message:""},socialProofCount:0,availableDiscounts:[],discountCode:Alpine.$persist("").as("discountCode"),appliedDiscountCode:Alpine.$persist("").as("appliedDiscountCode"),appliedGift:Alpine.$persist(null).as("appliedGift"),discountAmount:0,discountError:"",productNotes:Alpine.$persist({}).as("productNotes"),customer:Alpine.$persist({name:"",phone:"",email:"",address:"",notes:""}).as("customerInfo"),paymentMethod:"cod",addressData:[],isAddressLoading:!1,selectedProvince:Alpine.$persist("").as("selectedProvince"),selectedDistrict:Alpine.$persist("").as("selectedDistrict"),selectedWard:Alpine.$persist("").as("selectedWard"),streetAddress:Alpine.$persist("").as("streetAddress"),formErrors:{name:"",phone:"",email:"",province:"",district:"",ward:"",streetAddress:"",paymentMethod:"",weight:"",quickBuyNotes:""},weightErrors:{},_CURRENCY:new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}),async init(){if(await this.loadData(),this.revalidateAppliedDiscount(),this.startNotificationLoop(),this.startFreeshipCountdown(),this.startSocialProofLoop(),console.log("🔄 Calling validateAddressConsistency"),this.validateAddressConsistency(),this.$watch("selectedProvince",t=>{this.selectedDistrict="",this.selectedWard="",t||(this.customer.address="")}),this.$watch("selectedDistrict",t=>{this.selectedWard="",t||(this.customer.address="")}),this.$watch("selectedWard",()=>this.updateFullAddress()),this.$watch("streetAddress",()=>this.updateFullAddress()),this.$watch("cart",t=>{const i=new Set(t.map(t=>t.cartId||t.id));t.forEach(t=>{t.weight&&(this.productNotes[t.id]=t.weight)}),this.selectedCartItems=this.selectedCartItems.filter(t=>i.has(t))},{deep:!0}),this.$watch("customer.name",t=>{t&&t.trim()&&(this.formErrors.name="")}),this.$watch("customer.phone",t=>{if(t&&t.trim()){/(0[3|5|7|8|9])+([0-9]{8})\b/.test(t)&&(this.formErrors.phone="")}}),this.$watch("selectedProvince",t=>{t&&(this.formErrors.province="")}),this.$watch("selectedDistrict",t=>{t&&(this.formErrors.district="")}),this.$watch("selectedWard",t=>{t&&(this.formErrors.ward="")}),this.$watch("streetAddress",t=>{t&&t.trim()&&(this.formErrors.streetAddress="")}),this.$watch("paymentMethod",t=>{console.log("🔍 paymentMethod watcher (form validation) triggered:",t),console.log("🔍 isMiniCartOpen trong form validation watcher:",this.isMiniCartOpen),t&&(this.formErrors.paymentMethod="",this.isCheckoutTransferConfirmed=!1)}),this.$watch("selectedCartItems",()=>{(this.appliedDiscountCode||this.appliedGift||this.discountAmount>0)&&this.revalidateAppliedDiscount()}),this.$watch("quickBuyQuantity",()=>{this.revalidateQuickBuyDiscount()}),this.$watch("quickBuyPaymentMethod",t=>{t&&(this.formErrors.paymentMethod="",this.isQuickBuyTransferConfirmed=!1)}),this.$watch("quickBuyWeight",t=>{t&&"-- Chọn cân nặng --"!==t&&"-- Chọn size tay --"!==t&&(this.formErrors.weight="")}),this.$watch("isMiniCartOpen",(t,i)=>{console.log("🔍 isMiniCartOpen changed:",i,"->",t),console.log("🔍 Tại thời điểm này - isCheckoutModalOpen:",this.isCheckoutModalOpen,"isConfirmModalOpen:",this.isConfirmModalOpen),console.log("🔍 - isAddonDetailModalOpen:",this.isAddonDetailModalOpen),console.log("🔍 - document.body.style.overflow:",document.body.style.overflow),!0===i&&!1===t&&(console.log("🔍 Mini cart vừa đóng, kiểm tra restore overflow..."),this.isCheckoutModalOpen||this.isConfirmModalOpen||this.isAddonDetailModalOpen||this.isQuickBuyModalOpen||this.isProductDetailOpen||this.isDiscountModalOpen?console.log("🔍 Vẫn có modal khác mở, giữ overflow = hidden"):(console.log("🔍 Không có modal nào mở, restore overflow = auto"),document.body.style.overflow="auto")),console.trace("🔍 Stack trace cho isMiniCartOpen change")}),this.$watch("isCheckoutModalOpen",(t,i)=>{console.log("🔍 isCheckoutModalOpen changed:",i,"->",t),console.trace("🔍 Stack trace cho isCheckoutModalOpen change")}),this.$watch("isQuickBuyModalOpen",(t,i)=>{console.log("🔍 isQuickBuyModalOpen changed:",i,"->",t),console.log("🔍 - isProductDetailOpen tại thời điểm này:",this.isProductDetailOpen),console.trace("🔍 Stack trace cho isQuickBuyModalOpen change")}),this.$watch("isProductDetailOpen",(t,i)=>{console.log("🔍 isProductDetailOpen changed:",i,"->",t),console.log("🔍 - isQuickBuyModalOpen tại thời điểm này:",this.isQuickBuyModalOpen),console.trace("🔍 Stack trace cho isProductDetailOpen change")}),this.$watch("isComboImageModalOpen",(t,i)=>{console.log("🔍 isComboImageModalOpen changed:",i,"->",t),console.log("🔍 - isQuickBuyModalOpen tại thời điểm này:",this.isQuickBuyModalOpen),console.log("🔍 - isProductDetailOpen tại thời điểm này:",this.isProductDetailOpen),console.trace("🔍 Stack trace cho isComboImageModalOpen change")}),this.$watch("paymentMethod",(t,i)=>{console.log("🔍 paymentMethod changed:",i,"->",t),console.log("🔍 Sau khi thay đổi paymentMethod - isMiniCartOpen:",this.isMiniCartOpen),console.trace("🔍 Stack trace cho paymentMethod change")}),this.$watch("isCheckoutTransferConfirmed",(t,i)=>{console.log("🔍 isCheckoutTransferConfirmed changed:",i,"->",t),console.log("🔍 Sau khi thay đổi isCheckoutTransferConfirmed - isMiniCartOpen:",this.isMiniCartOpen),console.trace("🔍 Stack trace cho isCheckoutTransferConfirmed change")}),this.cart.length>0){new Set(this.cart.map(t=>t.id)).size<this.cart.length&&(console.warn("Phát hiện dữ liệu giỏ hàng cũ không hợp lệ. Đang tự động xóa…"),this.cart=[])}this.openProcessModal()},openProcessModal(){this.isProcessModalOpen=!0,document.body.style.overflow="hidden"},closeProcessModal(){this.isProcessModalOpen=!1,document.body.style.overflow="auto";const t=(new Date).getTime()+2592e5;localStorage.setItem("processModalViewed",JSON.stringify({expiry:t}))},generateOrderId(){const t=new Date,i=t.getFullYear().toString().slice(-2),e=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let n="";for(let t=0;t<3;t++)n+=o[Math.floor(36*Math.random())];return`AN${i}${e}${s}${n}`},formatCurrency(t){return"number"==typeof t?this._CURRENCY.format(t):t},async copyBankAccount(){const t="0968969012";try{await navigator.clipboard.writeText(t),this.showAlert("Đã sao chép số tài khoản: "+t,"success")}catch(i){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.showAlert("Đã sao chép số tài khoản: "+t,"success")}},showAlert(t,i="success"){this.alertModalMessage=t,this.alertModalType=i,this.isAlertModalOpen=!0,setTimeout(()=>{this.isAlertModalOpen=!1},3e3)},async getAddressData(){if(0===this.addressData.length&&!this.isAddressLoading){this.isAddressLoading=!0;try{const t=await fetch("./data/vietnamAddress.json");if(!t.ok)throw new Error("Không thể tải dữ liệu địa chỉ.");this.addressData=await t.json()}catch(t){console.error("Lỗi tải địa chỉ:",t),this.formErrors.province="Lỗi tải dữ liệu địa chỉ."}finally{this.isAddressLoading=!1}}},async loadData(){this.loading=!0,this.error=null;try{const[t,i,e,s]=await Promise.all([fetch("./data/products.json"),fetch("./data/shop-info.json"),fetch("./data/discounts.json"),fetch("./data/shared-details.json")]);if(!t.ok)throw new Error("Không thể tải sản phẩm.");if(!i.ok)throw new Error("Không thể tải thông tin shop.");if(!e.ok)throw new Error("Không thể tải mã giảm giá.");if(!s.ok)throw new Error("Không thể tải thông tin chi tiết.");if(this.products=await t.json(),this.shopInfo=await i.json(),this.$nextTick(()=>{const t=this.selectedProvince,i=this.selectedDistrict,e=this.selectedWard;this.selectedProvince="",this.selectedDistrict="",this.selectedWard="",this.$nextTick(()=>{this.selectedProvince=t,this.selectedDistrict=i,this.selectedWard=e})}),this.availableDiscounts=await e.json(),this.sharedDetails=await s.json(),this.products?.length){const t=this.products.reduce((t,i)=>t+(i.purchases||0),0),i=this.products.reduce((t,i)=>t+(i.rating||0),0),e=this.products.filter(t=>(t.rating||0)>0).length,s=e?(i/e).toFixed(1):0;this.shopInfo.stats={...this.shopInfo.stats,products:this.products.length,totalSales:t,averageRating:s}}}catch(t){console.error("Lỗi tải dữ liệu:",t),this.error=t.message}finally{this.loading=!1}},isProductInCategory:(t,i)=>t.category===i||!(!t.categories||!Array.isArray(t.categories))&&t.categories.includes(i),_fullProductList(){if(!this.currentCategory)return[];const t="all"===this.currentCategory.id?this.products:this.products.filter(t=>this.isProductInCategory(t,this.currentCategory.id)),i=this.activeSearchQuery.trim().toLowerCase(),e=[...i?t.filter(t=>t.name?.toLowerCase().includes(i)):t];switch(this.activeFilter){case"best_selling":e.sort((t,i)=>(i.purchases||0)-(t.purchases||0));break;case"newest":e.reverse();break;case"top_rated":e.sort((t,i)=>(i.rating||0)-(t.rating||0))}return e},filteredProducts(){const t=this._fullProductList();return this.isShowingBestSellers?t.slice(0,8):t.slice(0,this.visibleProductCount)},canLoadMore(){return this.visibleProductCount<this._fullProductList().length},getProductCount(t){return this.products.filter(i=>this.isProductInCategory(i,t)).length},topSellingProductIds(){return[...this.products].sort((t,i)=>(i.purchases||0)-(t.purchases||0)).slice(0,5).map(t=>t.id)},topSellingProductId(){const t=[...this.products].sort((t,i)=>(i.purchases||0)-(t.purchases||0));return t.length>0?t[0].id:null},showTopSellingProducts(){this.currentCategory=this.categories.find(t=>"all"===t.id)||this.categories[0],this.activeFilter="best_selling",this.isShowingBestSellers=!0,this.visibleProductCount=8,this.searchQuery="",this.activeSearchQuery="",setTimeout(()=>{const t=document.querySelector("#products-section");t&&t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},buyCombo(t,i,e){this.isBuyingCombo=!0;const s={id:t,name:i,price:e,image:"./assets/images/demo.jpg",description:`Combo đặc biệt: ${i}`,category:"combo",isCombo:!0,freeShipping:!0};this.buyNow(s)},openComboImageModal(t){console.log("🔍 openComboImageModal() được gọi với comboType:",t);const i={vong_tron_tui:{title:"Combo Vòng Trơn + Túi Dâu Tằm Để Giường",originalPrice:128e3,shippingFee:3e4,totalWithoutCombo:158e3,comboPrice:12e4,savings:38e3,customerCount:689,product1:{image:"./assets/images/demo.jpg",name:"Vòng Dâu Tằm Trơn",description:"Vòng dâu tằm trơn đơn giản, thanh lịch, phù hợp cho mọi lứa tuổi. An toàn cho bé, không gây dị ứng.",price:89e3,benefits:["An toàn cho bé","Không gây dị ứng","Dễ vệ sinh"]},product2:{image:"./assets/images/product_img/tui_dau_tam.jpg",name:"Túi Dâu Tằm Để Giường",description:"Khúc dâu tằm để phòng, trong túi nhung cao cấp. Giúp bé ngủ ngon, giảm stress.",price:39e3,benefits:["Giúp bé ngủ ngon","Giảm căng thẳng","An toàn tự nhiên"]}},vong_7_bi_bac_tui:{title:"Combo 7 Bi Bạc + Túi Dâu Tằm Để Giường",originalPrice:258e3,shippingFee:3e4,totalWithoutCombo:288e3,comboPrice:23e4,savings:58e3,customerCount:423,product1:{image:"./assets/images/demo.jpg",name:"Vòng 7 Bi Bạc",description:"Vòng dâu tằm với 7 viên bi bạc thật, sang trọng và phong thủy, mang lại may mắn cho bé.",price:219e3,benefits:["Bi bạc thật 100%","Phong thủy tốt","Sang trọng, đẳng cấp"]},product2:{image:"./assets/images/product_img/tui_dau_tam.jpg",name:"Túi Dâu Tằm Để Giường",description:"Khúc dâu tằm để phòng, trong túi nhung cao cấp. Giúp bé ngủ ngon, giảm stress.",price:39e3,benefits:["Giúp bé ngủ ngon","Giảm căng thẳng","An toàn tự nhiên"]}},vong_9_bi_bac_tui:{title:"Combo 9 Bi Bạc + Túi Dâu Tằm Để Giường",originalPrice:328e3,shippingFee:3e4,totalWithoutCombo:358e3,comboPrice:29e4,savings:68e3,customerCount:312,product1:{image:"./assets/images/demo.jpg",name:"Vòng 9 Bi Bạc",description:"Vòng dâu tằm với 9 viên bi bạc thật, cao cấp nhất cho bé yêu, mang ý nghĩa trường thọ.",price:289e3,benefits:["Bi bạc thật 100%","Ý nghĩa trường thọ","Cao cấp nhất"]},product2:{image:"./assets/images/product_img/tui_dau_tam.jpg",name:"Túi Dâu Tằm Để Giường",description:"Khúc dâu tằm để phòng, trong túi nhung cao cấp. Giúp bé ngủ ngon, giảm stress.",price:39e3,benefits:["Giúp bé ngủ ngon","Giảm căng thẳng","An toàn tự nhiên"]}},vong_co_gian_tui:{title:"Vòng dâu tằm trơn co giãn + Túi dâu tằm để giường",originalPrice:128e3,shippingFee:3e4,totalWithoutCombo:158e3,comboPrice:109e3,savings:49e3,customerCount:578,product1:{image:"./assets/images/product_img/co gian/vong_tron_co_gian.jpg",name:"Vòng dâu tằm trơn co giãn",description:"Vòng dâu tằm trơn với dây co giãn mềm mại, đơn giản nhưng tiện lợi, tự động vừa vặn.",price:89e3,benefits:["Co giãn tiện lợi","An toàn cho bé","Thoải mái cả ngày"]},product2:{image:"./assets/images/product_img/tui_dau_tam.jpg",name:"Túi Dâu Tằm Để Giường",description:"Khúc dâu tằm để giường, trong túi nhung cao cấp. Giúp bé ngủ ngon, giảm stress.",price:39e3,benefits:["Giúp bé ngủ ngon","Giảm căng thẳng","An toàn tự nhiên"]}}}[t];i&&(this.currentComboTitle=i.title,this.currentComboImages=i,this.currentComboType=t,this.isComboImageModalOpen=!0,console.log("🔍 - isComboImageModalOpen set to true"),document.body.style.overflow="hidden")},closeComboImageModal(){console.log("🔍 closeComboImageModal() được gọi"),console.log("🔍 - isComboImageModalOpen trước:",this.isComboImageModalOpen),console.trace("🔍 Stack trace cho closeComboImageModal"),this.isComboImageModalOpen=!1,document.body.style.overflow="auto"},buyComboEnhanced(t,i,e){this.isBuyingCombo=!0;const s={id:t,name:i,price:e,image:"./assets/images/demo.jpg",description:`Combo đặc biệt dành cho mẹ bỉm: ${i}`,category:"combo",isCombo:!0,freeShipping:!0,specialOffer:!0,momFriendly:!0};this.buyNow(s),this.showAlert("success","🎉 Đã thêm combo vào giỏ hàng! Cảm ơn mẹ đã tin tưởng lựa chọn.")},getDiscountCondition(t){const i=t.minItems||0,e=t.minOrder||0;return"shipping"===t.type?i>0?`Mua ${i} vòng, tổng đơn ≥ ${this.formatCurrency(e)}`:`Freeship cho đơn hàng ≥ ${this.formatCurrency(e)}`:"gift"===t.type?i>0?`Mua ${i} vòng, tổng đơn ≥ ${this.formatCurrency(e)}`:`Nhận quà cho đơn hàng ≥ ${this.formatCurrency(e)}`:"percentage"===t.type||"fixed"===t.type?i>0?`Mua ${i} vòng, tổng đơn ≥ ${this.formatCurrency(e)}`:`Giảm giá cho đơn hàng ≥ ${this.formatCurrency(e)}`:t.description||""},getDiscountGuidance(t){if(t.availability.available)return"";const i=this.isDiscountModalFromQuickBuy?this.quickBuySubtotal:this.cartSubtotal(),e=this.isDiscountModalFromQuickBuy?this.quickBuyQuantity:this.totalCartQuantity,s=t.minItems||0,o=t.minOrder||0,n=Math.max(0,o-i),a=Math.max(0,s-e);if(a>0&&n>0){const t=Math.ceil(n/a);return`Cần mua thêm ${a} sản phẩm giá từ ${this.formatCurrency(t)} trở lên`}return a>0?`Cần mua thêm ${a} sản phẩm`:n>0?`Cần mua thêm ${this.formatCurrency(n)}`:t.availability.reason||""},getDiscountPercentage(t){if(!t.original_price||t.original_price<=t.price)return 0;const i=Math.round(100*(1-t.price/t.original_price));return i>=1?i:0},getCategoryPurchases(t){const i=("all"===t?this.products:this.products.filter(i=>this.isProductInCategory(i,t))).reduce((t,i)=>t+(i.purchases||0),0);if(i>1e3){const t=(i/1e3).toFixed(1);return t.includes(".0")?`${Math.round(i/1e3)}k`:t.replace(".",",")+"k"}return i},cartSubtotal(){return this.selectedCartProducts.filter(t=>!t.isGift).reduce((t,i)=>t+(i.finalPrice||i.price)*(i.beadQuantity||i.quantity),0)},get hasMainProductInCart(){return this.selectedCartItems.some(t=>!this.addonProducts.some(i=>i.id===t))},get addonDiscount(){return this.cart.some(t=>"addon_moc_chia_khoa"===t.id)?5e3:0},get tuiDauTamBonusDiscount(){const t=this.selectedCartItems.includes("addon_tui_dau_tam"),i=this.isFreeshippingFromDiscount();return t&&i&&this.hasMainProductInCart?8e3:0},get freeShipping(){if(this.cart.some(t=>"addon_tui_dau_tam"===t.id||"addon_bo_dau_tam_7_canh"===t.id||"addon_bo_dau_tam_9_canh"===t.id))return!0;const t=this.availableDiscounts.find(t=>t.code?.toUpperCase()===this.appliedDiscountCode);return!(!t||"shipping"!==t.type)},shippingFee(){return this.SHIPPING_FEE},get shippingDiscount(){return this.freeShipping?this.SHIPPING_FEE:0},cartTotal(){if(0===this.selectedCartItems.length)return 0;const t=this.cartSubtotal()+this.shippingFee()-this.discountAmount-this.addonDiscount-this.shippingDiscount-this.tuiDauTamBonusDiscount;return t>0?t:0},get totalSavings(){return this.shippingDiscount+this.discountAmount+this.addonDiscount+this.tuiDauTamBonusDiscount},get totalCartQuantity(){return this.selectedCartProducts.reduce((t,i)=>t+i.quantity,0)},get trueTotalCartQuantity(){return this.cart.reduce((t,i)=>t+i.quantity,0)},get provinces(){return this.addressData.map(t=>({Id:t.Id,Name:t.Name}))},get districts(){if(!this.selectedProvince)return[];const t=this.addressData.find(t=>t.Id===this.selectedProvince);return t?t.Districts.map(t=>({Id:t.Id,Name:t.Name})):[]},get wards(){if(!this.selectedProvince||!this.selectedDistrict)return[];const t=this.addressData.find(t=>t.Id===this.selectedProvince),i=t?.Districts?.find(t=>t.Id===this.selectedDistrict);return i?i.Wards.map(t=>({Id:t.Id,Name:t.Name})):[]},get bestSellingProducts(){return[...this.products].sort((t,i)=>(i.purchases||0)-(t.purchases||0)).slice(0,8)},updateFullAddress(){if(this.selectedProvince&&this.selectedDistrict&&this.selectedWard){const t=this.provinces.find(t=>t.Id===this.selectedProvince)?.Name||"",i=this.districts.find(t=>t.Id===this.selectedDistrict)?.Name||"",e=this.wards.find(t=>t.Id===this.selectedWard)?.Name||"";this.customer.address=[this.streetAddress,e,i,t].filter(Boolean).join(", ")}else this.customer.address=""},performSearch(){this.activeSearchQuery=this.searchQuery.trim(),this.visibleProductCount=8,this.activeSearchQuery&&this.$nextTick(()=>{document.getElementById("product-list-anchor")?.scrollIntoView({behavior:"smooth",block:"start"})})},loadMoreProducts(){this.visibleProductCount+=this.productsPerLoad},selectCategory(t){this.visibleProductCount=8,this.currentCategory=t,this.searchQuery="",this.activeSearchQuery="",this.isShowingBestSellers=!1,this.view="products",this.$nextTick(()=>{document.getElementById("product-list-anchor")?.scrollIntoView({behavior:"smooth",block:"start"})})},triggerCartAnimation(){this.isCartAnimating=!0,setTimeout(()=>{this.isCartAnimating=!1},600)},backToCategories(){this.selectCategory({id:"all",name:"Top bán chạy",description:"Những sản phẩm được yêu thích và mua nhiều nhất."}),this.view="products"},showBestSellers(){console.log("🔍 showBestSellers() đóng isMiniCartOpen"),this.isMiniCartOpen=!1,this.currentCategory={id:"all",name:"Top bán chạy"},this.activeFilter="best_selling",this.isShowingBestSellers=!0,this.$nextTick(()=>{document.getElementById("product-list-anchor")?.scrollIntoView({behavior:"smooth",block:"start"})})},scrollToCategories(){this.closeAllModals(),this.view="products",this.$nextTick(()=>{const t=document.querySelectorAll("h2"),i=Array.from(t).find(t=>t.textContent.includes("Khu Vườn Sản Phẩm"));if(i)i.scrollIntoView({behavior:"smooth",block:"start"});else{const t=document.querySelector(".grid.grid-cols-1.sm\\:grid-cols-2.md\\:grid-cols-3.lg\\:grid-cols-3");t?t.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:0,behavior:"smooth"})}})},scrollToCombo(){this.closeAllModals(),this.view="products",setTimeout(()=>{const t=document.querySelector("[x-show=\"!loading && !error && view === 'products'\"]");if(t)t.scrollIntoView({behavior:"smooth",block:"start"});else{const t=document.querySelector(".mb-6.sm\\:mb-8");t?t.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:0,behavior:"smooth"})}},100)},scrollToTopProducts(){this.closeAllModals(),this.view="products",setTimeout(()=>{const t=document.querySelectorAll("button"),i=Array.from(t).find(t=>t.textContent.includes("🔥 Bán chạy")||t.textContent.includes("Bán chạy")&&t.textContent.includes("🔥"));if(i)i.scrollIntoView({behavior:"smooth",block:"start"});else{const t=document.querySelector(".flex.items-center.justify-center.flex-wrap.gap-2.mb-8");if(t)t.scrollIntoView({behavior:"smooth",block:"start"});else{const t=document.querySelector(".mb-6.sm\\:mb-8");t?t.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})}}},100)},openImageModal(t){this.currentImage=t,this.isImageModalOpen=!0,document.body.style.overflow="hidden"},closeImageModal(){this.isImageModalOpen=!1,setTimeout(()=>{this.currentImage=""},300),document.body.style.overflow="auto"},openFaqModal(){this.isFaqModalOpen=!0,document.body.style.overflow="hidden"},closeFaqModal(){this.isFaqModalOpen=!1,document.body.style.overflow="auto"},toggleFaqItem(t){this.faqOpenItems.includes(t)?this.faqOpenItems=this.faqOpenItems.filter(i=>i!==t):this.faqOpenItems.push(t)},openAddonDetail(t){console.log("🔍 openAddonDetail() - Trước khi mở:"),console.log("🔍 - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 - isCheckoutModalOpen:",this.isCheckoutModalOpen),console.log("🔍 - isQuickBuyModalOpen:",this.isQuickBuyModalOpen),console.log("🔍 - isProductDetailOpen:",this.isProductDetailOpen),console.log("🔍 - document.body.style.overflow:",document.body.style.overflow),this.isMiniCartOpen&&(this.preventMiniCartCloseOnClickOutside=!0),this.addonDetailOpenedFrom=this.isMiniCartOpen?"miniCart":this.isCheckoutModalOpen?"checkout":this.isQuickBuyModalOpen?"quickBuy":this.isProductDetailOpen?"productDetail":"homepage",console.log("🔍 - addonDetailOpenedFrom:",this.addonDetailOpenedFrom),this.currentAddonDetail=t,this.isAddonDetailModalOpen=!0,this.$nextTick(()=>{const i=document.getElementById("addon-product-name");i&&t&&(i.textContent=t.name)}),document.body.style.overflow="hidden",console.log("🔍 - Sau khi set overflow hidden:",document.body.style.overflow)},closeAddonDetail(){console.log("🔍 closeAddonDetail() - Trước khi đóng:"),console.log("🔍 - isAddonDetailModalOpen:",this.isAddonDetailModalOpen),console.log("🔍 - addonDetailOpenedFrom:",this.addonDetailOpenedFrom),console.log("🔍 - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 - isCheckoutModalOpen:",this.isCheckoutModalOpen),console.log("🔍 - isQuickBuyModalOpen:",this.isQuickBuyModalOpen),console.log("🔍 - isProductDetailOpen:",this.isProductDetailOpen),console.log("🔍 - document.body.style.overflow trước:",document.body.style.overflow),this.isAddonDetailModalOpen=!1,setTimeout(()=>{this.preventMiniCartCloseOnClickOutside=!1},100),"homepage"===this.addonDetailOpenedFrom?(console.log("🔍 - Mở từ homepage, restore overflow = auto"),document.body.style.overflow="auto"):(console.log("🔍 - Mở từ modal khác, kiểm tra điều kiện..."),this.isMiniCartOpen||this.isCheckoutModalOpen||this.isQuickBuyModalOpen||this.isProductDetailOpen?console.log("🔍 - Vẫn có modal khác mở, giữ overflow = hidden"):(console.log("🔍 - Không có modal nào mở, restore overflow = auto"),document.body.style.overflow="auto")),console.log("🔍 - document.body.style.overflow sau:",document.body.style.overflow),setTimeout(()=>{this.currentAddonDetail=null,this.addonDetailOpenedFrom=null},300)},openBeadQuantityModal(t){this.currentBeadProduct=t,this.beadOptions={quantity:14,note:""},this.isBeadQuantityModalOpen=!0,document.body.style.overflow="hidden"},closeBeadQuantityModal(){this.isBeadQuantityModalOpen=!1,this.isMiniCartOpen||this.isCheckoutModalOpen||this.isQuickBuyModalOpen||this.isProductDetailOpen||this.isDiscountModalOpen||this.isAddonDetailModalOpen||this.isItemOptionsModalOpen||this.isHandSizeModalOpen||(document.body.style.overflow="auto"),setTimeout(()=>{this.currentBeadProduct=null,this.beadOptions={quantity:14,note:""}},300)},addBeadWithQuantity(){if(!this.currentBeadProduct)return;if(!this.beadOptions.quantity||this.beadOptions.quantity<1)return void this.showAlert("Vui lòng chọn số lượng hạt dâu trước khi thêm vào giỏ hàng","error");const{id:t}=this.currentBeadProduct,i=this.beadOptions.note.trim(),e=this.cart.find(e=>e.id===t&&e.beadQuantity&&(e.notes||"")===i);if(e){e.beadQuantity+=this.beadOptions.quantity;const t=e.cartId||e.id;this.selectedCartItems.includes(t)||this.selectedCartItems.push(t),this.triggerCartAnimation(),this.showAlert(`Đã thêm ${this.beadOptions.quantity} hạt vào ${this.currentBeadProduct.name}! Tổng: ${e.beadQuantity} hạt`,"success")}else{const e=`${t}-${Date.now()}`,s={...this.currentBeadProduct,cartId:e,quantity:1,beadQuantity:this.beadOptions.quantity,notes:i,basePrice:this.currentBeadProduct.price,finalPrice:this.currentBeadProduct.price};this.addToCart(s),this.showAlert(`Đã thêm ${this.currentBeadProduct.name} (${this.beadOptions.quantity} hạt) vào giỏ hàng!`,"success")}this.closeBeadQuantityModal(),this.isProductDetailOpen&&this.closeProductDetail()},addBeadProductToCart(){this.addBeadWithQuantity()},openItemOptionsModal(t){this.currentItemForOptions=t,this.itemOptions={quantity:1,note:"",selectedWeight:"",customWeight:"",babyName:""},this.showSizeGuide=!1,this.isItemOptionsModalOpen=!0,document.body.style.overflow="hidden"},closeItemOptionsModal(){this.isItemOptionsModalOpen=!1,this.showSizeGuide=!1,document.body.style.overflow="auto",setTimeout(()=>{this.currentItemForOptions=null,this.itemOptions={quantity:1,note:"",selectedWeight:"",customWeight:"",babyName:""}},300)},toggleSizeGuide(){this.showSizeGuide=!this.showSizeGuide},addItemWithOptions(){if(!this.currentItemForOptions)return;const t=this.isAdultProduct(this.currentItemForOptions);if(!this.itemOptions.selectedWeight)return void this.showAlert(t?"Vui lòng chọn size tay":"Vui lòng chọn cân nặng của bé","error");if(!t&&"custom"===this.itemOptions.selectedWeight&&!this.itemOptions.customWeight)return void this.showAlert("Vui lòng nhập cân nặng cụ thể","error");if("mix_the_ten_be"===this.currentItemForOptions?.category&&!this.itemOptions.babyName?.trim())return void this.showAlert("Vui lòng nhập tên của bé","error");const{id:i}=this.currentItemForOptions,e=`${i}-${Date.now()}`;let s=this.itemOptions.selectedWeight;"custom"===this.itemOptions.selectedWeight&&(s=`${this.itemOptions.customWeight}kg`);const o=this.calculateDynamicPrice(this.currentItemForOptions,s),n={...this.currentItemForOptions,cartId:e,quantity:1,weight:s,selectedWeight:this.itemOptions.selectedWeight,customWeight:this.itemOptions.customWeight,babyName:this.itemOptions.babyName?this.itemOptions.babyName.trim():"",notes:this.itemOptions.note.trim(),basePrice:this.currentItemForOptions.price,finalPrice:o.finalPrice,surcharge:o.surcharge,hasSurcharge:o.hasSurcharge};console.log("🔍 DEBUG: Adding item to cart with weight/size:"),console.log("- Product:",this.currentItemForOptions.name),console.log("- selectedWeight:",this.itemOptions.selectedWeight),console.log("- finalWeight:",s),console.log("- babyName:",this.itemOptions.babyName),console.log("- cartId:",e),console.log("- itemToAdd:",n),this.addToCart(n),this.closeItemOptionsModal(),this.isProductDetailOpen&&this.closeProductDetail()},handleProductClick(t){if(this.requiresBabyName(t))this.openBabyNameModal(t);else if(this.isBeadProduct(t))this.openBeadQuantityModal(t);else if(this.isAddonProduct(t)){const i={...t,weight:"N/A",selectedWeight:"N/A",cartId:`${t.id}-${Date.now()}`,quantity:1,basePrice:t.price,finalPrice:t.price};this.addToCart(i),this.showAlert(`Đã thêm ${t.name} vào giỏ hàng!`,"success")}else this.isAdultProduct(t)?this.openHandSizeModal(t):this.openItemOptionsModal(t)},addToCart(t){if(0===t.stock_quantity)return void this.showAlert("Sản phẩm này đã hết hàng!","error");const i=this.cart.find(i=>{return s=t,(e=i).id===s.id&&(e.selectedWeight||e.weight||"")===(s.selectedWeight||s.weight||"")&&(e.babyName||"")===(s.babyName||"")&&(e.beadQuantity||"")===(s.beadQuantity||"")&&(e.handSize||"")===(s.handSize||"");var e,s});if(i)i.quantity+=t.quantity||1,this.showAlert(`Đã cập nhật số lượng ${i.name}!`,"success");else{let i;if(t.cartId){if(i={...t},"mix_the_ten_be"===t.category&&t.babyName&&t.babyName.trim()){const e=`Tên bé: ${t.babyName.trim()}`;t.notes&&t.notes.trim()?i.notes=`${e} | ${t.notes.trim()}`:i.notes=e}}else{const e=`${t.id}-${Date.now()}`;i={...t,cartId:e,quantity:t.quantity||1,weight:t.weight||"",selectedWeight:t.selectedWeight||"",customWeight:t.customWeight||"",notes:t.notes||"",babyName:t.babyName||"",beadQuantity:t.beadQuantity||"",handSize:t.handSize||"",basePrice:t.basePrice||t.price,finalPrice:t.finalPrice||t.price,surcharge:t.surcharge||0,hasSurcharge:t.hasSurcharge||!1}}this.cart.push(i),this.selectedCartItems.push(i.cartId),this.showAlert("Đã thêm sản phẩm vào giỏ hàng!","success")}this.triggerCartAnimation()},toggleMiniCart(){this.isMiniCartOpen=!this.isMiniCartOpen,this.isMiniCartOpen?(this.miniCartError="",this.selectedCartItems=this.cart.map(t=>t.cartId||t.id),this.startSocialProofTimer()):this.stopSocialProofTimer()},startSocialProofTimer(){this.stopSocialProofTimer(),this.socialProofInterval=setInterval(()=>{this.socialProofViewers=Math.floor(5*Math.random())+1},2e3)},stopSocialProofTimer(){this.socialProofInterval&&(clearInterval(this.socialProofInterval),this.socialProofInterval=null)},toggleCartItemSelection(t){const i=this.selectedCartItems.indexOf(t);i>-1?this.selectedCartItems.splice(i,1):this.selectedCartItems.push(t)},toggleSelectAll(){this.isAllSelected?this.selectedCartItems=[]:this.selectedCartItems=this.cart.map(t=>t.cartId||t.id)},get isAllSelected(){return 0!==this.cart.length&&this.cart.every(t=>this.selectedCartItems.includes(t.cartId||t.id))},get canPlaceOrder(){return"cod"===this.paymentMethod||("bank_transfer"!==this.paymentMethod||this.isCheckoutTransferConfirmed)},get canPlaceQuickBuyOrder(){return"cod"===this.quickBuyPaymentMethod||("bank_transfer"!==this.quickBuyPaymentMethod||this.isQuickBuyTransferConfirmed)},checkoutSelected(){this.selectedCartItems.length?(console.log("🔍 checkoutSelected() đóng isMiniCartOpen"),this.miniCartError="",this.view="cart",this.isMiniCartOpen=!1):this.miniCartError="Vui lòng chọn 1 sản phẩm để mua hàng"},get selectedCartProducts(){return this.cart.filter(t=>this.selectedCartItems.includes(t.cartId||t.id))},addAddonToCart(t){if(this.isQuickBuyModalOpen)return void this.addAddonToQuickBuy(t);if(this.isProductDetailOpen)return void this.addAddonToProductDetail(t);const i=this.cart.find(i=>i.id===t.id);if(i){i.quantity++;const t=i.cartId||i.id;this.selectedCartItems.includes(t)||this.selectedCartItems.push(t)}else{const i=`${t.id}-${Date.now()}`,e={...t,cartId:i,quantity:1,weight:"",isAddon:!0};this.cart.push(e),this.selectedCartItems.push(i)}this.triggerCartAnimation(),"addon_tui_dau_tam"===t.id||"addon_bo_dau_tam_7_canh"===t.id||"addon_bo_dau_tam_9_canh"===t.id?this.showAlert(`Đã thêm ${t.name}! 🚚 Bạn được miễn phí ship!`,"success"):"addon_moc_chia_khoa"===t.id?this.showAlert(`Đã thêm ${t.name}! 💰 Giảm 5K đơn hàng!`,"success"):this.showAlert(`Đã thêm ${t.name} vào giỏ hàng!`,"success")},addAddonToQuickBuy(t){this.quickBuySelectedAddons.find(i=>i.id===t.id)||(this.quickBuySelectedAddons.push({...t,quantity:1}),this.showAlert(`Đã thêm ${t.name}! 💰 Giảm 5K đơn hàng!`,"success"))},removeAddonFromQuickBuy(t){this.quickBuySelectedAddons=this.quickBuySelectedAddons.filter(i=>i.id!==t);const i=this.addonProducts.find(i=>i.id===t);this.showAlert(`Đã xóa ${i?.name||"addon"}!`,"success")},addAddonToProductDetail(t){this.productDetailSelectedAddons.find(i=>i.id===t.id)||(this.productDetailSelectedAddons.push({...t,quantity:1}),"addon_tui_dau_tam"===t.id||"addon_bo_dau_tam_7_canh"===t.id||"addon_bo_dau_tam_9_canh"===t.id?this.showAlert(`Đã thêm ${t.name}! 🚚 Bạn được miễn phí ship!`,"success"):"addon_moc_chia_khoa"===t.id?this.showAlert(`Đã thêm ${t.name}! 💰 Giảm 5K đơn hàng!`,"success"):this.showAlert(`Đã thêm ${t.name}!`,"success"))},removeAddonFromProductDetail(t){this.productDetailSelectedAddons=this.productDetailSelectedAddons.filter(i=>i.id!==t);const i=this.addonProducts.find(i=>i.id===t);this.showAlert(`Đã xóa ${i?.name||"addon"}!`,"success")},isAddonInCart(t){return this.cart.some(i=>i.id===t)},isFreeshippingFromDiscount(){if(!this.appliedDiscountCode)return!1;const t=this.availableDiscounts.find(t=>t.code?.toUpperCase()===this.appliedDiscountCode);return!(!t||"shipping"!==t.type)},removeFromCart(t,i=null){if(this.isQuickBuyModalOpen)return void this.removeAddonFromQuickBuy(t);if(this.isProductDetailOpen)return void this.removeAddonFromProductDetail(t);const e=this.addonProducts.some(i=>i.id===t);let s;if(i?(s=this.cart.find(t=>t.cartId===i),this.cart=this.cart.filter(t=>t.cartId!==i),this.selectedCartItems=this.selectedCartItems.filter(t=>t!==i)):(s=this.cart.find(i=>i.id===t),this.cart=this.cart.filter(i=>i.id!==t),this.selectedCartItems=this.selectedCartItems.filter(i=>i!==t)),this.revalidateAppliedDiscount(),e){this.cart.some(t=>this.addonProducts.some(i=>i.id===t.id))||this.isFreeshippingFromDiscount()?this.showAlert(`Đã xóa ${s?.name||"sản phẩm"} khỏi giỏ hàng.`,"success"):this.showAlert(`Đã xóa ${s?.name||"sản phẩm bán kèm"}. Phí vận chuyển có thể được áp dụng lại.`,"info")}else this.showAlert(`Đã xóa ${s?.name||"sản phẩm"} khỏi giỏ hàng.`,"success");0===this.cart.length&&this.resetDiscount()},increaseQuantity(t){const i=this.cart.find(i=>i.id===t);i&&(i.quantity++,this.revalidateAppliedDiscount())},updateItemHandSize(t,i){const e=this.cart.find(i=>i.cartId===t);e&&(e.selectedSize=i,e.handSize=i,e.weight=i,this.saveCart())},decreaseQuantity(t){const i=this.cart.find(i=>i.id===t);i&&i.quantity>1?(i.quantity--,this.revalidateAppliedDiscount()):i&&this.removeFromCart(t)},increaseBeadQuantity(t){const i=this.cart.find(i=>i.cartId===t);i&&i.beadQuantity&&i.beadQuantity<50&&(i.beadQuantity++,this.revalidateAppliedDiscount())},decreaseBeadQuantity(t){const i=this.cart.find(i=>i.cartId===t);i&&i.beadQuantity&&i.beadQuantity>1?(i.beadQuantity--,this.revalidateAppliedDiscount()):i&&i.beadQuantity&&i.beadQuantity<=1&&confirm("Bạn có muốn xóa sản phẩm này khỏi giỏ hàng?")&&this.removeFromCart(i.id,t)},updateItemWeight(t,i){const e=this.cart.find(i=>i.cartId===t||i.id===t);if(e){if("custom"===i)return;let s=i;if("custom"===e.selectedWeight&&i){const t=this.parseWeight(i);if(t<20)return void this.showAlert("Cân nặng tùy chỉnh phải từ 20kg trở lên!","error");s=i,e.customWeight=t}e.weight=s,"custom"!==e.selectedWeight&&(e.selectedWeight=i);const o=this.products.find(t=>t.id===e.id);if(o){const t=this.calculateDynamicPrice(o,s);e.basePrice=o.price,e.finalPrice=t.finalPrice,e.surcharge=t.surcharge,e.hasSurcharge=t.hasSurcharge}this.updateCartTotal(),this.weightErrors[t]&&delete this.weightErrors[t]}},calculateDynamicPrice(t,i){if(!t)return{finalPrice:0,surcharge:0,hasSurcharge:!1,tier:"standard"};const e=this.parseWeight(i),s=t.price;if("Chưa sinh"===i||"🤱 Chưa sinh"===i||!e)return{finalPrice:s,surcharge:0,hasSurcharge:!1,tier:"standard"};const o=this.isAdultProduct(t),n=this.parseWeight(i);if(o){if(n>=17){const t=this.pricingConfig.largeSizeSurcharge;return{finalPrice:s+t,surcharge:t,hasSurcharge:!0,tier:"large"}}}else if(n>this.pricingConfig.standardMaxWeight){const t=this.pricingConfig.largeSizeSurcharge;return{finalPrice:s+t,surcharge:t,hasSurcharge:!0,tier:"large"}}return{finalPrice:s,surcharge:0,hasSurcharge:!1,tier:"standard"}},parseWeight(t){if(!t)return 0;if("number"==typeof t)return t;if("string"==typeof t){const i=t.replace(/kg/gi,"").trim(),e=parseFloat(i);return isNaN(e)?0:e}return 0},formatPriceWithSurcharge(t,i){const e=this.calculateDynamicPrice(t,i);return e.hasSurcharge?{display:this.formatCurrency(e.finalPrice),breakdown:`${this.formatCurrency(t.price)} + ${this.formatCurrency(e.surcharge)} (size lớn)`,hasSurcharge:!0,surcharge:e.surcharge}:{display:this.formatCurrency(e.finalPrice),breakdown:null,hasSurcharge:!1,surcharge:0}},updateCartTotal(){this.$nextTick(()=>{(this.appliedDiscountCode||this.appliedGift||this.discountAmount>0)&&this.revalidateAppliedDiscount()})},openSizingGuideModal(){this.isSizingGuideModalOpen=!0},closeSizingGuideModal(){this.isSizingGuideModalOpen=!1},buyNow(t){if(0===t.stock_quantity)return void this.showAlert("Sản phẩm này đã hết hàng!","error");console.log("🔍 buyNow() được gọi"),console.log("🔍 - isProductDetailOpen trước buyNow:",this.isProductDetailOpen),console.log("🔍 - isQuickBuyModalOpen trước buyNow:",this.isQuickBuyModalOpen),console.trace("🔍 Stack trace cho buyNow"),this.quickBuyProduct={...t},"hat_dau_tam_mai_san"===t.category?this.quickBuyQuantity="":this.quickBuyQuantity=1,this.quickBuyWeight="",this.quickBuyCustomWeight="",this.quickBuyBabyName="",this.quickBuyNotes="";this.showWeightInQuickBuy=!["san_pham_ban_kem","hat_dau_tam_mai_san","bi_charm_bac"].includes(t.category),this.isAdultInQuickBuy=this.isAdultProduct(t),this.isQuickBuyModalOpen=!0,this.startSocialProofTimer(),console.log("🔍 - isProductDetailOpen sau set QuickBuy:",this.isProductDetailOpen),console.log("🔍 - isQuickBuyModalOpen sau set QuickBuy:",this.isQuickBuyModalOpen),this.$nextTick(()=>{console.log("🔍 Revalidating discount for Quick Buy:"),console.log("- quickBuySubtotal:",this.quickBuySubtotal),console.log("- appliedDiscountCode:",this.appliedDiscountCode),this.revalidateQuickBuyDiscount()}),this.$nextTick(()=>{setTimeout(()=>{const t=document.querySelector('#quickBuyModal input[type="text"]');t&&!this.customer.name&&t.focus()},300)})},closeQuickBuyModal(){console.log("🔍 closeQuickBuyModal() được gọi"),console.log("🔍 - isQuickBuyModalOpen trước:",this.isQuickBuyModalOpen),console.log("🔍 - isProductDetailOpen trước:",this.isProductDetailOpen),console.log("🔍 - isComboImageModalOpen trước:",this.isComboImageModalOpen),console.trace("🔍 Stack trace cho closeQuickBuyModal"),this.isQuickBuyModalOpen=!1,this.isBuyingCombo=!1,this.quickBuyProduct=null,this.quickBuyQuantity=1,this.quickBuyWeight="",this.quickBuyCustomWeight="",this.quickBuyBabyName="",this.quickBuyNotes="",this.quickBuyPaymentMethod="cod",this.isQuickBuyTransferConfirmed=!1,this.quickBuySelectedAddons=[],this.showWeightInQuickBuy=!0,this.isAdultInQuickBuy=!1,this.clearFormErrors(),this.stopSocialProofTimer(),console.log("🔍 - isQuickBuyModalOpen sau:",this.isQuickBuyModalOpen),console.log("🔍 - isProductDetailOpen sau:",this.isProductDetailOpen),console.log("🔍 - isComboImageModalOpen sau:",this.isComboImageModalOpen)},handleOrderSuccess(){this.isQuickBuyModalOpen=!1,this.isSuccessModalOpen=!0},closeAllModals(){console.log("🔍 closeAllModals() được gọi"),console.log("🔍 Trước khi đóng tất cả - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 Trước khi đóng tất cả - isCheckoutModalOpen:",this.isCheckoutModalOpen),this.isImageModalOpen=!1,this.isAlertModalOpen=!1,this.isSuccessModalOpen=!1,this.isConfirmModalOpen=!1,this.isCheckoutModalOpen=!1,this.isMiniCartOpen=!1,this.isDiscountModalOpen=!1,this.isQuickBuyModalOpen=!1,this.isBuyingCombo=!1,this.isCheckoutConfirmTransferModalOpen=!1,this.isComboImageModalOpen=!1,this.isAddonDetailModalOpen=!1,this.isProductDetailOpen=!1,this.isSizingGuideModalOpen=!1,console.log("🔍 Sau khi đóng tất cả - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 Sau khi đóng tất cả - isCheckoutModalOpen:",this.isCheckoutModalOpen)},openQuickView(t){this.quickViewProduct=t,this.isQuickViewOpen=!0,document.body.style.overflow="hidden"},closeQuickView(){this.isQuickViewOpen=!1,this.quickViewProduct=null,this.isMiniCartOpen||this.isCheckoutModalOpen||this.isProductDetailOpen||this.isQuickBuyModalOpen||this.isSizingGuideModalOpen||(document.body.style.overflow="auto")},openSizingGuideModal(){this.isSizingGuideModalOpen=!0,this.preventQuickBuyCloseOnEscape=!0},closeSizingGuideModal(){this.isSizingGuideModalOpen=!1,this.preventQuickBuyCloseOnEscape=!1},async confirmTransferAndSubmit(){this.isQuickBuySubmitting=!0;try{const t={...this.quickBuyProduct,quantity:this.quickBuyQuantity,weight:this.quickBuyWeight,babyName:this.quickBuyBabyName,note:this.quickBuyNotes,cartId:`quickbuy-${Date.now()}`},i=this.quickBuySubtotal,e=this.quickBuyShippingFee,s=this.quickBuyTotal,o=this.generateOrderId();this.lastOrderId=o;const n={orderId:o,cart:[{name:t.name,price:this.formatCurrency(t.price),quantity:t.quantity,weight:t.weight,notes:t.notes||""}],telegramNotification:"VDT_SECRET_2025_ANHIEN",customer:{name:this.customer.name,phone:this.customer.phone,email:this.customer.email,address:this.customer.address,notes:this.quickBuyNotes},orderDate:(new Date).toISOString(),subtotal:this.formatCurrency(i),shipping:0===e?"Miễn phí":this.formatCurrency(e),discount:this.discountAmount>0?`-${this.formatCurrency(this.discountAmount)} (${this.appliedDiscountCode})`:"Không có",total:this.formatCurrency(s),paymentMethod:"Chuyển khoản ngân hàng"},a="https://hidden-bonus-76d2.yendev96.workers.dev",r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){let t="Có lỗi xảy ra khi gửi đơn hàng.";try{t=(await r.json()).message||t}catch{}throw new Error(t)}this.handleOrderSuccess()}catch(t){console.error("Lỗi quick buy:",t),this.showAlert(`Lỗi đặt hàng: ${t.message}`,"error")}finally{this.isQuickBuySubmitting=!1}},clearFieldError(t){this.formErrors[t]&&(this.formErrors[t]="")},scrollToFirstQuickBuyError(){this.$nextTick(()=>{setTimeout(()=>{const t=["quantity","name","phone","province","district","ward","streetAddress","weight","paymentMethod"];for(const i of t)if(this.formErrors[i]){let t="";switch(i){case"quantity":t="#quick-buy-quantity-section";break;case"name":t='input[x-model="customer.name"]';break;case"phone":t='input[x-model="customer.phone"]';break;case"province":t='select[x-model="selectedProvince"]';break;case"district":t='select[x-model="selectedDistrict"]';break;case"ward":t='select[x-model="selectedWard"]';break;case"streetAddress":t='input[x-model="streetAddress"]';break;case"weight":t='select[x-model="quickBuyWeight"]';break;case"babyName":t='input[x-model="quickBuyBabyName"]';break;case"paymentMethod":t='[x-model="quickBuyPaymentMethod"]'}const e=document.querySelector(t);if(console.log(`🔍 Scroll Debug - Field: ${i}, Selector: ${t}, Element found:`,!!e),e){const t=e.closest(".modal-scroll");if(console.log("🔍 Modal scroll container found:",!!t),t){const i=e.offsetTop-t.offsetTop;console.log(`🔍 Scrolling to elementTop: ${i}, adjusted: ${Math.max(0,i-100)}`),t.scrollTo({top:Math.max(0,i-100),behavior:"smooth"})}else console.log("🔍 Using fallback scrollIntoView"),e.scrollIntoView({behavior:"smooth",block:"center"});"INPUT"!==e.tagName&&"SELECT"!==e.tagName||setTimeout(()=>e.focus(),300);break}}},100)})},async quickBuySubmit(){this.clearFormErrors(),this.updateFullAddress(),console.log("🔍 Quick Buy Validation Debug:"),console.log("selectedProvince:",this.selectedProvince),console.log("selectedDistrict:",this.selectedDistrict),console.log("selectedWard:",this.selectedWard),console.log("streetAddress:",this.streetAddress),console.log("customer.address:",this.customer.address);let t=!0;if(this.isEngravingProductInQuickBuy&&!this.quickBuyNotes.trim())return this.formErrors.quickBuyNotes='Vui lòng nhập tên bé cần khắc...Ví dụ "Hoàng Anh - Khoai"',t=!1,void this.$nextTick(()=>{this.$refs.quickBuyNotesInput.scrollIntoView({behavior:"smooth",block:"center"})});if(this.customer.name.trim()||(this.formErrors.name="Vui lòng nhập họ và tên",t=!1),this.customer.phone.trim()){/(0[3|5|7|8|9])+([0-9]{8})\b/.test(this.customer.phone)||(this.formErrors.phone="Số điện thoại không hợp lệ",t=!1)}else this.formErrors.phone="Vui lòng nhập số điện thoại",t=!1;this.selectedProvince||(this.formErrors.province="Vui lòng chọn tỉnh/thành phố",t=!1),this.selectedDistrict||(this.formErrors.district="Vui lòng chọn quận/huyện",t=!1),this.selectedWard||(this.formErrors.ward="Vui lòng chọn phường/xã",t=!1),this.streetAddress&&this.streetAddress.trim()||(this.formErrors.streetAddress="Vui lòng nhập địa chỉ cụ thể",t=!1);const i=this.quickBuyProduct&&(["san_pham_ban_kem","hat_dau_tam_mai_san","bi_charm_bac"].includes(this.quickBuyProduct.category)||"addon_moc_chia_khoa"===this.quickBuyProduct.id||"addon_tui_dau_tam"===this.quickBuyProduct.id);if(this.quickBuyProduct&&!i){const i=this.isAdultProduct(this.quickBuyProduct);this.quickBuyWeight&&""!==this.quickBuyWeight.trim()&&"-- Chọn cân nặng --"!==this.quickBuyWeight&&"-- Chọn size tay --"!==this.quickBuyWeight?i||"✏️ Nhập cân nặng > 20kg"!==this.quickBuyWeight||this.quickBuyCustomWeight&&!(this.quickBuyCustomWeight<20)?!i&&this.quickBuyWeight.includes("kg")&&this.parseWeight(this.quickBuyWeight)>=20&&this.parseWeight(this.quickBuyWeight)<20&&(this.formErrors.weight="Cân nặng phải từ 20kg trở lên",t=!1):(this.formErrors.weight="Vui lòng nhập cân nặng cụ thể từ 20kg trở lên",t=!1):(this.formErrors.weight=i?"Vui lòng chọn size tay":"Vui lòng chọn cân nặng của bé",t=!1)}if(this.quickBuyProduct&&this.quickBuyProduct.categories&&this.quickBuyProduct.categories.includes("mix_the_ten_be")&&(this.quickBuyBabyName&&""!==this.quickBuyBabyName.trim()||(this.formErrors.babyName="Nhập tên bé ví dụ Nhím - Nhím hoặc Nhím - Nhật Minh",t=!1)),this.quickBuyProduct&&"hat_dau_tam_mai_san"===this.quickBuyProduct.category&&(!this.quickBuyQuantity||this.quickBuyQuantity<1)&&(this.formErrors.quantity="Vui lòng chọn số lượng hạt dâu",t=!1),this.quickBuyPaymentMethod||(this.formErrors.paymentMethod="Vui lòng chọn phương thức thanh toán",t=!1),t)if("bank_transfer"!==this.quickBuyPaymentMethod||this.isQuickBuyTransferConfirmed){this.isQuickBuySubmitting=!0;try{const t={...this.quickBuyProduct,quantity:this.quickBuyQuantity,weight:this.quickBuyWeight,babyName:this.quickBuyBabyName,note:this.quickBuyNotes,cartId:`quickbuy-${Date.now()}`},i=[{name:t.name,price:this.formatCurrency(t.price),quantity:t.quantity,weight:t.weight,notes:t.notes||""}];this.quickBuyAddons.forEach(t=>{i.push({name:t.name,price:this.formatCurrency(t.price),quantity:t.quantity,weight:"",notes:"Sản phẩm bán kèm"})});const e=this.quickBuySubtotal,s=this.quickBuyShippingFee,o=this.quickBuyTotal,n=this.generateOrderId();this.lastOrderId=n;const a={orderId:n,cart:i,telegramNotification:"VDT_SECRET_2025_ANHIEN",customer:{name:this.customer.name,phone:this.customer.phone,email:this.customer.email,address:this.customer.address,notes:this.quickBuyNotes},orderDate:(new Date).toISOString(),subtotal:this.formatCurrency(e),shipping:0===s?"Miễn phí":this.formatCurrency(s),discount:this.discountAmount>0?`-${this.formatCurrency(this.discountAmount)} (${this.appliedDiscountCode})`:"Không có",total:this.formatCurrency(o),paymentMethod:"cod"===this.quickBuyPaymentMethod?"Thanh toán khi nhận hàng (COD)":"Chuyển khoản ngân hàng"},r="https://hidden-bonus-76d2.yendev96.workers.dev",c=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!c.ok){let t="Có lỗi xảy ra khi gửi đơn hàng.";try{t=(await c.json()).message||t}catch{}throw new Error(t)}this.handleOrderSuccess()}catch(t){console.error("Lỗi quick buy:",t),this.showAlert(`Lỗi đặt hàng: ${t.message}`,"error")}finally{this.isQuickBuySubmitting=!1}}else this.showAlert("Vui lòng xác nhận chuyển khoản trước khi đặt hàng!","error");else this.scrollToFirstQuickBuyError()},clearCart(){this.cart=[],this.selectedCartItems=[],this.resetDiscount()},backToShopping(){this.view="products",this.$nextTick(()=>{document.getElementById("product-list")?.scrollIntoView({behavior:"smooth",block:"start"})})},_normalizeDiscount(t){if(!t)return null;const i=(t.code||"").toUpperCase();let e=t.type;return"free_shipping"===e&&(e="shipping"),"fixed_amount"===e&&(e="fixed"),{code:i,type:e,title:t.title??"",value:Number(t.value||0),minOrder:Number(t.minOrder??t.min_order_value??0),minItems:Number(t.minItems||0),active:!1!==t.active,visible:!1!==t.visible}},applyDiscount(){this.applySelectedDiscount(!1)},resetDiscount(){this.discountCode="",this.appliedDiscountCode="",this.appliedGift=null,this.discountAmount=0,this.discountError=""},openDiscountModal(){this.preventMiniCartCloseOnClickOutside=!0,this.isDiscountModalFromQuickBuy=this.isQuickBuyModalOpen,this.isQuickBuyModalOpen&&(this.preventQuickBuyCloseOnEscape=!0),this.isDiscountModalOpen=!0},closeDiscountModal(){this.isDiscountModalOpen=!1,this.discountError="",this.isDiscountModalFromQuickBuy=!1,this.discountCode=this.appliedDiscountCode,setTimeout(()=>{this.preventMiniCartCloseOnClickOutside=!1,this.preventQuickBuyCloseOnEscape=!1},100)},selectDiscount(t){this.discountCode=t},applySelectedDiscount(t=!1){const i=this.discountCode.trim().toUpperCase();if(!i)return void(this.discountError="Vui lòng nhập hoặc chọn một mã khuyến mãi.");const e=this.availableDiscounts.find(t=>(t.code||"").toUpperCase()===i),s=this._normalizeDiscount(e);if(!s||!s.active)return void(this.discountError="Mã khuyến mãi không hợp lệ hoặc đã hết hạn.");const o=this.isDiscountModalFromQuickBuy,n=o?this.quickBuySubtotal:this.cartSubtotal(),a=o?this.quickBuyQuantity:this.totalCartQuantity;if(n<s.minOrder)return void(this.discountError=`Ưu đãi này chỉ áp dụng cho đơn hàng từ ${this.formatCurrency(s.minOrder)}.`);if(s.minItems&&a<s.minItems)return void(this.discountError=`Ưu đãi này chỉ áp dụng cho đơn hàng có từ ${s.minItems} sản phẩm trở lên.`);let r="";if(this.discountCode&&this.discountCode!==i){const t=this.availableDiscounts.find(t=>t.code?.toUpperCase()===this.discountCode.toUpperCase()),e=t?.title||this.discountCode;r=`Mã ${i} đã được áp dụng. Ưu đãi "${e}" đã được thay thế.`}if(this.resetDiscount(),"gift"===s.type)this.appliedGift={title:s.title,value:s.value};else if(this.appliedDiscountCode=i,"shipping"===s.type);else if("fixed"===s.type)this.discountAmount=s.value;else if("percentage"===s.type){const t=o?this.quickBuySubtotal:this.cartSubtotal();this.discountAmount=Math.floor(t*s.value/100)}const c=o?this.quickBuySubtotal:this.cartSubtotal();this.discountAmount>c&&(this.discountAmount=c),this.discountCode=i,r?this.showAlert(r,"success"):this.showAlert(`Đã áp dụng mã ${i}!`,"success"),t&&this.closeDiscountModal()},revalidateAppliedDiscount(){if((this.appliedDiscountCode||this.appliedGift||this.discountAmount)&&this.appliedDiscountCode){const t=this.availableDiscounts.find(t=>(t.code||"").toUpperCase()===this.appliedDiscountCode),i=this._normalizeDiscount(t);if(!i||!i.active)return void this.resetDiscount();if(this.cartSubtotal()<i.minOrder||i.minItems&&this.totalCartQuantity<i.minItems)return void this.resetDiscount();"percentage"===i.type?this.discountAmount=Math.floor(this.cartSubtotal()*i.value/100):"fixed"===i.type?this.discountAmount=i.value:"shipping"===i.type&&(this.discountAmount=0),this.discountAmount>this.cartSubtotal()&&(this.discountAmount=this.cartSubtotal())}},getDiscountAvailability(t){const i=this._normalizeDiscount(t),e=this.selectedCartProducts.filter(t=>!this.addonProducts.some(i=>i.id===t.id)&&!t.isGift),s=e.reduce((t,i)=>t+i.price*i.quantity,0),o=e.reduce((t,i)=>t+i.quantity,0);return s<i.minOrder?{available:!1,reason:`Cần mua thêm ${this.formatCurrency(i.minOrder-s)} từ sản phẩm chính.`}:i.minItems&&o<i.minItems?{available:!1,reason:`Cần thêm ${i.minItems-o} sản phẩm chính.`}:{available:!0,reason:""}},getDiscountEffectiveValue(t){const i=this._normalizeDiscount(t);switch(i.type){case"fixed":case"addon_discount":return i.value;case"percentage":return Math.floor(this.cartSubtotal()*i.value/100);case"shipping":return this.shippingFee();case"gift":const t=this.products.find(t=>t.sku===i.giftSku);return t?t.price:0;default:return 0}},get sortedDiscounts(){return this.availableDiscounts.filter(t=>t.active&&t.visible).map(t=>{if(this.isDiscountModalFromQuickBuy){const i=this._normalizeDiscount(t),e=i&&this.quickBuySubtotal>=i.minOrder&&(!i.minItems||this.quickBuyQuantity>=i.minItems),s=e?"":this.quickBuySubtotal<i.minOrder?`Cần mua thêm ${this.formatCurrency(i.minOrder-this.quickBuySubtotal)}`:`Cần thêm ${i.minItems-this.quickBuyQuantity} sản phẩm`;return{...t,availability:{available:e,reason:s},effectiveValue:e?this.calculateQuickBuyDiscountValue(i):0}}return{...t,availability:this.getDiscountAvailability(t),effectiveValue:this.getDiscountEffectiveValue(t)}}).sort((t,i)=>t.availability.available&&!i.availability.available?-1:!t.availability.available&&i.availability.available?1:i.effectiveValue-t.effectiveValue)},get isEligibleForAnyDiscount(){return!this.appliedDiscountCode&&!this.appliedGift&&this.hasAnyApplicableDiscounts},openCheckout(){this.weightErrors={};let t=!1,i=null;for(let e=0;e<this.cart.length;e++){const s=this.cart[e];if("addon_moc_chia_khoa"===s.id||"addon_tui_dau_tam"===s.id||this.isAddonProduct(s)||s.beadQuantity)continue;const o=this.isAdultProduct(s);if(!s.weight||""===s.weight.trim()){const e=s.cartId||s.id;this.weightErrors[e]=o?"Vui lòng chọn size tay":"Vui lòng chọn cân nặng bé",t=!0,i||(i=e)}}t&&i?this.scrollToWeightError(i):(console.log("🔍 DEBUG: Opening checkout modal, cart items:"),this.cart.forEach((t,i)=>{console.log(`- Item ${i}:`,{name:t.name,id:t.id,cartId:t.cartId,selectedWeight:t.selectedWeight,weight:t.weight,isAdult:this.isAdultProduct(t)})}),this.socialProofViewers=Math.floor(5*Math.random())+1,this.isCheckoutModalOpen=!0,this.startSocialProofTimer(),this.$nextTick(()=>{setTimeout(()=>{const t=this.$refs.firstInput;t&&!this.customer.name&&t.focus()},300)}))},scrollToWeightError(t){this.$nextTick(()=>{setTimeout(()=>{const i=document.querySelector(`[data-cart-item-id="${t}"]`);if(i){const t=i.querySelector(".cart-item-weight-section")||i,e=t.offsetTop-100,s=document.querySelector(".mini-cart-content");s?s.scrollTo({top:e,behavior:"smooth"}):window.scrollTo({top:e,behavior:"smooth"});const o=t.querySelector(".weight-selector");o&&(o.classList.add("ring-2","ring-red-400","ring-opacity-75"),setTimeout(()=>{o.classList.remove("ring-2","ring-red-400","ring-opacity-75")},2e3))}},100)})},closeCheckoutModal(){console.log("🔍 closeCheckoutModal() được gọi"),console.log("🔍 Trước khi đóng - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 Trước khi đóng - isCheckoutModalOpen:",this.isCheckoutModalOpen),this.isCheckoutModalOpen=!1,this.stopSocialProofTimer(),console.log("🔍 Sau khi đóng - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 Sau khi đóng - isCheckoutModalOpen:",this.isCheckoutModalOpen)},goBackToMiniCart(){console.log("🔍 goBackToMiniCart() được gọi"),console.log("🔍 Trước khi đóng - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 Trước khi đóng - isCheckoutModalOpen:",this.isCheckoutModalOpen),this.isCheckoutModalOpen=!1,this.stopSocialProofTimer(),console.log("🔍 Sau khi đóng - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 Sau khi đóng - isCheckoutModalOpen:",this.isCheckoutModalOpen)},validateAndShowConfirmModal(){this.clearFormErrors(),this.validateForm()&&(this.isConfirmModalOpen=!0)},clearFormErrors(){Object.keys(this.formErrors).forEach(t=>{this.formErrors[t]=""})},validateForm(){let t=!0;if(!this.cart.length)return this.showAlert("Giỏ hàng của bạn đang trống.","error"),!1;for(const t of this.cart)if("hat_dau_tam_mai_san"===t.category&&(!t.beadQuantity||t.beadQuantity<1))return this.showAlert(`Vui lòng chọn số lượng hạt cho sản phẩm "${t.name}" trong giỏ hàng.`,"error"),!1;if(this.customer.name.trim()||(this.formErrors.name="Vui lòng nhập họ và tên",t=!1),this.customer.phone.trim()){/(0[3|5|7|8|9])+([0-9]{8})\b/.test(this.customer.phone)||(this.formErrors.phone="Số điện thoại không hợp lệ",t=!1)}else this.formErrors.phone="Vui lòng nhập số điện thoại",t=!1;return this.selectedProvince||(this.formErrors.province="Vui lòng chọn tỉnh/thành phố",t=!1),this.selectedDistrict||(this.formErrors.district="Vui lòng chọn quận/huyện",t=!1),this.selectedWard||(this.formErrors.ward="Vui lòng chọn phường/xã",t=!1),this.streetAddress.trim()||(this.formErrors.streetAddress="Vui lòng nhập địa chỉ cụ thể",t=!1),this.paymentMethod||(this.formErrors.paymentMethod="Vui lòng chọn phương thức thanh toán",t=!1),t},async confirmAndSubmitOrder(){this.isSubmitting=!0,this.updateFullAddress();const t=this.generateOrderId();this.lastOrderId=t;const i={orderId:t,cart:(()=>{const t=this.cart.map(t=>({name:t.name,price:this.formatCurrency(t.price),quantity:t.quantity,weight:t.weight,notes:t.notes||""}));return this.appliedGift&&t.push({name:this.appliedGift.title,price:"Miễn phí",quantity:1,weight:0,notes:""}),t})(),telegramNotification:"VDT_SECRET_2025_ANHIEN",customer:{name:this.customer.name,phone:this.customer.phone,email:this.customer.email,address:this.customer.address,notes:this.customer.notes},orderDate:(new Date).toISOString(),subtotal:this.formatCurrency(this.cartSubtotal()),shipping:0===this.shippingFee()?this.freeShipping?"Miễn phí (FREESHIP)":"Miễn phí":this.formatCurrency(this.shippingFee()),discount:this.discountAmount>0?`-${this.formatCurrency(this.discountAmount)} (${this.appliedDiscountCode})`:"Không có",total:this.formatCurrency(this.cartTotal()),paymentMethod:"cod"===this.paymentMethod?"Thanh toán khi nhận hàng (COD)":"Chuyển khoản ngân hàng"};try{const t=await fetch("https://hidden-bonus-76d2.yendev96.workers.dev",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!t.ok){let i="Có lỗi xảy ra khi gửi đơn hàng.";try{i=(await t.json()).message||i}catch{}throw new Error(i)}this.cart=[],this.resetDiscount(),this.$nextTick(()=>{this.isSuccessModalOpen=!0})}catch(t){console.error("Lỗi gửi đơn hàng:",t),this.showAlert(`Lỗi gửi đơn hàng: ${t.message}`,"error")}finally{this.isSubmitting=!1}},closeSuccessModal(){console.log("🔍 closeSuccessModal() được gọi"),console.log("🔍 Trước khi đóng success - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 Trước khi đóng success - isCheckoutModalOpen:",this.isCheckoutModalOpen),this.isSuccessModalOpen=!1,this.$nextTick(()=>{console.log("🔍 Trong $nextTick - đóng tất cả modal shopping flow"),this.isConfirmModalOpen=!1,this.isCheckoutModalOpen=!1,this.isMiniCartOpen=!1,this.closeQuickBuyModal(),console.log("🔍 Sau khi đóng trong $nextTick - isMiniCartOpen:",this.isMiniCartOpen),console.log("🔍 Sau khi đóng trong $nextTick - isCheckoutModalOpen:",this.isCheckoutModalOpen)})},continueShoppingAndScroll(){this.closeSuccessModal(),window.scrollTo(0,0)},cleanupAfterOrder(){this.cart=[],this.resetDiscount(),this.view="products",window.scrollTo(0,0)},startNotificationLoop(){const t=["Mai Anh","Thuỳ Linh","Bảo Ngọc","Khánh An","Minh Châu","Gia Hân","Ngọc Diệp","Phương Vy","Thảo Nguyên","Hà My","Tú Anh","Quỳnh Chi","Yến Nhi","Lan Hương","Thanh Trúc","Diệu Linh","Bích Phương","Hoài An","Tường Vy","Kim Ngân"],i=["vừa đặt mua 1 sản phẩm","vừa hoàn tất đơn hàng","vừa mua 2 sản phẩm","đã mua Vòng Dâu Tằm Hạt Gốc","đã mua Vòng Mix Bạc Cho Bé"],e=()=>{if(this.isMiniCartOpen||this.isCheckoutModalOpen)return;const e=t[Math.floor(Math.random()*t.length)],s=i[Math.floor(Math.random()*i.length)];this.notification.message=`${e} ${s}`,this.notification.visible=!0,setTimeout(()=>{this.notification.visible=!1},4e3)};setTimeout(()=>{e();const t=Math.floor(7001*Math.random())+8e3;setInterval(e,t)},5e3)},startSocialProofLoop(){const t=()=>{this.socialProofCount=Math.floor(4*Math.random())+2;const i=Math.floor(4001*Math.random())+3e3;setTimeout(t,i)};setTimeout(t,2500)},startFreeshipCountdown(){(!this.freeshipOfferEndTime||this.freeshipOfferEndTime<Date.now())&&(this.freeshipOfferEndTime=Date.now()+72e5),this.countdownTimer.interval&&clearInterval(this.countdownTimer.interval),this.countdownTimer.interval=setInterval(()=>{const t=this.freeshipOfferEndTime-Date.now();if(t<=0)return this.countdownTimer.display="00 : 00 : 00",void(this.freeshipOfferEndTime=Date.now()+72e5);const i=Math.floor(t/36e5%24),e=Math.floor(t/1e3/60%60),s=Math.floor(t/1e3%60);this.countdownTimer.display=`${i.toString().padStart(2,"0")} : ${e.toString().padStart(2,"0")} : ${s.toString().padStart(2,"0")}`},1e3)},openProductDetail(t){if(this.currentProductDetail=t,this.productDetailQuantity=1,this.productDetailViewers=Math.floor(5*Math.random())+1,this.sharedDetails){const i=t.category;this.productDetailContent=this.sharedDetails[i]||this.sharedDetails.default_vong_dau_tam}else this.productDetailContent=null;this.isProductDetailOpen=!0,document.body.style.overflow="hidden",this.startProductDetailViewersTimer()},closeProductDetail(){console.log("🔍 closeProductDetail() được gọi"),console.log("🔍 - isProductDetailOpen trước:",this.isProductDetailOpen),console.log("🔍 - isQuickBuyModalOpen:",this.isQuickBuyModalOpen),console.log("🔍 - isDiscountModalOpen:",this.isDiscountModalOpen),console.trace("🔍 Stack trace cho closeProductDetail"),this.isProductDetailOpen=!1,this.isQuickBuyModalOpen||this.isDiscountModalOpen||this.isMiniCartOpen||this.isCheckoutModalOpen||this.isAddonDetailModalOpen?(console.log("🔍 - Vẫn có modal khác mở, giữ overflow = hidden"),console.log("🔍 - isQuickBuyModalOpen:",this.isQuickBuyModalOpen),console.log("🔍 - isDiscountModalOpen:",this.isDiscountModalOpen),console.log("🔍 - isMiniCartOpen:",this.isMiniCartOpen)):(console.log("🔍 - Không có modal nào khác, restore overflow = auto"),document.body.style.overflow="auto"),this.stopProductDetailViewersTimer(),setTimeout(()=>{this.currentProductDetail=null,this.productDetailQuantity=1,this.productDetailSelectedAddons=[]},300),console.log("🔍 - isProductDetailOpen sau:",this.isProductDetailOpen)},addProductDetailToCart(){this.currentProductDetail&&(this.isAddonProduct(this.currentProductDetail)?(this.addAddonToCart(this.currentProductDetail),this.closeProductDetail(),this.showAlert("Đã thêm sản phẩm vào giỏ hàng!","success")):this.handleProductClick(this.currentProductDetail))},buyProductDetailNow(){if(this.currentProductDetail){if(this.isAddonProduct(this.currentProductDetail))return this.addAddonToCart(this.currentProductDetail),void this.closeProductDetail();this.quickBuySelectedAddons=[...this.productDetailSelectedAddons],this.buyNow(this.currentProductDetail)}},startProductDetailViewersTimer(){this.stopProductDetailViewersTimer(),this.productDetailViewersTimer=setInterval(()=>{const t=Math.floor(3*Math.random())-1,i=this.productDetailViewers+t;this.productDetailViewers=Math.max(1,Math.min(5,i))},3e3+4e3*Math.random())},stopProductDetailViewersTimer(){this.productDetailViewersTimer&&(clearInterval(this.productDetailViewersTimer),this.productDetailViewersTimer=null)},openQuickView(t){this.openProductDetail(t)},closeQuickView(){this.isQuickViewOpen=!1,this.isMiniCartOpen||(document.body.style.overflow="auto"),setTimeout(()=>{this.quickViewProduct=null},300)},revalidateQuickBuyDiscount(){if(this.isQuickBuyModalOpen&&(this.appliedDiscountCode||this.appliedGift)){if(this.appliedDiscountCode){const t=this.availableDiscounts.find(t=>(t.code||"").toUpperCase()===this.appliedDiscountCode),i=this._normalizeDiscount(t);if(console.log("🔍 Checking discount:",this.appliedDiscountCode),console.log("- promotion:",i),console.log("- quickBuySubtotal:",this.quickBuySubtotal),console.log("- minOrder:",i?.minOrder),!i||!i.active)return console.log("🔍 Discount invalid - resetting"),this.resetDiscount(),void this.showAlert("Mã giảm giá đã hết hạn và được gỡ bỏ.","info");const e=this.quickBuySubtotal>=i.minOrder,s=!i.minItems||this.quickBuyQuantity>=i.minItems;if(console.log("🔍 Condition checks:"),console.log("- subtotalCheck:",e,`(${this.quickBuySubtotal} >= ${i.minOrder})`),console.log("- itemsCheck:",s,`(${this.quickBuyQuantity} >= ${i.minItems||"no requirement"})`),!e||!s){const t=i.title||i.code;return console.log("🔍 Discount not eligible - resetting"),this.resetDiscount(),void this.showAlert(`Ưu đãi "${t}" đã được gỡ bỏ vì không còn đủ điều kiện.`,"info")}"percentage"===i.type?this.discountAmount=Math.floor(this.quickBuySubtotal*i.value/100):"fixed"===i.type&&(this.discountAmount=i.value),this.discountAmount>this.quickBuySubtotal&&(this.discountAmount=this.quickBuySubtotal)}}else console.log("🔍 Revalidate skipped - no modal or no discount")},validateAddressConsistency(){!this.customer.address||this.selectedProvince&&this.selectedDistrict&&this.selectedWard||(this.customer.address=""),this.selectedProvince&&this.selectedDistrict&&this.selectedWard&&this.streetAddress&&this.updateFullAddress()},requiresBabyName(t){return!(!t||!t.name)&&this.babyNameRequiredProducts.some(i=>t.name.toLowerCase().includes(i.toLowerCase())||i.toLowerCase().includes(t.name.toLowerCase()))},openBabyNameModal(t){this.babyNameProductInfo={id:t.id,name:t.name,price:t.price},this.pendingBabyNameProduct=t,this.babyNameInput="",this.babyNameError="",this.isBabyNameModalOpen=!0},closeBabyNameModal(){this.isBabyNameModalOpen=!1,this.babyNameInput="",this.babyNameError="",this.babyNameProductInfo={},this.pendingBabyNameProduct=null},validateBabyName(){this.babyNameError="";const t=this.babyNameInput.trim();if(!t)return this.babyNameError="Vui lòng nhập tên bé cần khắc",!1;if(t.length<2)return this.babyNameError="Tên bé phải có ít nhất 2 ký tự",!1;if(t.length>50)return this.babyNameError="Tên bé không được quá 50 ký tự",!1;return!/[<>{}[\]\\\/]/.test(t)||(this.babyNameError="Tên bé không được chứa ký tự đặc biệt như < > { } [ ] \\ /",!1)},confirmBabyName(){if(!this.validateBabyName())return;if(!this.pendingBabyNameProduct)return void this.showAlert("Có lỗi xảy ra, vui lòng thử lại","error");const t=this.pendingBabyNameProduct,i=this.babyNameInput.trim(),e={...t,babyName:i,notes:`Khắc tên: ${i}`,weight:"N/A",selectedWeight:"N/A",cartId:`${t.id}-${Date.now()}`,quantity:1,basePrice:t.price,finalPrice:t.price,displayName:`${t.name} - Khắc tên: ${i}`};this.addToCart(e),this.closeBabyNameModal(),this.showAlert(`Đã thêm ${t.name} với tên "${i}" vào giỏ hàng!`,"success"),this.isProductDetailOpen&&this.closeProductDetail()}}))});