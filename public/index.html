<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vòng Dâu Tằm An Nhiên</title>
    <!-- Optimized CSS - TailwindCSS + Custom styles minified -->
    <link rel="stylesheet" href="./assets/css/styles.min.css">

    <!-- Alpine.js for interactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-50 font-sans" x-data="shop" x-cloak>

    <div class="container mx-auto p-2">

        <!-- Modal Thông Báo - Compact Design -->
        <div
            x-show="isAlertModalOpen"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 transform translate-y-[-10px]"
            x-transition:enter-end="opacity-100 transform translate-y-0"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 transform translate-y-0"
            x-transition:leave-end="opacity-0 transform translate-y-[-10px]"
            class="fixed top-4 left-1/2 -translate-x-1/2 sm:left-auto sm:translate-x-0 sm:right-4 z-[10002] w-11/12 max-w-sm"
        >
            <div class="bg-white/95 backdrop-blur-sm rounded-lg shadow-lg border overflow-hidden"
                 :class="{
                   'border-green-200 bg-green-50/95': alertModalType === 'success',
                   'border-red-200 bg-red-50/95': alertModalType === 'error',
                   'border-blue-200 bg-blue-50/95': alertModalType === 'info'
                 }">
                <div class="px-3 py-2 flex items-center space-x-2">
                    <!-- Compact Icon -->
                    <div class="flex-shrink-0">
                        <div x-show="alertModalType === 'success'" class="w-5 h-5 bg-green-500 rounded-full flex items-center justify-center">
                            <svg class="h-3 w-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                        <div x-show="alertModalType === 'error'" class="w-5 h-5 bg-red-500 rounded-full flex items-center justify-center">
                            <svg class="h-3 w-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </div>
                        <div x-show="alertModalType === 'info'" class="w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center">
                            <svg class="h-3 w-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                    <!-- Compact Message -->
                    <div class="flex-1 min-w-0">
                        <p class="text-xs font-medium truncate"
                           :class="{
                             'text-green-700': alertModalType === 'success',
                             'text-red-700': alertModalType === 'error',
                             'text-blue-700': alertModalType === 'info'
                           }"
                           x-text="alertModalMessage"></p>
                    </div>
                    <!-- Compact Close Button -->
                    <button @click="isAlertModalOpen = false" class="flex-shrink-0 p-0.5 rounded hover:bg-gray-200/50 transition-colors">
                        <svg class="h-3 w-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Shop Profile Section - Mom-Friendly WOW Design -->
		<div x-show="!loading && !error && view === 'products'" class="mb-6 sm:mb-8">
			<div class="relative rounded-2xl overflow-hidden shadow-lg">
				<div class="h-56 sm:h-64 w-full bg-cover bg-center" style="background-image: url('./assets/images/product_img/tat-ca-mau.webp');"></div>
				<div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/35 to-transparent"></div>
				<div class="absolute inset-0 p-3 sm:p-4 flex flex-col justify-between">
					<!-- Search overlay -->
					<div class="flex justify-center">
						<div class="relative w-full max-w-md">
							<input type="text" x-model="searchQuery" @keydown.enter="performSearch()" placeholder="Tìm kiếm sản phẩm trong Shop"
								   class="w-full h-9 pl-9 pr-10 rounded-full bg-white/85 text-gray-800 placeholder-gray-500 shadow focus:outline-none focus:ring-2 focus:ring-pink-300">
							<svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
							</svg>
							<button @click="performSearch()" class="absolute right-1 top-1/2 -translate-y-1/2 w-7 h-7 rounded-full bg-gradient-to-r from-pink-500 to-rose-500 text-white flex items-center justify-center shadow">
								<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
							</button>
						</div>
					</div>

					<!-- Shop info row -->
					<div class="flex items-center gap-3 sm:gap-4 mt-3">
						<img src="./assets/images/profile_img.webp" :alt="shopInfo.shop_name" class="w-12 h-12 sm:w-14 sm:h-14 rounded-full border-2 border-white shadow object-cover" loading="lazy">
						<div class="min-w-0">
							<div class="flex items-center gap-1 text-white">
								<h2 class="font-bold text-base sm:text-lg truncate" x-text="shopInfo.shop_name"></h2>
							</div>
							<div class="flex items-center gap-2 text-[11px] sm:text-xs text-white/90 mt-0.5">
								<span class="inline-flex items-center gap-0.5"><span>⭐</span><span>5.0</span></span>
								<span class="opacity-70">|</span>
								<span x-text="(shopInfo.stats && shopInfo.stats.followers) ? (shopInfo.stats.followers + ' Người theo dõi') : 'Đang cập nhật'"></span>
								<span class="opacity-70">|</span>
								<span x-text="(shopInfo.stats && shopInfo.stats.likes) ? (shopInfo.stats.likes + ' Thích') : ''"></span>
							</div>
						</div>
					</div>
				</div>
			</div>
        </div>

        <!-- Tab Navigation Section -->
        <div x-show="!loading && !error && view === 'products'" class="mb-6">
            <div class="bg-white rounded-2xl shadow-md border border-gray-100 overflow-hidden">
                <!-- Tab Headers -->
                <div class="flex bg-gradient-to-r from-gray-50 to-gray-100">

                    <button @click="scrollToCategories(); activeTab = 'categories'"
                            :class="activeTab === 'categories' ? 'bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg' : 'text-gray-600 hover:text-pink-600 hover:bg-white'"
                            class="flex-1 px-4 py-4 text-center font-semibold transition-all duration-300 relative group">
                        <div class="flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                            <span class="text-sm sm:text-base">Danh Mục SP</span>
                        </div>
                        <!-- Active indicator -->
                        <div x-show="activeTab === 'categories'" class="absolute bottom-0 left-0 right-0 h-1 bg-white rounded-t-full"></div>
                    </button>

                    <button @click="scrollToTopProducts(); activeTab = 'top10'"
                            :class="activeTab === 'top10' ? 'bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg' : 'text-gray-600 hover:text-pink-600 hover:bg-white'"
                            class="flex-1 px-4 py-4 text-center font-semibold transition-all duration-300 relative group">
                        <div class="flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                            </svg>
                            <span class="text-sm sm:text-base">Top 10 bán chạy</span>
                        </div>
                        <!-- Active indicator -->
                        <div x-show="activeTab === 'top10'" class="absolute bottom-0 left-0 right-0 h-1 bg-white rounded-t-full"></div>
                    </button>
                </div>

            </div>
        </div>

        <!-- Loading State -->
        <div x-show="loading" class="text-center py-12">
            <div class="loading-spinner rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"
                 style="animation: custom-spin 1s linear infinite; transform-origin: center;"></div>
            <p class="text-gray-600">Đang tải dữ liệu...</p>
        </div>

        <!-- Error State -->
        <div x-show="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
            <p x-text="error"></p>
        </div>

        <!-- New Floating Action Buttons -->
        <div class="fixed right-4 bottom-20 z-40 flex flex-col items-end space-y-3">
            <!-- Categories Badge -->
            <button @click="scrollToCategories()"
                    class="group bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white rounded-full shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center
                           w-8 h-8 justify-center sm:w-auto sm:h-auto sm:px-4 sm:py-2 sm:space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                </svg>
                <span class="hidden sm:inline text-sm font-medium whitespace-nowrap">Danh mục SP</span>
            </button>

            <!-- FAQ Button -->
            <button @click="openFaqModal()"
                    class="group bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white rounded-full shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center
                           w-8 h-8 justify-center sm:w-auto sm:h-auto sm:px-4 sm:py-2 sm:space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="hidden sm:inline text-sm font-medium">Hỏi đáp</span>
            </button>

            <!-- Zalo Button -->
            <a href="https://zalo.me/0972483892" target="_blank" rel="noopener noreferrer"
               class="group bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center
                      w-8 h-8 justify-center sm:w-auto sm:h-auto sm:px-4 sm:py-2 sm:space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4 sm:h-5 sm:w-5">
                    <path d="M3.505 2.365A41.369 41.369 0 0 1 9 2c1.863 0 3.697.124 5.495.365 1.247.167 2.18 1.108 2.435 2.268a4.45 4.45 0 0 0-.577-.069 43.141 43.141 0 0 0-4.706 0C9.229 4.696 7.5 6.727 7.5 8.998v2.24c0 1.413.67 2.735 1.76 3.562l-2.98 2.98A.75.75 0 0 1 5 17.25v-3.443c-.501-.048-1-.106-1.495-.172C2.033 13.438 1 12.162 1 10.72V5.28c0-1.441 1.033-2.717 2.505-2.914Z" />
                    <path d="M14 6c-.762 0-1.52.02-2.271.062C10.157 6.148 9 7.472 9 8.998v2.24c0 1.519 1.147 2.839 2.71 2.935.214.013.428.024.642.034.2.009.385.09.518.224l2.35 2.35a.75.75 0 0 0 1.28-.531v-2.07c1.453-.195 2.5-1.463 2.5-2.915V8.998c0-1.526-1.157-2.85-2.729-2.936A41.645 41.645 0 0 0 14 6Z" />
                </svg>
                <span class="hidden sm:inline text-sm font-medium">Zalo</span>
            </a>
        </div>

        <!-- Mobile Product View Bar -->
        <div x-show="view === 'products' && trueTotalCartQuantity > 0"
             class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] p-2 z-40"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-full"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform translate-y-0"
             x-transition:leave-end="opacity-0 transform translate-y-full">
            <div class="container mx-auto">
                <div class="flex items-center justify-between flex-wrap">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-7 w-7 text-pink-600">
                                <path d="M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z" />
                                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div>
                            <p class="font-bold text-base text-pink-600" x-text="formatCurrency(cartTotal())"></p>
                        </div>
                    </div>
                    <button @click="toggleMiniCart()" class="bg-pink-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-pink-700 transition-colors shadow-md text-sm flex items-center space-x-2">
                        <div class="relative">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19H16.16a1.75 1.75 0 0 0 1.743-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5ZM7.5 10a2.5 2.5 0 0 0 5 0V8.75a.75.75 0 0 1 1.5 0V10a4 4 0 0 1-8 0V8.75a.75.75 0 0 1 1.5 0V10Z" clip-rule="evenodd" />
                            </svg>
                            <!-- Plus Icon Overlay -->
                            <div class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-white text-pink-600 rounded-full flex items-center justify-center text-xs font-bold">
                                +
                            </div>
                        </div>
                        <span x-text="`Xem giỏ hàng (${trueTotalCartQuantity})`"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Featured Products & Combos Section -->
        <div x-show="!loading && !error && view === 'products'" class="mb-8">
            <!-- Section Title -->
            <div class="text-center mb-14">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Combo Bán Chạy</h2>
                <p class="text-gray-500 mt-2">Các combo sản phẩm được ưa chuộng nhất với giá ưu đãi</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 2xl:grid-cols-4 gap-10 sm:gap-6 md:gap-8">


                <!-- Box 2: Combo Vòng Trơn + Túi -->
                <div class="group relative bg-gradient-to-br from-pink-50 to-rose-100 rounded-2xl border border-pink-100">
                    <!-- Sales Badge - Top Center -->
                    <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 z-30">
                        <div class="bg-gradient-to-r from-pink-500 to-rose-500 text-white px-3 py-1.5 rounded-full shadow-lg border-2 border-white">
                            <div class="flex items-center space-x-1">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                </svg>
                                <span class="text-xs font-bold">3.682+ lượt bán</span>
                            </div>
                        </div>
                    </div>

                    <!-- Discount Badge -->
                    <div class="absolute top-2 right-2 z-10">
                        <div class="bg-gradient-to-r from-red-500 to-pink-500 text-white text-[10px] sm:text-xs font-bold px-2 py-1 rounded-full shadow-lg">
                            <div class="flex items-center space-x-0.5">
                                <span>-19%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Product Images -->
                    <div class="p-4 pt-6 pb-2">
                        <div class="flex items-start justify-center space-x-2 mb-3">
                            <!-- Vòng Trơn Image -->
                            <div class="flex flex-col items-center">
                                <div class="relative cursor-pointer bg-gradient-to-br from-pink-50 to-rose-50 rounded-xl" @click="openComboImageModal('vong_tron_tui')">
                                    <img src="./assets/images/product_img/vong_tron_co_dien_day_do.webp" alt="Vòng Dâu Tằm Trơn"
                                         class="w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-xl border-2 border-white shadow-md hover:scale-105 transition-transform" loading="lazy">

                                    <!-- Zoom Icon -->
                                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 rounded-xl flex items-center justify-center transition-all">
                                        <svg class="w-4 h-4 text-white opacity-0 hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="text-pink-600 font-semibold text-xs mt-1">89.000đ</div>
                            </div>

                            <!-- Plus Icon -->
                            <div class="text-pink-500 font-bold text-lg self-center">+</div>

                            <!-- Túi Image -->
                            <div class="flex flex-col items-center">
                                <div class="relative cursor-pointer bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl" @click="openComboImageModal('vong_tron_tui')">
                                    <img src="./assets/images/product_img/tui_dau_tam.webp" alt="Túi Dâu Tằm"
                                         class="w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-xl border-2 border-white shadow-md hover:scale-105 transition-transform" loading="lazy">

                                    <!-- Zoom Icon -->
                                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 rounded-xl flex items-center justify-center transition-all">
                                        <svg class="w-4 h-4 text-white opacity-0 hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="text-pink-600 font-semibold text-xs mt-1">59.000đ</div>
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="px-4 pb-4">
                        <h3 class="font-bold text-gray-800 text-base sm:text-lg mb-2 text-center">
                            Vòng Trơn Cổ Điển + Túi Dâu Tằm Để Giường
                        </h3>

                        <!-- Price -->
                        <div class="text-center mb-3">
                            <div class="flex items-center justify-center space-x-2 mb-1">
                                <span class="text-gray-400 line-through text-sm">148.000đ</span>
                                <span class="text-pink-600 font-bold text-lg">120.000đ</span>
                            </div>
                            <div class="text-green-600 text-xs font-medium">
                                ✓ Freeship + Mã giảm giá
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-2">
                            <!-- Chi tiết Button -->
                            <button @click="openComboImageModal('vong_tron_tui')"
                                    class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                    <span class="text-sm sm:text-base">Chi tiết</span>
                                </div>
                            </button>

                            <!-- Mua ngay Button -->
                            <button @click="buyCombo('vong_tron_tui', 'Combo Vòng Trơn + Túi Dâu Tằm', 120000)"
                                    class="flex-1 combo-buy-button bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                        <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19H16.16a1.75 1.75 0 0 0 1.743-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5ZM7.5 10a2.5 2.5 0 0 0 5 0V8.75a.75.75 0 0 1 1.5 0V10a4 4 0 0 1-8 0V8.75a.75.75 0 0 1 1.5 0V10Z" clip-rule="evenodd" />
                                    </svg>
                                    <span class="text-sm sm:text-base">Mua ngay</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Box 1: Combo Vòng Co Giãn + Túi -->
                <div class="group relative bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl border border-blue-100">
                    <!-- Sales Badge - Top Center -->
                    <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 z-30">
                        <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-3 py-1.5 rounded-full shadow-lg border-2 border-white">
                            <div class="flex items-center space-x-1">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                </svg>
                                <span class="text-xs font-bold">2.847+ lượt bán</span>
                            </div>
                        </div>
                    </div>

                    <!-- Discount Badge -->
                    <div class="absolute top-2 right-2 z-10">
                        <div class="bg-gradient-to-r from-red-500 to-pink-500 text-white text-[10px] sm:text-xs font-bold px-2 py-1 rounded-full shadow-lg">
                            <div class="flex items-center space-x-0.5">
                                <span>-20%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Product Images -->
                    <div class="p-4 pt-6 pb-2">
                        <div class="flex items-start justify-center space-x-2 mb-3">
                            <!-- Vòng Co Giãn Image -->
                            <div class="flex flex-col items-center">
                                <div class="relative cursor-pointer bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg" @click="openComboImageModal('vong_co_gian_tui')">
                                    <img src="./assets/images/product_img/co gian/vong_tron_co_gian.webp" alt="Vòng dâu tằm trơn co giãn"
                                         class="w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-lg shadow-md" loading="lazy">
                                </div>
                                <div class="text-pink-600 font-semibold text-xs mt-1">89.000đ</div>
                            </div>
                            <div class="flex items-center h-full pt-8 sm:pt-10">
                                <span class="text-gray-500 font-bold text-lg">+</span>
                            </div>
                            <!-- Túi Dâu Tằm Image -->
                            <div class="flex flex-col items-center">
                                <div class="relative cursor-pointer bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg" @click="openComboImageModal('vong_co_gian_tui')">
                                    <img src="./assets/images/product_img/tui_dau_tam.webp" alt="Túi dâu tằm để giường"
                                         class="w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-lg shadow-md" loading="lazy">
                                </div>
                                <div class="text-pink-600 font-semibold text-xs mt-1">59.000đ</div>
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="px-4 pb-4">
                        <h3 class="font-bold text-gray-800 text-base sm:text-lg mb-2 text-center">
                            Vòng dâu tằm trơn co giãn + Túi dâu tằm để giường
                        </h3>

                        <!-- Price -->
                        <div class="text-center mb-3">
                            <div class="flex items-center justify-center space-x-2 mb-1">
                                <span class="text-gray-400 line-through text-sm">148.000đ</span>
                                <span class="text-pink-600 font-bold text-lg">120.000đ</span>
                            </div>
                            <div class="text-green-600 text-xs font-medium">
                                ✓ Freeship + Mã giảm giá
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-2">
                            <!-- Chi tiết Button -->
                            <button @click="openComboImageModal('vong_co_gian_tui')"
                                    class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                    <span class="text-sm sm:text-base">Chi tiết</span>
                                </div>
                            </button>

                            <!-- Mua ngay Button -->
                            <button @click="buyCombo('vong_co_gian_tui', 'Combo Vòng dâu tằm trơn co giãn + Túi dâu tằm để giường', 109000)"
                                    class="flex-1 combo-buy-button bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                        <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19H16.16a1.75 1.75 0 0 0 1.743-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5ZM7.5 10a2.5 2.5 0 0 0 5 0V8.75a.75.75 0 0 1 1.5 0V10a4 4 0 0 1-8 0V8.75a.75.75 0 0 1 1.5 0V10Z" clip-rule="evenodd" />
                                    </svg>
                                    <span class="text-sm sm:text-base">Mua ngay</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>


                <!-- Box 3: Combo 7 Bi Bạc + Túi -->
                <div class="group relative bg-gradient-to-br from-purple-50 to-violet-100 rounded-2xl border border-purple-100">
                    <!-- Sales Badge - Top Center -->
                    <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 z-30">
                        <div class="bg-gradient-to-r from-purple-500 to-violet-500 text-white px-3 py-1.5 rounded-full shadow-lg border-2 border-white">
                            <div class="flex items-center space-x-1">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                </svg>
                                <span class="text-xs font-bold">1.982+ lượt bán</span>
                            </div>
                        </div>
                    </div>

                    <!-- Discount Badge -->
                    <div class="absolute top-2 right-2 z-10">
                        <div class="bg-gradient-to-r from-red-500 to-purple-500 text-white text-[10px] sm:text-xs font-bold px-2 py-1 rounded-full shadow-lg">
                            <div class="flex items-center space-x-0.5">
                                <span>-17%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Product Images -->
                    <div class="p-4 pt-6 pb-2">
                        <div class="flex items-start justify-center space-x-2 mb-3">
                            <!-- Vòng 7 Bi Bạc Image -->
                            <div class="flex flex-col items-center">
                                <div class="relative cursor-pointer bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl" @click="openComboImageModal('vong_7_bi_bac_tui')">
                                    <img src="./assets/images/product_img/Sole bac/vong_dau_tam_7_bi_bac.webp" alt="Vòng 7 Bi Bạc"
                                         class="w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-xl border-2 border-white shadow-md hover:scale-105 transition-transform" loading="lazy">

                                    <!-- Zoom Icon -->
                                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 rounded-xl flex items-center justify-center transition-all">
                                        <svg class="w-4 h-4 text-white opacity-0 hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="text-purple-600 font-semibold text-xs mt-1">219.000đ</div>
                            </div>

                            <!-- Plus Icon -->
                            <div class="text-purple-500 font-bold text-lg self-center">+</div>

                            <!-- Túi Image -->
                            <div class="flex flex-col items-center">
                                <div class="relative cursor-pointer bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl" @click="openComboImageModal('vong_7_bi_bac_tui')">
                                    <img src="./assets/images/product_img/tui_dau_tam.webp" alt="Túi Dâu Tằm"
                                         class="w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-xl border-2 border-white shadow-md hover:scale-105 transition-transform" loading="lazy">

                                    <!-- Zoom Icon -->
                                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 rounded-xl flex items-center justify-center transition-all">
                                        <svg class="w-4 h-4 text-white opacity-0 hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="text-purple-600 font-semibold text-xs mt-1">59.000đ</div>
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="px-4 pb-4">
                        <h3 class="font-bold text-gray-800 text-base sm:text-lg mb-2 text-center">
                            Vòng 7 Bi Bạc (Bé trai) + Túi Dâu Tằm Để Giường
                        </h3>

                        <!-- Price -->
                        <div class="text-center mb-3">
                            <div class="flex items-center justify-center space-x-2 mb-1">
                                <span class="text-gray-400 line-through text-sm">278.000đ</span>
                                <span class="text-purple-600 font-bold text-lg">230.000đ</span>
                            </div>
                            <div class="text-green-600 text-xs font-medium">
                                ✓ Freeship + Mã giảm giá
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-2">
                            <!-- Chi tiết Button -->
                            <button @click="openComboImageModal('vong_7_bi_bac_tui')"
                                    class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                    <span class="text-sm sm:text-base">Chi tiết</span>
                                </div>
                            </button>

                            <!-- Mua ngay Button -->
                            <button @click="buyCombo('vong_7_bi_bac_tui', 'Combo 7 Bi Bạc + Túi Dâu Tằm', 230000)"
                                    class="flex-1 combo-buy-button bg-gradient-to-r from-purple-500 to-violet-500 hover:from-purple-600 hover:to-violet-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                        <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19H16.16a1.75 1.75 0 0 0 1.743-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5ZM7.5 10a2.5 2.5 0 0 0 5 0V8.75a.75.75 0 0 1 1.5 0V10a4 4 0 0 1-8 0V8.75a.75.75 0 0 1 1.5 0V10Z" clip-rule="evenodd" />
                                    </svg>
                                    <span class="text-sm sm:text-base">Mua ngay</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Box 4: Combo 9 Bi Bạc + Túi -->
                <div class="group relative bg-gradient-to-br from-amber-50 to-orange-100 rounded-2xl border border-amber-100">
                    <!-- Sales Badge - Top Center -->
                    <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 z-30">
                        <div class="bg-gradient-to-r from-amber-500 to-orange-500 text-white px-3 py-1.5 rounded-full shadow-lg border-2 border-white">
                            <div class="flex items-center space-x-1">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                </svg>
                                <span class="text-xs font-bold">1.573+ lượt bán</span>
                            </div>
                        </div>
                    </div>

                    <!-- Discount Badge -->
                    <div class="absolute top-2 right-2 z-10">
                        <div class="bg-gradient-to-r from-red-500 to-orange-500 text-white text-[10px] sm:text-xs font-bold px-2 py-1 rounded-full shadow-lg">
                            <div class="flex items-center space-x-0.5">
                                <span>-17%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Product Images -->
                    <div class="p-4 pt-6 pb-2">
                        <div class="flex items-start justify-center space-x-2 mb-3">
                            <!-- Vòng 9 Bi Bạc Image -->
                            <div class="flex flex-col items-center">
                                <div class="relative cursor-pointer bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl" @click="openComboImageModal('vong_9_bi_bac_tui')">
                                    <img src="./assets/images/product_img/Sole bac/vong_dau_tam_9_bi_bac.webp" alt="Vòng 9 Bi Bạc"
                                         class="w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-xl border-2 border-white shadow-md hover:scale-105 transition-transform" loading="lazy">

                                    <!-- Zoom Icon -->
                                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 rounded-xl flex items-center justify-center transition-all">
                                        <svg class="w-4 h-4 text-white opacity-0 hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="text-amber-600 font-semibold text-xs mt-1">289.000đ</div>
                            </div>

                            <!-- Plus Icon -->
                            <div class="text-amber-500 font-bold text-lg self-center">+</div>

                            <!-- Túi Image -->
                            <div class="flex flex-col items-center">
                                <div class="relative cursor-pointer bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl" @click="openComboImageModal('vong_9_bi_bac_tui')">
                                    <img src="./assets/images/product_img/tui_dau_tam.webp" alt="Túi Dâu Tằm"
                                         class="w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-xl border-2 border-white shadow-md hover:scale-105 transition-transform" loading="lazy">

                                    <!-- Zoom Icon -->
                                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 rounded-xl flex items-center justify-center transition-all">
                                        <svg class="w-4 h-4 text-white opacity-0 hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="text-amber-600 font-semibold text-xs mt-1">59.000đ</div>
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="px-4 pb-4">
                        <h3 class="font-bold text-gray-800 text-base sm:text-lg mb-2 text-center">
                            Vòng 9 Bi Bạc (Bé gái) + Túi Dâu Tằm Để Giường
                        </h3>

                        <!-- Price -->
                        <div class="text-center mb-3">
                            <div class="flex items-center justify-center space-x-2 mb-1">
                                <span class="text-gray-400 line-through text-sm">348.000đ</span>
                                <span class="text-amber-600 font-bold text-lg">290.000đ</span>
                            </div>
                            <div class="text-green-600 text-xs font-medium">
                                ✓ Freeship + Mã giảm giá
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-2">
                            <!-- Chi tiết Button -->
                            <button @click="openComboImageModal('vong_9_bi_bac_tui')"
                                    class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                    <span class="text-sm sm:text-base">Chi tiết</span>
                                </div>
                            </button>

                            <!-- Mua ngay Button -->
                            <button @click="buyCombo('vong_9_bi_bac_tui', 'Combo 9 Bi Bạc + Túi Dâu Tằm', 290000)"
                                    class="flex-1 combo-buy-button bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                        <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19H16.16a1.75 1.75 0 0 0 1.743-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5ZM7.5 10a2.5 2.5 0 0 0 5 0V8.75a.75.75 0 0 1 1.5 0V10a4 4 0 0 1-8 0V8.75a.75.75 0 0 1 1.5 0V10Z" clip-rule="evenodd" />
                                    </svg>
                                    <span class="text-sm sm:text-base">Mua ngay</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <main>
            <!-- Products View -->
            <div x-show="!loading && !error && view === 'products'" :class="{'view-hidden': view !== 'products'}">

                <!-- Section Title: Categories -->
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800">Khu Vườn Sản Phẩm</h2>
                    <p class="text-gray-500 mt-2">Khám phá thế giới vòng dâu cho bé yêu của mẹ</p>
                </div>

                <!-- Category Filters -->
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4 mb-8">
                    <template x-for="category in categories" :key="category.id">
                        <div @click="selectCategory(category)"
                             class="category-card relative flex items-center bg-white rounded-2xl shadow-sm overflow-hidden cursor-pointer border transition-all duration-300"
                             :class="{ 'border-pink-500 shadow-md': currentCategory.id === category.id, 'border-gray-200 hover:border-pink-400': currentCategory.id !== category.id }">

                            <!-- Badge "Phổ biến" -->
                            <div x-show="category.isPopular" class="absolute top-2 right-2 z-10">
                                <div class="popular-badge bg-gradient-to-r from-pink-500 to-purple-500 text-white text-[10px] sm:text-xs font-bold px-2 py-1 rounded-full shadow-lg">
                                    <div class="flex items-center space-x-1">
                                        <svg class="w-2.5 h-2.5 sm:w-3 sm:h-3" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                        </svg>
                                        <span>Phổ biến</span>
                                    </div>
                                </div>
                            </div>

                            <img :src="category.image || './assets/images/demo.webp'" :alt="category.name" class="w-16 h-16 object-cover flex-shrink-0 rounded-l-2xl" loading="lazy">
                            <div class="p-3 flex-grow">
                                <h4 class="font-semibold text-sm text-gray-800 leading-tight"
                                    :class="{ 'pr-20 sm:pr-24': category.isPopular, 'pr-2': !category.isPopular }"
                                    x-text="category.name"></h4>
                                <div class="flex items-center space-x-2 text-xs text-gray-500 mt-1">
                                    <span class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-3.5 w-3.5 mr-0.5 text-blue-500">
                                            <path d="M19.5 21a3 3 0 0 0 3-3v-4.5a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3V18a3 3 0 0 0 3 3h15ZM1.5 10.146V6a3 3 0 0 1 3-3h5.379a2.25 2.25 0 0 1 1.59.659l2.122 2.121c.14.141.331.22.53.22H19.5a3 3 0 0 1 3 3v1.146A4.483 4.483 0 0 0 19.5 9h-15a4.483 4.483 0 0 0-3 1.146Z" />
                                        </svg>&nbsp;
                                        <span x-text="category.id === 'all' ? products.length : getProductCount(category.id)"></span>&nbsp;sản phẩm
                                    </span>
                                    <span class="text-gray-300">|</span>
                                    <span class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-3.5 w-3.5 mr-0.5 text-red-400">
                                            <path d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z" />
                                        </svg>
                                        <span x-text="getCategoryPurchases(category.id)"></span>+
                                    </span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>




                <h2 id="product-list-anchor" class="text-3xl font-bold text-center text-gray-800 mb-2" x-text="activeSearchQuery ? `Kết quả cho '${activeSearchQuery}'` : currentCategory?.name"></h2>
                <p class="text-center text-gray-500 mb-8" x-text="currentCategory?.description"></p>

                <!-- Sorting Filters -->
                <div class="flex items-center justify-center flex-wrap gap-2 mb-8 border-b pb-8">
                     <button @click="activeFilter = 'best_selling'"
                            :class="{ 'bg-pink-200 text-pink-800': activeFilter === 'best_selling', 'bg-white text-gray-600': activeFilter !== 'best_selling' }"
                            class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors duration-200">
                        🔥 Bán chạy
                    </button>
                    <button @click="activeFilter = 'newest'"
                            :class="{ 'bg-pink-200 text-pink-800': activeFilter === 'newest', 'bg-white text-gray-600': activeFilter !== 'newest' }"
                            class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors duration-200">
                        ✨ Hàng mới
                    </button>
                    <button @click="activeFilter = 'top_rated'"
                            :class="{ 'bg-pink-200 text-pink-800': activeFilter === 'top_rated', 'bg-white text-gray-600': activeFilter !== 'top_rated' }"
                            class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors duration-200">
                        ⭐ Đánh giá cao
                    </button>
                </div>

                <!-- Thông tin về thẻ tên bé - Chỉ hiển thị khi chọn danh mục "Mix thẻ tên bé" -->
                <div x-show="currentCategory && currentCategory.id === 'mix_the_ten_be'"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 transform scale-95"
                     x-transition:enter-end="opacity-100 transform scale-100"
                     class="mb-8 bg-gradient-to-r from-pink-50 to-purple-50 border border-pink-200 rounded-2xl p-6 shadow-sm">
                    <div class="flex items-start space-x-4">

                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                                <span class="mr-2">💎</span>
                                Thông tin về thẻ tên bé
                            </h3>
                            <div class="space-y-3 text-sm text-gray-700">
                                <p class="leading-relaxed">
                                    <span class="font-semibold text-pink-600">Thẻ tên bé có thể khắc được 2 mặt 2 tên khác nhau</span>, các mẹ có thể khắc 1 mặt tên biệt danh, 1 mặt tên thật của bé.
                                </p>
                                <div class="bg-white/70 rounded-lg p-3 border border-pink-100">
                                    <p class="font-medium text-gray-800 mb-1">
                                        <span class="text-pink-500">💡 Ví dụ:</span> Nhím - Nhật Minh
                                    </p>
                                    <p class="text-xs text-gray-600">
                                        (1 mặt khắc tên "Nhím", 1 mặt khắc tên "Nhật Minh")
                                    </p>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bảng so sánh hạt dâu tằm - Chỉ hiển thị khi chọn danh mục "Hạt dâu tằm mài sẵn" -->
                <div x-show="currentCategory && currentCategory.id === 'hat_dau_tam_mai_san'"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 transform scale-95"
                     x-transition:enter-end="opacity-100 transform scale-100"
                     class="mb-8">

                    <!-- Header -->
                    <div class="text-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Phân biệt hạt dâu tằm</h3>
                        <p class="text-gray-500 text-sm mt-1">Giúp mẹ chọn loại phù hợp nhất cho bé</p>
                    </div>

                    <!-- Comparison Text - Enhanced -->
                    <div class="max-w-3xl mx-auto space-y-4">

                        <!-- Loại Đẹp -->
                        <div class="bg-gradient-to-r from-emerald-50 to-teal-50/50 p-4 rounded-xl border-l-4 border-emerald-400 shadow-sm">
                            <p class="text-sm text-gray-800 leading-relaxed">
                                <strong class="font-bold text-emerald-700">💎 Loại đẹp:</strong>
                                Là hạt cắt từ gốc cây dâu (có ít) rất già, chắc, đặc lõi độ bền cao, ngâm nước thoải mái không hỏng, phù hợp đeo lâu dài.
                            </p>
                        </div>

                        <!-- Loại Thường -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50/50 p-4 rounded-xl border-l-4 border-blue-400 shadow-sm">
                            <p class="text-sm text-gray-800 leading-relaxed">
                                <strong class="font-bold text-blue-700">👍 Loại thường:</strong>
                                Là hạt ở phần trên đoạn gốc cây dâu, hạt non hơn, rỗng lõi hơn, độ bền vẫn đáp ứng nhu cầu đeo cho bé thoải mái, hạn chế ngâm nước nhiều, ngoại hình vẫn giống loại đẹp.
                            </p>
                        </div>

                    </div>
                </div>

                <div id="products-section" class="mb-4"></div>
                <div id="product-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-2 sm:gap-3">
                    <template x-for="product in filteredProducts()" :key="product.id">
                        <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden group">
                            <div @click="product.stock_quantity !== 0 && openQuickView(product)" class="relative overflow-hidden cursor-pointer bg-gray-100 aspect-square rounded-t-xl">
                                <img :src="product.image" :alt="product.name"
                                     @load="$el.classList.remove('opacity-0')"
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300 opacity-0 transition-opacity"
                                     loading="lazy">
                                <!-- Out of Stock Overlay - Mom-friendly design -->
                                <div x-show="product.stock_quantity === 0" class="absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center p-2" x-cloak>
                                    <div class="bg-gradient-to-r from-purple-400 to-pink-400 text-white font-bold text-xs sm:text-sm px-4 py-2 rounded-full shadow-lg text-center">
                                        Tạm Hết Hàng
                                    </div>
                                </div>

                                <!-- Badge "TOP 1" - Ribbon mọc từ cạnh trái -->
                                <div x-show="topSellingProductId() === product.id"
                                     class="absolute top-3 -left-1 z-10">
                                    <div class="bg-gradient-to-r from-yellow-400 to-amber-500 text-white font-black text-[9px] sm:text-[10px] px-3 py-1 shadow-lg rounded-tl-lg rounded-br-lg">
                                        <div class="flex items-center space-x-1">
                                            <svg class="w-2 h-2 sm:w-2.5 sm:h-2.5" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M5 16L3 6l5.5 4L12 4l3.5 6L21 6l-2 10H5z"/>
                                            </svg>
                                            <span>TOP 1</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Badge "BÁN CHẠY" - Ribbon mọc từ cạnh trái -->
                                <div x-show="topSellingProductIds().includes(product.id) && topSellingProductId() !== product.id"
                                     class="absolute top-3 -left-1 z-10">
                                    <div class="bg-gradient-to-r from-red-500 to-orange-500 text-white font-black text-[9px] sm:text-[10px] px-3 py-1 shadow-lg rounded-tl-lg rounded-br-lg">
                                        <div class="flex items-center space-x-1">
                                            <svg class="w-2 h-2 sm:w-2.5 sm:h-2.5" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"/>
                                            </svg>
                                            <span>BÁN CHẠY</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Badge "Giảm giá" - Top right corner -->
                                <div x-show="getDiscountPercentage(product) > 0"
                                     class="absolute top-3 right-2 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded shadow-lg z-10">
                                    <span x-text="`-${getDiscountPercentage(product)}%`"></span>
                                </div>


                            </div>
                            <div class="p-2">
                                <h3 @click="openProductDetail(product)" class="font-semibold text-gray-800 group-hover:text-pink-600 transition-colors cursor-pointer text-sm sm:text-base leading-tight min-h-[1.5rem] flex items-start" x-text="product.name"></h3>
                                <!-- Price, Rating, and Purchases -->
                                <div class="space-y-2">
                                    <div class="flex items-baseline">
                                        <span class="text-pink-600 font-bold text-base sm:text-lg" x-text="formatCurrency(product.price)"></span>
                                        <template x-if="product.original_price">
                                            <span class="text-gray-400 line-through text-xs ml-2" x-text="formatCurrency(product.original_price)"></span>
                                        </template>
                                    </div>
                                    <div class="flex items-center text-xs text-gray-500">
                                        <div class="flex items-center">
                                            <svg class="w-3.5 h-3.5 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                            </svg>
                                            <span class="text-yellow-600 font-medium" x-text="product.rating"></span>
                                        </div>
                                        <div class="border-l h-3.5 mx-2 border-gray-300"></div>
                                        <span x-text="`Đã bán ${product.purchases}+`"></span>
                                    </div>
                                </div>
                                <!-- Action Buttons -->
                                <div class="mt-4 flex items-center space-x-2">
                                    <!-- Add to Cart Icon - Outline Style -->
                                    <button @click.stop="handleProductClick(product)" :disabled="product.stock_quantity === 0"
                                            class="w-10 h-10 rounded-lg flex items-center justify-center shadow-sm transition-all duration-200 flex-shrink-0"
                                            :class="product.stock_quantity !== 0 ? 'bg-white border-[1.5px] border-pink-500 text-pink-500 hover:bg-pink-50 hover:border-pink-600 hover:text-pink-600 hover:scale-105' : 'bg-gray-100 border border-gray-300 text-gray-400 cursor-not-allowed'">
                                        <div class="relative">
                                            <!-- Shopping Cart Icon -->
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                                <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19H16.16a1.75 1.75 0 0 0 1.743-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5ZM7.5 10a2.5 2.5 0 0 0 5 0V8.75a.75.75 0 0 1 1.5 0V10a4 4 0 0 1-8 0V8.75a.75.75 0 0 1 1.5 0V10Z" clip-rule="evenodd" />
                                            </svg>
                                            <!-- Plus Icon Overlay -->
                                            <div class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-pink-500 text-white rounded-full flex items-center justify-center text-xs font-bold shadow-sm">
                                                +
                                            </div>
                                        </div>
                                    </button>

                                    <!-- Button Mua Ngay -->
                                    <button @click.stop="buyNow(product)" :disabled="product.stock_quantity === 0"
                                            class="flex-1 flex items-center justify-center h-10 text-white rounded-lg transition-colors duration-300 font-semibold text-xs sm:text-sm shadow-lg"
                                            :class="product.stock_quantity !== 0 ? 'bg-pink-600 hover:bg-pink-700' : 'bg-gray-400 cursor-not-allowed'">
                                        <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                        </svg>
                                        <span class="truncate">Mua ngay</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Nút Xem Thêm -->
                <div x-show="canLoadMore()" class="text-center mt-10">
                    <button @click="loadMoreProducts()"
                            class="bg-white hover:bg-pink-50 text-pink-600 font-semibold py-3 px-8 border border-pink-200 rounded-full shadow-sm transition-all duration-300 transform hover:scale-105">
                        Xem thêm sản phẩm
                    </button>
                </div>
            </div>





        <!-- Order Confirmation Modal - Redesigned for Moms -->
        <div x-show="isConfirmModalOpen" @keydown.escape.window="isConfirmModalOpen = false" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9990]">
            <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm sm:max-w-lg lg:max-w-2xl max-h-[85vh] sm:max-h-[90vh] flex flex-col border border-pink-100 modal-float relative my-4 modal-with-fixed-footer">

                <!-- Header - Compact -->
                <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-2 sm:p-4 rounded-t-2xl flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-1 sm:space-x-2">
                            <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-sm sm:text-base font-bold">Xác nhận đơn hàng</h2>
                            </div>
                        </div>
                        <button @click="isConfirmModalOpen = false; isCheckoutModalOpen = true" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <!-- Content - Scrollable -->
                <div class="flex-1 overflow-y-auto modal-scroll">
                    <div class="p-3 space-y-4">

                        <!-- Thông tin người nhận với icon -->
                        <div class="bg-gradient-to-r from-pink-50 to-purple-50 p-4 rounded-2xl border border-pink-100">
                            <div class="flex items-center space-x-2 mb-3">
                                <div class="w-6 h-6 bg-pink-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                                <h3 class="font-semibold text-gray-800">Thông tin người nhận</h3>
                            </div>
                            <div class="space-y-2.5 text-sm">
                                <div class="flex items-start space-x-2">
                                    <span class="text-gray-500 font-medium min-w-[80px]">Họ tên:</span>
                                    <span class="text-gray-800 font-medium" x-text="customer.name"></span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-gray-500 font-medium min-w-[80px]">Điện thoại:</span>
                                    <span class="text-gray-800 font-medium" x-text="customer.phone"></span>
                                </div>
                                <div x-show="customer.email" class="flex items-start space-x-2">
                                    <span class="text-gray-500 font-medium min-w-[80px]">Email:</span>
                                    <span class="text-gray-800" x-text="customer.email"></span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-gray-500 font-medium min-w-[80px]">Địa chỉ:</span>
                                    <span class="text-gray-800 leading-relaxed" x-text="customer.address"></span>
                                </div>
                                <div x-show="customer.notes" class="flex items-start space-x-2 pt-1 border-t border-pink-100">
                                    <span class="text-gray-500 font-medium min-w-[80px]">Ghi chú:</span>
                                    <span class="text-gray-800 italic" x-text="customer.notes"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Sản phẩm đã chọn với icon -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-2xl border border-blue-100">
                            <div class="flex items-center space-x-2 mb-3">
                                <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                                    </svg>
                                </div>
                                <h3 class="font-semibold text-gray-800">Sản phẩm đã chọn</h3>
                            </div>
                            <div class="space-y-3">
                                <template x-for="item in selectedCartProducts" :key="item.cartId">
                                    <div class="bg-white p-3 rounded-xl border border-blue-100">
                                        <!-- Main product info row -->
                                        <div class="flex items-start space-x-3">
                                            <img :src="item.image" class="w-12 h-12 rounded-lg object-cover border border-gray-200" loading="lazy">
                                            <div class="flex-grow min-w-0">
                                                <p class="font-medium text-gray-800 text-sm leading-tight" x-text="item.name"></p>
                                                <div class="flex items-center space-x-3 mt-1">
                                                    <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full" x-text="`SL: ${item.beadQuantity || item.quantity}`"></span>
                                                    <span x-show="item.weight" class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full" x-text="item.weight"></span>
                                                    <span x-show="item.hasSurcharge" class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded-full font-medium">+20k (size lớn)</span>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <p class="font-semibold text-pink-600 text-sm" x-text="formatCurrency((item.finalPrice || item.price) * (item.beadQuantity || item.quantity))"></p>
                                            </div>
                                        </div>

                                        <!-- Ghi chú sản phẩm - Full width -->
                                        <div x-show="item.notes && item.notes.trim()" class="mt-3 pt-3 border-t border-gray-100">
                                            <p class="text-xs text-gray-600 italic bg-yellow-50 px-3 py-2 rounded border-l-2 border-yellow-300">
                                                <span class="font-medium">💬 Ghi chú:</span> <span x-text="item.notes"></span>
                                            </p>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Tổng kết đơn hàng với icon -->
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-2xl border border-green-100">
                            <div class="flex items-center space-x-2 mb-3">
                                <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                <h3 class="font-semibold text-gray-800">Tổng kết đơn hàng</h3>
                            </div>
                            <div class="bg-white p-3 rounded-xl border border-green-100">
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Tạm tính:</span>
                                        <span class="font-medium text-gray-800" x-text="formatCurrency(cartSubtotal())"></span>
                                    </div>
                                    <div class="flex justify-between items-center" x-show="cart.length > 0">
                                        <span class="text-gray-600">Phí vận chuyển:</span>
                                        <span class="font-medium text-gray-800" x-text="formatCurrency(shippingFee())"></span>
                                    </div>

                                    <!-- Các ưu đãi -->
                                    <template x-if="shippingDiscount > 0">
                                        <div class="flex justify-between items-center text-green-600 bg-green-50 px-2 py-1 rounded-lg">
                                            <span class="text-sm">💥 Ưu đãi Freeship:</span>
                                            <span class="font-medium" x-text="'-' + formatCurrency(shippingDiscount)"></span>
                                        </div>
                                    </template>
                                    <template x-if="addonDiscount > 0">
                                        <div class="flex justify-between items-center text-green-600 bg-green-50 px-2 py-1 rounded-lg">
                                            <span class="text-sm">🎁 Giảm giá (Móc chìa khóa):</span>
                                            <span class="font-medium" x-text="'-' + formatCurrency(addonDiscount)"></span>
                                        </div>
                                    </template>
                                    <template x-if="tuiDauTamBonusDiscount > 0">
                                        <div class="flex justify-between items-center text-green-600 bg-green-50 px-2 py-1 rounded-lg">
                                            <span class="text-sm">💝 Ưu đãi thêm (Túi dâu tằm):</span>
                                            <span class="font-medium" x-text="'-' + formatCurrency(tuiDauTamBonusDiscount)"></span>
                                        </div>
                                    </template>
                                    <template x-if="discountAmount > 0">
                                        <div class="flex justify-between items-center text-green-600 bg-green-50 px-2 py-1 rounded-lg">
                                            <span class="text-sm">✨ Giảm giá của shop:</span>
                                            <span class="font-medium" x-text="'-' + formatCurrency(discountAmount)"></span>
                                        </div>
                                    </template>

                                    <!-- Tổng cộng -->
                                    <div class="flex justify-between items-center font-bold text-base pt-2 mt-2 border-t border-green-200 bg-gradient-to-r from-pink-50 to-purple-50 px-2 py-2 rounded-lg heartbeat">
                                        <span class="text-gray-800">Tổng cộng:</span>
                                        <span class="text-pink-600 text-lg" x-text="formatCurrency(cartTotal())"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Phương thức thanh toán với icon -->
                        <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-2xl border border-amber-100">
                            <div class="flex items-center space-x-2 mb-3">
                                <div class="w-6 h-6 bg-amber-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                </div>
                                <h3 class="font-semibold text-gray-800">Phương thức thanh toán</h3>
                            </div>
                            <div class="bg-white p-3 rounded-xl border border-amber-100">
                                <div class="flex items-center space-x-2">
                                    <span class="text-2xl" x-text="paymentMethod === 'cod' ? '💰' : '🏦'"></span>
                                    <span class="text-sm font-medium text-gray-800" x-text="paymentMethod === 'cod' ? 'Thanh toán khi nhận hàng (COD)' : 'Chuyển khoản ngân hàng'"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer - Fixed at bottom -->
                <div class="flex-shrink-0 bg-white border-t border-gray-200 p-3 rounded-b-2xl">
                    <div class="flex flex-row gap-3">
                        <!-- Nút sửa thông tin -->
                        <button @click="isConfirmModalOpen = false; isCheckoutModalOpen = true"
                                class="flex-none w-28 sm:w-32 px-2 sm:px-4 py-2.5 sm:py-3 bg-gray-200 text-gray-700 font-medium rounded-lg text-xs sm:text-sm btn-edit min-h-[40px] sm:min-h-[48px]">
                            Sửa thông tin
                        </button>

                        <!-- Nút xác nhận đặt hàng -->
                        <button @click="confirmAndSubmitOrder()"
                                :disabled="isSubmitting"
                                class="flex-1 px-2 sm:px-4 py-2.5 sm:py-3 text-white font-bold rounded-lg text-xs sm:text-sm shadow-lg min-h-[40px] sm:min-h-[48px] btn-confirm"
                                style="background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%) !important;"
                                :class="{ 'opacity-50 cursor-not-allowed': isSubmitting }">

                            <!-- Loading spinner -->
                            <svg x-show="isSubmitting"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95"
                                 x-transition:enter-end="opacity-100 scale-100"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100"
                                 x-transition:leave-end="opacity-0 scale-95"
                                 class="loading-spinner w-4 h-4 text-white inline mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>

                            <!-- Single span with smooth text transition -->
                            <span x-text="isSubmitting ? 'Đang xử lý...' : 'Xác nhận đặt hàng'"
                                  class="transition-all duration-200 ease-in-out"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>




        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-pink-50 to-purple-50 border-t border-pink-100 mt-8 w-full" x-show="!loading">
        <div class="max-w-7xl mx-auto px-4 py-12">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Brand Section -->
                    <div class="text-center md:text-left">
                        <div class="flex items-center justify-center md:justify-start mb-4">
                            <div class="bg-gradient-to-r from-pink-500 to-purple-500 text-white w-12 h-12 rounded-full flex items-center justify-center mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800">Vòng Dâu Tằm By Ánh</h3>
                        </div>
                        <p class="text-gray-600 text-sm leading-relaxed mb-4">
                            Chuyên cung cấp các sản phẩm vòng dâu tằm chất lượng cao,
                            mang lại sức khỏe và may mắn cho bạn và gia đình.
                        </p>
                        <div class="flex justify-center md:justify-start space-x-4">
                            <a href="https://zalo.me/0972483892" target="_blank" rel="noopener noreferrer"
                               class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-full transition-colors duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4 sm:h-5 sm:w-5">
                    <path d="M3.505 2.365A41.369 41.369 0 0 1 9 2c1.863 0 3.697.124 5.495.365 1.247.167 2.18 1.108 2.435 2.268a4.45 4.45 0 0 0-.577-.069 43.141 43.141 0 0 0-4.706 0C9.229 4.696 7.5 6.727 7.5 8.998v2.24c0 1.413.67 2.735 1.76 3.562l-2.98 2.98A.75.75 0 0 1 5 17.25v-3.443c-.501-.048-1-.106-1.495-.172C2.033 13.438 1 12.162 1 10.72V5.28c0-1.441 1.033-2.717 2.505-2.914Z"></path>
                    <path d="M14 6c-.762 0-1.52.02-2.271.062C10.157 6.148 9 7.472 9 8.998v2.24c0 1.519 1.147 2.839 2.71 2.935.214.013.428.024.642.034.2.009.385.09.518.224l2.35 2.35a.75.75 0 0 0 1.28-.531v-2.07c1.453-.195 2.5-1.463 2.5-2.915V8.998c0-1.526-1.157-2.85-2.729-2.936A41.645 41.645 0 0 0 14 6Z"></path>
                </svg>
                            </a>
                            <a href="tel:0972483892"
                               class="bg-green-500 hover:bg-green-600 text-white p-2 rounded-full transition-colors duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                </svg>
                            </a>
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="text-center md:text-left">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Thông tin liên hệ</h4>
                        <div class="space-y-3">
                            <div class="flex items-start justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500 mr-3 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                <div>
                                    <p class="text-gray-600 text-sm leading-relaxed">
                                        Xóm 4, Đông Cao<br>
                                        Tráng Việt, Hà Nội
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                </svg>
                                <p class="text-gray-600 text-sm">0972.483.892</p>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <p class="text-gray-600 text-sm">Thứ 2 - Chủ nhật: 8:00 - 22:00</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Links -->
                    <div class="text-center md:text-left">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Dịch vụ</h4>
                        <div class="space-y-2">
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-gray-600 text-sm">Vòng dâu tằm chính hãng</p>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-gray-600 text-sm">Giao hàng toàn quốc</p>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-gray-600 text-sm">Tư vấn miễn phí</p>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-gray-600 text-sm">Đổi trả trong 7 ngày</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Section -->
                <div class="border-t border-pink-200 mt-8 pt-6">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <p class="text-gray-500 text-sm text-center md:text-left mb-4 md:mb-0">
                            © 2024 Vòng Dâu Tằm By Ánh. Tất cả quyền được bảo lưu.
                        </p>
                        <div class="flex items-center space-x-4">
                            <span class="text-gray-400 text-xs">Được thiết kế với</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                            </svg>
                            <span class="text-gray-400 text-xs">tại Việt Nam</span>
                        </div>
                    </div>
                </div>
            </div>


    </footer>

    <div class="container mx-auto p-4">
        <!-- Image Viewer Modal -->

        <!-- Social Proof Notification - Compact -->
        <div x-show="notification.visible && !isMiniCartOpen && !isCheckoutModalOpen"
             x-transition:enter="transition ease-out duration-200 transform"
             x-transition:enter-start="-translate-y-6 opacity-0 scale-95"
             x-transition:enter-end="translate-y-0 opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-150 transform"
             x-transition:leave-start="translate-y-0 opacity-100 scale-100"
             x-transition:leave-end="-translate-y-6 opacity-0 scale-95"
             class="fixed top-3 left-1/2 -translate-x-1/2 sm:left-3 sm:translate-x-0 z-50 bg-white/95 backdrop-blur-sm rounded-lg shadow-md border border-gray-200/80 px-3 py-2 flex items-center space-x-2 max-w-xs sm:max-w-sm">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse flex-shrink-0"></div>
            <p class="text-xs text-gray-700 font-medium truncate" x-text="notification.message"></p>
        </div>

    </div>

    <!-- Image Viewer Modal -->
    <div x-show="isImageModalOpen" @keydown.escape.window="closeImageModal()" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9000]">
        <div class="relative">
            <img :src="currentImage" alt="Xem ảnh lớn" class="max-w-full max-h-[90vh] rounded-lg shadow-lg" loading="lazy">
            <button @click="closeImageModal()" class="absolute -top-4 -right-4 bg-white text-black w-10 h-10 rounded-full flex items-center justify-center shadow-lg hover:bg-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>



    <!-- Addon Detail Modal -->
    <div x-show="isAddonDetailModalOpen" @keydown.escape.window="closeAddonDetail()"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-3 sm:p-4 pt-safe-top pb-safe-bottom z-[9950]">
        <div class="bg-white rounded-3xl sm:rounded-2xl shadow-xl w-full max-w-sm sm:max-w-2xl max-h-[85vh] sm:max-h-[90vh] overflow-hidden transform">

            <template x-if="currentAddonDetail">
                <div class="flex flex-col h-full max-h-[85vh] sm:max-h-[90vh]">
                    <!-- Header - Compact -->
                    <div class="flex-shrink-0 flex items-center justify-between p-3 sm:p-4 border-b bg-white">
                        <h2 class="text-xl font-bold text-gray-800" x-text="currentAddonDetail.name"></h2>
                        <button @click="closeAddonDetail()"
                                class="text-pink-600 hover:text-white w-8 h-8 bg-pink-100 hover:bg-pink-500 rounded-full flex items-center justify-center transition-all shadow-sm hover:shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Content - Scrollable (bao gồm cả hình ảnh) -->
                    <div class="flex-1 overflow-y-auto modal-scroll p-2 sm:p-4 space-y-2 sm:space-y-6">
                        <!-- Product Image -->
                        <div class="relative bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl aspect-square">
                            <img :src="currentAddonDetail.image" :alt="currentAddonDetail.name"
                                 @load="$el.classList.remove('opacity-0')"
                                 class="w-full h-full object-cover rounded-xl shadow-lg opacity-0 transition-opacity duration-300" loading="lazy">
                        </div>
                        <!-- Price Section - Professional Design -->
                        <div class="bg-white rounded-2xl p-3 sm:p-5 shadow-sm border border-gray-100 mb-4">
                            <!-- Price Row -->
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-baseline space-x-2 sm:space-x-3 flex-wrap">
                                        <span class="text-2xl sm:text-3xl font-black text-gray-900" x-text="formatCurrency(currentAddonDetail.price)"></span>
                                        <template x-if="currentAddonDetail.original_price">
                                            <span class="text-sm sm:text-base text-gray-400 line-through" x-text="formatCurrency(currentAddonDetail.original_price)"></span>
                                        </template>
                                    </div>
                                </div>
                                <template x-if="currentAddonDetail.original_price">
                                    <div class="bg-gradient-to-r from-red-500 to-red-600 text-white px-2 py-1 sm:px-3 sm:py-1.5 rounded-lg text-xs sm:text-sm font-bold shadow-lg flex-shrink-0 ml-2">
                                        <div class="text-center">
                                            <div class="text-[10px] sm:text-xs">TIẾT KIỆM</div>
                                            <div class="text-sm sm:text-base" x-text="Math.round((1 - currentAddonDetail.price / currentAddonDetail.original_price) * 100) + '%'"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <!-- Divider -->
                            <div class="border-t border-gray-100 my-2 sm:my-3"></div>

                            <!-- Stats Row - Mobile Optimized Layout -->
                            <div class="flex items-center justify-between">
                                <!-- Mobile: Flex layout với tỷ lệ tùy chỉnh, Desktop: Flex với space-x-4 -->
                                <div class="flex items-center w-full sm:space-x-4">
                                    <!-- Rating - Ít diện tích (20%) -->
                                    <div class="flex items-center space-x-1 w-1/5 sm:w-auto">
                                        <svg class="w-3 h-3 sm:w-4 sm:h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                        </svg>
                                        <span class="text-xs sm:text-sm font-medium text-gray-700" x-text="currentAddonDetail.rating"></span>
                                    </div>

                                    <!-- Separator -->
                                    <div class="hidden sm:block w-px h-3 sm:h-4 bg-gray-300"></div>

                                    <!-- Sales - Vừa phải (35%) -->
                                    <div class="flex items-center space-x-1 w-2/5 sm:w-auto justify-center sm:justify-start">
                                        <svg class="w-3 h-3 sm:w-4 sm:h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                        </svg>
                                        <span class="text-xs sm:text-sm font-medium text-gray-700" x-text="`${currentAddonDetail.purchases}+ bán`"></span>
                                    </div>

                                    <!-- Separator -->
                                    <div class="hidden sm:block w-px h-3 sm:h-4 bg-gray-300"></div>

                                    <!-- Trust Badge - Nhiều diện tích (45%) -->
                                    <div class="flex items-center space-x-1 bg-green-50 px-2 py-1 rounded-full w-2/5 sm:w-auto justify-center sm:justify-start">
                                        <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        <span class="text-xs font-medium text-green-700">Thủ công 100%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Product Description -->
                        <div class="mb-4">
                            <p class="text-gray-600" x-text="currentAddonDetail.description"></p>
                        </div>
                        <!-- Freeship Banner -->
                        <div class="my-4 p-3 bg-green-100 border border-green-200 rounded-lg text-center">
                            <p class="text-sm text-green-800 font-semibold">🎁 Mua vòng dâu tằm kèm <span id="addon-product-name">Túi Dâu Tằm</span> sẽ được <span class="font-bold">freeship</span></p>
                        </div>







                        <!-- Full Description -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">📝 Mô tả chi tiết</h3>
                            <p class="text-gray-700 leading-relaxed" x-text="currentAddonDetail.detailedInfo?.fullDescription"></p>
                        </div>

                        <!-- Benefits -->

                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">✨ Lợi ích</h3>
                            <div class="space-y-2">
                                <template x-for="benefit in currentAddonDetail.detailedInfo?.benefits || []" :key="benefit">
                                    <div class="flex items-start space-x-2">
                                        <span class="text-green-500 mt-1">•</span>
                                        <span class="text-gray-700" x-text="benefit"></span>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Usage -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">📋 Cách sử dụng</h3>
                            <p class="text-gray-700 leading-relaxed" x-text="currentAddonDetail.detailedInfo?.usage"></p>
                        </div>

                        <!-- Materials and Origin -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">🧱 Chất liệu</h4>
                                <p class="text-gray-700 text-sm" x-text="currentAddonDetail.detailedInfo?.materials"></p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">🏭 Xuất xứ</h4>
                                <p class="text-gray-700 text-sm" x-text="currentAddonDetail.detailedInfo?.origin"></p>
                            </div>
                        </div>

                        <!-- Cam kết -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">🛡️ Cam kết từ shop</h3>
                            <div class="space-y-2">
                                <div class="flex items-start space-x-2">
                                    <span class="text-green-500 mt-1">✓</span>
                                    <span class="text-gray-700">Làm thủ công bằng tay 100%</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-green-500 mt-1">✓</span>
                                    <span class="text-gray-700">Dâu tằm đực Việt Nam, không ra quả</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-green-500 mt-1">✓</span>
                                    <span class="text-gray-700">Được kiểm tra hàng trước khi thanh toán</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-green-500 mt-1">✓</span>
                                    <span class="text-gray-700">Không hóa chất, không chất bảo quản, an toàn tuyệt đối</span>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Action Buttons - Footer -->
                    <div class="flex-shrink-0 p-3 sm:p-4 bg-white border-t rounded-b-3xl sm:rounded-b-2xl">
                        <div class="flex space-x-3">
                            <button @click="closeAddonDetail()"
                                    class="w-2/5 bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                                Đóng
                            </button>
                            <button @click="addAddonToCart(currentAddonDetail); closeAddonDetail()"
                                    :disabled="isAddonInCart(currentAddonDetail.id)"
                                    class="w-3/5 font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2"
                                    :class="isAddonInCart(currentAddonDetail.id) ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-pink-600 text-white hover:bg-pink-700'">
                                <span x-show="!isAddonInCart(currentAddonDetail.id)" class="flex items-center space-x-2">
                                    <div class="relative">
                                        <!-- Shopping Cart Icon -->
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                            <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19H16.16a1.75 1.75 0 0 0 1.743-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5ZM7.5 10a2.5 2.5 0 0 0 5 0V8.75a.75.75 0 0 1 1.5 0V10a4 4 0 0 1-8 0V8.75a.75.75 0 0 1 1.5 0V10Z" clip-rule="evenodd" />
                                        </svg>
                                        <!-- Plus Icon Overlay -->
                                        <div class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-white text-pink-600 rounded-full flex items-center justify-center text-xs font-bold">
                                            +
                                        </div>
                                    </div>
                                    <span>Thêm vào giỏ</span>
                                </span>
                                <span x-show="isAddonInCart(currentAddonDetail.id)" class="flex items-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                        <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                                    </svg>
                                    <span>Đã có trong giỏ</span>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Discount Code Modal - Redesigned for Moms -->
    <div x-show="isDiscountModalOpen" @keydown.escape.window="closeDiscountModal()"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9950]">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm sm:max-w-md max-h-[90vh] overflow-hidden transform">

            <template x-if="isDiscountModalOpen">
                <div class="flex flex-col h-full max-h-[90vh]">
                    <!-- Header - Compact & Beautiful -->
                    <div class="flex-shrink-0 bg-gradient-to-r from-pink-500 to-purple-600 text-white p-3 rounded-t-2xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-7 h-7 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                            </svg>
                        </div>
                        <h3 class="text-base font-bold">Mã giảm giá</h3>
                    </div>
                    <button @click="closeDiscountModal()" class="w-7 h-7 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

                    <!-- Body - Compact Design -->
                    <div class="flex-1 overflow-y-auto modal-scroll p-3">
                <!-- Manual Input - Simplified -->
                <div class="mb-3">
                    <div class="flex gap-2">
                        <input type="text" x-model="discountCode" placeholder="Nhập mã của bạn"
                               class="flex-1 px-3 py-2.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-all">
                        <button @click="applySelectedDiscount(true)"
                                class="px-4 py-2.5 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-medium rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all text-sm">
                            Dùng
                        </button>
                    </div>
                    <p x-show="discountError" x-text="discountError" class="text-red-500 text-xs mt-1.5 flex items-center">
                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                    </p>
                </div>

                <!-- Divider -->
                <div class="flex items-center my-3">
                    <div class="flex-1 border-t border-gray-200"></div>
                    <span class="px-2 text-xs text-gray-500 font-medium">Hoặc chọn mã có sẵn</span>
                    <div class="flex-1 border-t border-gray-200"></div>
                </div>
                <!-- Available Discount Codes - Simplified -->
                <div class="space-y-2">
                    <template x-for="discount in sortedDiscounts" :key="discount.code">
                        <div @click="discount.availability.available ? (selectDiscount(discount.code), applySelectedDiscount(true)) : null"
                             class="border rounded-xl p-3 transition-all duration-200 touch-manipulation"
                             :class="{
                                 'border-pink-400 bg-pink-50 shadow-sm': discountCode === discount.code,
                                 'border-gray-200 bg-white': discountCode !== discount.code,
                                 'opacity-50': !discount.availability.available,
                                 'cursor-pointer hover:border-pink-300 hover:shadow-sm': discount.availability.available,
                                 'cursor-not-allowed': !discount.availability.available
                             }">

                            <!-- Main Content Row -->
                            <div class="flex items-center justify-between">
                                <!-- Left: Code & Type -->
                                <div class="flex items-center space-x-2 flex-1 min-w-0">
                                    <!-- Radio Indicator -->
                                    <div class="w-4 h-4 rounded-full border-2 flex items-center justify-center flex-shrink-0"
                                         :class="discountCode === discount.code ? 'border-pink-500 bg-pink-500' : 'border-gray-300'">
                                        <div x-show="discountCode === discount.code" class="w-2 h-2 bg-white rounded-full"></div>
                                    </div>

                                    <!-- Code & Description -->
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <span class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-2 py-0.5 rounded-md text-xs font-bold" x-text="discount.code"></span>
                                            <template x-if="discount.type === 'gift'"><span class="text-blue-600 text-xs">🎁</span></template>
                                            <template x-if="discount.type === 'shipping'"><span class="text-green-600 text-xs">💥</span></template>
                                            <template x-if="discount.type === 'percentage'"><span class="text-red-600 text-xs font-bold" x-text="discount.value + '%'"></span></template>
                                            <template x-if="discount.type === 'fixed'"><span class="text-indigo-600 text-xs font-bold" x-text="formatCurrency(discount.value)"></span></template>
                                        </div>
                                        <!-- Điều kiện rõ ràng -->
                                        <p class="text-gray-700 text-xs font-medium mb-1" x-text="getDiscountCondition(discount)"></p>
                                        <!-- Hướng dẫn cụ thể -->
                                        <p x-show="!discount.availability.available" class="text-orange-600 text-xs" x-text="getDiscountGuidance(discount)"></p>
                                    </div>
                                </div>

                                <!-- Right: Savings (Hide for gift type) -->
                                <div class="text-right flex-shrink-0">
                                    <p x-show="discount.availability.available && discount.effectiveValue > 0 && discount.type !== 'gift'" class="text-green-600 font-bold text-sm" x-text="'-' + formatCurrency(discount.effectiveValue)"></p>
                                    <p class="text-xs text-gray-500" x-text="'Từ ' + formatCurrency(discount.minOrder)"></p>
                                </div>
                            </div>

                            <!-- Status Indicator -->
                            <div class="mt-2">
                                <span x-show="discount.availability.available" class="inline-flex items-center text-green-600 text-xs font-medium">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    Có thể dùng
                                </span>
                            </div>
                        </div>
                    </template>
                </div>

                        <!-- Quick Close Hint -->
                        <div class="text-center mt-3 pb-2">
                            <p class="text-xs text-gray-400">Chạm vào mã để áp dụng ngay</p>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    </div>

    <!-- Modal Nhập Tên Bé -->
    <div x-show="isBabyNameModalOpen" @keydown.escape.window="closeBabyNameModal()"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9600]">
        <div @click.stop
             class="bg-white rounded-2xl shadow-xl w-full max-w-sm sm:max-w-md max-h-[85vh] sm:max-h-[90vh] flex flex-col transform my-4"
             x-show="isBabyNameModalOpen">

            <!-- Header - Đồng bộ với modal giỏ hàng -->
            <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-3 sm:p-4 rounded-t-2xl flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-sm sm:text-base font-bold">Nhập tên bé cần khắc</h3>
                        </div>
                    </div>
                    <button @click="closeBabyNameModal()" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="flex-grow p-4 sm:p-6 overflow-y-auto">
                <!-- Thông tin sản phẩm -->
                <div class="mb-6">
                    <div class="flex items-center space-x-3 p-3 bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg border border-pink-100">
                        <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-semibold text-gray-800 text-sm sm:text-base truncate" x-text="babyNameProductInfo.name"></h4>
                            <p class="text-xs sm:text-sm text-gray-600">Sản phẩm cần khắc tên</p>
                        </div>
                    </div>
                </div>

                <!-- Form nhập tên -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Tên bé cần khắc <span class="text-red-500">*</span>
                        </label>
                        <input type="text"
                               x-model="babyNameInput"
                               @input="validateBabyName()"
                               placeholder="Ví dụ: Nhật Minh - Nhím"
                               class="w-full px-4 py-3 text-base border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-all placeholder-gray-400"
                               maxlength="50">
                        <div class="mt-2 text-xs text-gray-500">
                            <p>💡 <strong>Lưu ý:</strong> Chỉ nhập tối đa 2 chữ trên một mặt</p>
                            <p class="mt-1">💡<strong>Ví dụ:</strong> "Hoàng Anh - Khoai", "Minh An", "Bé Tí"</p>
                        </div>
                        <div x-show="babyNameError" class="mt-2 text-xs text-red-600 bg-red-50 border border-red-200 rounded-lg px-3 py-2">
                            <p x-text="babyNameError"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex-shrink-0 p-4 sm:p-6 border-t bg-gray-50 rounded-b-2xl">
                <div class="flex gap-3">
                    <button @click="closeBabyNameModal()"
                            class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-300 transition-colors text-sm sm:text-base">
                        Hủy
                    </button>
                    <button @click="confirmBabyName()"
                            :disabled="!babyNameInput.trim()"
                            :class="babyNameInput.trim() ? 'bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white' : 'bg-gray-300 text-gray-500 cursor-not-allowed'"
                            class="flex-2 px-6 py-3 font-bold rounded-xl transition-all text-sm sm:text-base shadow-lg">
                        <span class="flex items-center justify-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span>Xác nhận</span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="./assets/js/app.js"></script>

        <!-- Mini Cart Modal -->
        <div x-show="isMiniCartOpen" @keydown.escape.window="console.log('🔍 ESC trên mini cart - isCheckoutModalOpen:', isCheckoutModalOpen, 'isConfirmModalOpen:', isConfirmModalOpen); if (!isCheckoutModalOpen && !isConfirmModalOpen) { console.log('🔍 Đóng mini cart bằng ESC'); isMiniCartOpen = false; }"

             class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9500]">
            <div
                 @click="console.log('🔍 Click trên mini cart content')"
                 class="bg-white rounded-2xl shadow-xl w-full max-w-sm sm:max-w-lg lg:max-w-2xl max-h-[85vh] sm:max-h-[90vh] flex flex-col my-4">

                <!-- Header - Compact -->
                <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-2 sm:p-4 rounded-t-2xl flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-1 sm:space-x-2">
                            <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-sm sm:text-base font-bold">Giỏ hàng</h3>
                            </div>
                        </div>
                        <button @click="isMiniCartOpen = false" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Body - Mobile Optimized -->
                <div class="flex-grow overflow-y-auto modal-scroll mini-cart-content">
                    <template x-if="cart.length === 0">
                        <div class="text-center py-8 px-4">
                            <div class="flex justify-center mb-3">
                                <svg class="h-12 w-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-base font-semibold text-gray-700 mb-1">Giỏ hàng trống</h3>
                            <p class="text-gray-500 text-sm mb-4">Khám phá sản phẩm bán chạy nhất!</p>
                            <button @click="showBestSellers()" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white font-semibold py-2.5 sm:py-3 px-5 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all text-xs sm:text-sm">
                                <span class="flex items-center justify-center">
                                    <svg class="h-4 w-4 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.28 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                    </svg>
                                    Top bán chạy
                                </span>
                            </button>
                        </div>
                    </template>

                    <div x-show="cart.length > 0" class="pt-3 space-y-3">
                        <!-- Cart Items Header - Compact -->
                        <div class="flex items-center justify-between pb-2 border-b border-gray-200 px-3">
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" :checked="isAllSelected" @change="toggleSelectAll()" class="h-3.5 w-3.5 text-pink-600 focus:ring-pink-500 border-gray-300 rounded">
                                <label class="text-xs font-medium text-gray-700 cursor-pointer" @click="toggleSelectAll()">
                                    Tất cả (<span x-text="trueTotalCartQuantity"></span>)
                                </label>
                            </div>
                            <button @click="clearCart()" class="text-xs text-blue-600 hover:text-blue-800 font-medium transition-colors">
                                Xóa hết
                            </button>
                        </div>

                        <!-- Cart Items Container - Free Flow Display -->
                        <div class="relative">
                            <div class="px-3 space-y-3">
                            <template x-for="item in cart" :key="item.cartId">
                            <div class="p-2.5 bg-gray-50 rounded-lg space-y-3" :data-cart-item-id="item.cartId || item.id">
                                <!-- Main Product Row -->
                                <div class="flex items-start space-x-2.5">
                                    <input type="checkbox" :checked="selectedCartItems.includes(item.cartId)" @change="toggleCartItemSelection(item.cartId)" class="mt-1 h-3.5 w-3.5 text-pink-600 focus:ring-pink-500 border-gray-300 rounded flex-shrink-0">
                                    <img :src="item.image" class="w-12 h-12 rounded-md object-cover border flex-shrink-0" loading="lazy">
                                    <div class="flex-grow min-w-0">
                                        <p class="font-semibold text-gray-800 text-sm leading-tight" x-text="item.name"></p>
                                        <p class="text-xs text-gray-500 mt-0.5" x-text="formatCurrency(item.price)"></p>

                                        <div class="flex items-center justify-between mt-1.5">
                                            <div class="flex items-center space-x-1.5">
                                                <template x-if="item.beadQuantity">
                                                    <button @click="decreaseBeadQuantity(item.cartId)" class="w-5 h-5 bg-gray-200 text-gray-700 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors text-sm font-bold">-</button>
                                                </template>
                                                <template x-if="!item.beadQuantity">
                                                    <button @click="decreaseQuantity(item.id)" class="w-5 h-5 bg-gray-200 text-gray-700 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors text-sm font-bold">-</button>
                                                </template>

                                                <span x-text="item.beadQuantity || item.quantity" class="font-semibold text-xs text-gray-800 w-4 text-center"></span>

                                                <template x-if="item.beadQuantity">
                                                    <button @click="increaseBeadQuantity(item.cartId)" class="w-5 h-5 bg-gray-200 text-gray-700 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors text-sm font-bold">+</button>
                                                </template>
                                                <template x-if="!item.beadQuantity">
                                                    <button @click="increaseQuantity(item.id)" class="w-5 h-5 bg-gray-200 text-gray-700 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors text-sm font-bold">+</button>
                                                </template>
                                            </div>
                                            <div class="text-right">
                                                <p class="font-bold text-pink-600 text-sm" x-text="formatCurrency((item.finalPrice || item.price) * (item.beadQuantity || item.quantity))"></p>
                                                <div x-show="item.hasSurcharge" class="text-xs text-orange-600 mt-0.5">
                                                    <span x-text="formatCurrency(item.basePrice * (item.beadQuantity || item.quantity))"></span>
                                                    <span> + </span>
                                                    <span x-text="formatCurrency(item.surcharge * (item.beadQuantity || item.quantity))"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button @click="removeFromCart(item.id)" class="text-gray-400 hover:text-red-500 p-1 flex-shrink-0">
                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>

                                <!-- Weight Selection - For Baby Products -->
                                <div x-show="!isAdultProduct(item) && !isAddonProduct(item) && !isBeadProduct(item)" class="cart-item-weight-section">
                                    <!-- Weight Selector Row -->
                                    <div class="flex items-center space-x-2 mb-2">
                                        <div class="flex items-center space-x-1 flex-shrink-0">
                                            <span class="text-xs text-pink-600 font-medium">👶</span>
                                            <span class="text-xs text-gray-700 font-medium">Cân nặng:</span>
                                        </div>
                                        <select x-model="item.selectedWeight"
                                                @change="updateItemWeight(item.id, $event.target.value)"
                                                class="weight-selector text-base px-2 py-1 flex-1 min-w-0 rounded-md border"
                                                :class="(weightErrors[item.cartId || item.id]) ? 'border-red-300 focus:border-red-500 focus:ring-red-500' : 'border-gray-200 focus:border-pink-300 focus:ring-pink-300'">
                                            <option value="">Chọn cân nặng bé</option>
                                            <option value="Chưa sinh">🤱 Chưa sinh</option>
                                            <option value="3kg">3kg</option>
                                            <option value="4kg">4kg</option>
                                            <option value="5kg">5kg</option>
                                            <option value="6kg">6kg</option>
                                            <option value="7kg">7kg</option>
                                            <option value="8kg">8kg</option>
                                            <option value="9kg">9kg</option>
                                            <option value="10kg">10kg</option>
                                            <option value="11kg">11kg</option>
                                            <option value="12kg">12kg</option>
                                            <option value="13kg">13kg</option>
                                            <option value="14kg">14kg</option>
                                            <option value="15kg">15kg</option>
                                            <option value="16kg (+20k)">16kg (+20k)</option>
                                            <option value="17kg (+20k)">17kg (+20k)</option>
                                            <option value="18kg (+20k)">18kg (+20k)</option>
                                            <option value="19kg (+20k)">19kg (+20k)</option>
                                            <option value="20kg (+20k)">20kg (+20k)</option>
                                            <option value="custom">✏️ Nhập cân nặng > 20kg</option>
                                        </select>
                                    </div>

                                    <!-- Weight Error Message -->
                                    <div x-show="weightErrors[item.cartId || item.id]" x-transition class="mt-1.5">
                                        <div class="p-2">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0">
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4 text-red-400">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" />
                                                    </svg>
                                                </div>
                                                <div class="ml-2">
                                                    <p class="text-xs font-semibold text-red-700" x-text="weightErrors[item.cartId || item.id]"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Custom Weight Input - Numbers Only -->
                                    <div x-show="item.selectedWeight === 'custom'"
                                         x-transition:enter="transition ease-out duration-200"
                                         x-transition:enter-start="opacity-0 transform scale-95"
                                         x-transition:enter-end="opacity-100 transform scale-100"
                                         class="mb-2">
                                        <div class="flex items-center space-x-2">
                                            <input type="number"
                                                   x-model="item.customWeight"
                                                   @input="updateItemWeight(item.id, $event.target.value + 'kg')"
                                                   placeholder="VD: 20, 21.5, 25..."
                                                   min="20"
                                                   max="30"
                                                   step="0.1"
                                                   class="custom-weight-input flex-1 text-base h-8 px-2 placeholder-gray-500 rounded-md border border-gray-300 focus:border-pink-400 focus:ring-1 focus:ring-pink-200">
                                            <span class="text-xs text-gray-600 font-medium">kg</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">💡 Chỉ nhập từ 20kg trở lên (VD: 20, 21.5, 25)</p>
                                    </div>
                                </div>

                                <!-- Hand Size Selection - For Adult Products -->
                                <div x-show="isAdultProduct(item)" class="cart-item-handsize-section">
                                    <!-- Hand Size Selector Row -->
                                    <div class="flex items-center space-x-2 mb-2">
                                        <div class="flex items-center space-x-1 flex-shrink-0">
                                            <span class="text-xs text-purple-600 font-medium">👤</span>
                                            <span class="text-xs text-gray-700 font-medium">Size tay:</span>
                                        </div>
                                        <select x-model="item.selectedSize"
                                                @change="updateItemHandSize(item.id, $event.target.value)"
                                                class="weight-selector text-base px-2 py-1 flex-1 min-w-0">
                                            <option value="">Chọn size tay</option>
                                            <option value="13cm">13cm</option>
                                            <option value="14cm">14cm</option>
                                            <option value="15cm">15cm</option>
                                            <option value="16cm">16cm</option>
                                            <option value="17cm">17cm</option>
                                            <option value="18cm">18cm</option>
                                            <option value="19cm">19cm</option>
                                            <option value="20cm">20cm</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Notes Input - Full Width -->
                                <div>
                                    <input type="text"
                                           x-model="item.notes"
                                           placeholder="💬 Ghi chú cho shop (tùy chọn)..."
                                           class="block w-full border-gray-200 rounded-md text-base h-8 px-2 placeholder-gray-400 focus:ring-1 focus:ring-pink-300 focus:border-pink-300 bg-white">
                                </div>
                            </div>
                        </template>
                            </div>
                        </div>

                        <!-- Upsell Section - Compact -->
                        <div class="px-3 pt-2 space-y-3">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-2.5">
                                <div class="text-center mb-2">
                                    <p class="text-xs font-semibold text-green-700">💥 CỰC SỐC! Ưu đãi mua kèm!</p>
                                    <p class="text-xs text-gray-600 mt-0.5">Còn: <span x-text="countdownTimer.display" class="font-mono font-semibold text-green-700 bg-green-100 px-1 py-0.5 rounded text-xs"></span></p>
                                </div>
                                <div class="space-y-1.5">
                                    <template x-for="addon in filteredAddonProducts" :key="addon.id">
                                        <div @click="openAddonDetail(addon)" class="flex items-center space-x-2 p-2 bg-white rounded-md border border-green-100 cursor-pointer hover:bg-gray-50 transition-colors">
                                            <img :src="addon.image" class="w-8 h-8 rounded object-cover flex-shrink-0" loading="lazy">
                                            <div class="flex-grow min-w-0">
                                                <div class="flex items-center space-x-1">
                                                    <p class="font-semibold text-gray-800 text-xs leading-tight truncate" x-text="addon.name"></p>
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-blue-600">
                                                        <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                                        <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
                                                    </svg>
                                                </div>
                                                <div class="flex items-center space-x-1">
                                                    <p class="text-xs text-pink-600 font-bold" x-text="formatCurrency(addon.price)"></p>
                                                    <template x-if="addon.original_price"><s class="text-xs text-gray-400" x-text="formatCurrency(addon.original_price)"></s></template>
                                                </div>
                                            </div>
                                            <div class="flex flex-col items-center space-y-1">
                                                <button @click.stop="isAddonInCart(addon.id) ? removeFromCart(addon.id) : addAddonToCart(addon)" class="text-xs font-medium rounded-md transition-colors h-6 w-12 flex items-center justify-center" :class="isAddonInCart(addon.id) ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-pink-600 text-white hover:bg-pink-700'">
                                                    <span x-text="isAddonInCart(addon.id) ? 'Xóa' : 'Thêm'"></span>
                                                </button>
                                                <template x-if="addon.id === 'addon_tui_dau_tam'"><p class="text-xs text-green-600 font-semibold" x-text="isFreeshippingFromDiscount() ? '-8K' : '+ Freeship'"></p></template>
                                                <template x-if="addon.id === 'addon_bo_dau_tam_7_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                                <template x-if="addon.id === 'addon_bo_dau_tam_9_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                                <template x-if="addon.id === 'addon_moc_chia_khoa'"><p class="text-xs text-green-600 font-semibold">-5K</p></template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Social Proof - Compact -->
                            <div class="px-3 py-1">
                                <div class="bg-green-50/50 rounded-md px-2 py-1 flex items-center space-x-1.5">
                                    <div class="relative flex items-center justify-center w-3 h-3">
                                        <!-- Ripple effects -->
                                        <div class="absolute w-2.5 h-2.5 bg-green-300 rounded-full live-ripple"></div>
                                        <div class="absolute w-2.5 h-2.5 bg-green-200 rounded-full live-ripple-delayed"></div>
                                        <!-- Core dot -->
                                        <div class="w-1.5 h-1.5 bg-green-500 rounded-full live-dot relative z-10"></div>
                                    </div>
                                    <p class="text-xs text-green-700 font-medium" x-text="socialProofViewers + ' người khác cũng thêm SP này'"></p>
                                </div>
                            </div>

                            <!-- Discount Code - Compact -->
                            <div class="px-3 discount-code">
                                <p x-show="isEligibleForAnyDiscount" class="text-green-700 text-xs text-center font-medium mb-1.5">🎉 Đủ điều kiện nhận ưu đãi!</p>
                                <div class="border border-dashed border-pink-300 p-2 rounded-lg flex justify-between items-center">
                                    <div class="flex items-center min-w-0">
                                        <svg x-show="!discountCode" class="h-4 w-4 mr-1.5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                        </svg>
                                        <svg x-show="discountCode && !appliedGift" class="h-4 w-4 mr-1.5 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <svg x-show="appliedGift" class="h-4 w-4 mr-1.5 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path>
                                        </svg>
                                        <p class="font-medium text-gray-700 text-xs truncate">
                                            <span x-show="!discountCode">Mã giảm giá</span>
                                            <span x-show="discountCode" x-text="discountCode"></span>
                                        </p>
                                    </div>
                                    <button @click="openDiscountModal()" class="bg-pink-600 text-white font-semibold py-1.5 px-2.5 rounded-md hover:bg-pink-700 transition-colors text-xs flex-shrink-0">
                                        <span x-show="!appliedDiscountCode && !appliedGift">Chọn</span>
                                        <span x-show="appliedDiscountCode || appliedGift">Đổi</span>
                                    </button>
                                </div>
                                <div x-show="appliedGift" class="text-xs text-gray-600 flex items-center mt-1">
                                    <span class="mr-1">🎁</span>
                                    <span class="truncate">Quà: <strong class="text-blue-600" x-text="appliedGift?.title"></strong></span>
                                </div>
                            </div>

                            <!-- Order Summary - Simplified -->
                            <div class="px-3 pt-2 pb-4 border-t border-gray-200">
                                <div class="space-y-1">
                                    <div class="flex justify-between text-sm text-gray-600">
                                        <span>Tạm tính</span>
                                        <span x-text="formatCurrency(cartSubtotal())"></span>
                                    </div>
                                    <div class="flex justify-between text-sm text-gray-600">
                                        <span>Phí ship</span>
                                        <span x-text="formatCurrency(shippingFee())"></span>
                                    </div>
                                    <!-- Tách riêng từng loại giảm giá -->
                                    <template x-if="shippingDiscount > 0">
                                        <div class="flex justify-between text-sm text-green-600 font-medium">
                                            <span>Miễn phí ship</span>
                                            <span x-text="'-' + formatCurrency(shippingDiscount)"></span>
                                        </div>
                                    </template>
                                    <template x-if="discountAmount > 0">
                                        <div class="flex justify-between text-sm text-green-600 font-medium">
                                            <span>Mã giảm giá</span>
                                            <span x-text="'-' + formatCurrency(discountAmount)"></span>
                                        </div>
                                    </template>
                                    <template x-if="addonDiscount > 0">
                                        <div class="flex justify-between text-sm text-green-600 font-medium">
                                            <span>Ưu đãi combo</span>
                                            <span x-text="'-' + formatCurrency(addonDiscount)"></span>
                                        </div>
                                    </template>
                                    <template x-if="tuiDauTamBonusDiscount > 0">
                                        <div class="flex justify-between text-sm text-green-600 font-medium">
                                            <span>Ưu đãi đặc biệt</span>
                                            <span x-text="'-' + formatCurrency(tuiDauTamBonusDiscount)"></span>
                                        </div>
                                    </template>
                                    <div class="flex justify-between font-bold text-base pt-1 border-t border-gray-200 mt-1">
                                        <span>Tổng cộng</span>
                                        <span class="text-pink-600" x-text="formatCurrency(cartTotal())"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer - Compact -->
                <div class="flex-shrink-0 p-3 border-t bg-white rounded-b-2xl">
                    <div x-show="cart.length > 0">
                        <!-- Error Message -->
                        <div x-show="miniCartError" class="bg-red-50 border border-red-200 text-red-700 px-2.5 py-1.5 rounded-md text-xs mb-2">
                            <p x-text="miniCartError"></p>
                        </div>

                        <!-- Checkout Button -->
                        <button @click="openCheckout()" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg text-xs sm:text-sm shadow-md">
                            <span class="flex items-center justify-center">
                                <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                                Thanh toán • <span x-text="formatCurrency(cartTotal())"></span>
                            </span>
                        </button>
                    </div>
                </div>
        </div>
    </div>

    <!-- ========= MODAL CONTAINER ========= -->
    <div id="modal-container">

        <!-- Order Success Modal -->
        <div x-show="isSuccessModalOpen" @keydown.escape.window="closeSuccessModal()"

             class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9999]">
            <div
                 class="bg-white rounded-2xl shadow-xl w-full max-w-sm sm:max-w-lg lg:max-w-2xl max-h-[85vh] sm:max-h-[90vh] flex flex-col my-4"

                <!-- Header - Compact -->
                <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-2 sm:p-4 rounded-t-2xl flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-1 sm:space-x-2">
                            <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-sm sm:text-base font-bold">Đặt hàng thành công!</h2>
                            </div>
                        </div>
                        <button @click="closeSuccessModal()" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Content - Scrollable -->
                <div class="flex-1 overflow-y-auto modal-scroll">
                    <div class="p-3 space-y-4 text-center">
                        <p class="text-sm sm:text-base text-gray-600 leading-relaxed">Cảm ơn bạn đã tin tưởng và đặt hàng các sản phẩm về dâu tằm của em làm. Em sẽ gọi điện xác nhận lại đơn hàng sau vài giờ nữa ạ.</p>
                        <div class="bg-pink-50 border border-pink-200 rounded-lg px-3 sm:px-4 py-2.5 sm:py-3">
                            <p class="text-xs sm:text-sm text-gray-600">Mã đơn hàng của bạn là:</p>
                            <p class="text-xl sm:text-2xl font-bold text-pink-600 tracking-wider" x-text="lastOrderId"></p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-3 sm:p-4 text-left space-y-2.5 sm:space-y-3">
                            <!-- Lưu ý về quy trình làm thủ công -->
                            <div class="flex items-start">
                                <svg class="h-4 w-4 sm:h-5 sm:w-5 text-amber-500 mr-2 sm:mr-3 mt-0.5 sm:mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd" />
                                </svg>
                                <p class="text-sm sm:text-base text-gray-700 leading-relaxed">Do vòng dâu tằm này em làm thủ công bằng tay, có 2 chị em làm thôi ạ, nên sẽ hơi lâu xíu ạ. Em sẽ làm vòng sau khoảng <strong>2 ngày</strong> kể từ khi đặt hàng và mất từ <strong>2 đến 3 ngày</strong> nữa để vận chuyển ạ.</p>
                            </div>
                            <div class="flex items-start">
                                <svg class="h-4 w-4 sm:h-5 sm:w-5 text-pink-500 mr-2 sm:mr-3 mt-0.5 sm:mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 7.586V6z" clip-rule="evenodd" />
                                </svg>
                                <p class="text-sm sm:text-base text-gray-700 leading-relaxed">Tổng thời gian dự kiến: <strong>5 đến 6 ngày</strong> kể từ thời điểm đặt hàng.</p>
                            </div>
                            <div class="flex items-start">
                                <svg class="h-4 w-4 sm:h-5 sm:w-5 text-blue-500 mr-2 sm:mr-3 mt-0.5 sm:mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                     <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                </svg>
                                <p class="text-sm sm:text-base text-gray-700 leading-relaxed">Nếu có bất kỳ thắc mắc gì, vui lòng liên hệ Zalo: <a href="https://zalo.me/0972483892" target="_blank" class="font-bold text-blue-600">0972.483.892</a> (Ánh Vòng Dâu Tằm).</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer - Fixed at bottom -->
                <div class="flex-shrink-0 bg-white border-t border-gray-200 p-3 rounded-b-2xl">
                    <div class="flex flex-row gap-3">
                        <!-- Nút đóng -->
                        <button @click="closeSuccessModal()"
                                class="flex-none w-28 sm:w-32 px-2 sm:px-4 py-2.5 sm:py-3 bg-gray-200 text-gray-700 font-medium rounded-lg text-xs sm:text-sm min-h-[40px] sm:min-h-[48px]">
                            Đóng
                        </button>

                        <!-- Nút tiếp tục mua sắm -->
                        <button @click="continueShoppingAndScroll()"
                                class="flex-1 px-2 sm:px-4 py-2.5 sm:py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold rounded-lg text-xs sm:text-sm shadow-lg min-h-[40px] sm:min-h-[48px]">
                            Tiếp tục mua sắm
                        </button>
                    </div>
                </div>
            </div>
        </div>

    <!-- Quick Buy Modal - Mua ngay không qua giỏ hàng -->
    <div x-show="isQuickBuyModalOpen" @keydown.escape.window="console.log('🔍 ESC pressed on QuickBuy, preventQuickBuyCloseOnEscape:', preventQuickBuyCloseOnEscape); if (!preventQuickBuyCloseOnEscape) closeQuickBuyModal()"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-3 sm:p-4 pt-safe-top pb-safe-bottom z-[9900]">
        <div
             class="bg-white rounded-3xl sm:rounded-2xl shadow-2xl w-full max-w-sm sm:max-w-2xl max-h-[85vh] sm:max-h-[90vh] flex flex-col my-4">

            <!-- Header - Urgency Design -->
            <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-3 rounded-t-3xl sm:rounded-t-2xl flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-7 h-7 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-base font-bold">Đặt hàng nhanh</h3>
                        </div>
                    </div>
                    <button @click="console.log('🔍 Close button clicked on QuickBuy'); closeQuickBuyModal()" class="w-7 h-7 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="flex-1 overflow-y-auto modal-scroll p-2 space-y-2">
                <!-- Product Info -->
                <div x-show="quickBuyProduct" class="bg-orange-50 border border-orange-200 rounded-lg p-3">
                    <div class="flex items-center space-x-3">
                        <img :src="quickBuyProduct?.image" class="w-12 h-12 rounded-lg object-cover" loading="lazy">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800 text-sm" x-text="quickBuyProduct?.name"></h4>
                            <div class="text-orange-600 font-bold text-sm flex items-center space-x-2">
                                <span x-text="formatCurrency((() => {
                                    let actualWeight = quickBuyWeight;
                                    if (quickBuyWeight === '✏️ Nhập cân nặng > 20kg' && quickBuyCustomWeight) {
                                        actualWeight = quickBuyCustomWeight + 'kg';
                                    }
                                    const priceData = calculateDynamicPrice(quickBuyProduct, actualWeight);
                                    if (quickBuyProduct?.category === 'hat_dau_tam_mai_san') {
                                        return priceData.finalPrice * quickBuyQuantity;
                                    }
                                    return priceData.finalPrice;
                                })())"></span>
                                <span x-show="(() => {
                                    let actualWeight = quickBuyWeight;
                                    if (quickBuyWeight === '✏️ Nhập cân nặng > 20kg' && quickBuyCustomWeight) {
                                        actualWeight = quickBuyCustomWeight + 'kg';
                                    }
                                    return calculateDynamicPrice(quickBuyProduct, actualWeight).hasSurcharge;
                                })()"
                                      class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full font-medium">
                                    +20k
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Social Proof - Compact -->
                <div class="bg-green-50/50 rounded-md px-2 py-1 flex items-center space-x-1.5">
                    <div class="w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"></div>
                    <p class="text-xs text-green-700 font-medium" x-text="socialProofViewers + ' mẹ khác cũng đang đặt SP này'"></p>
                </div>

                <!-- Form nhập thông tin -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Họ và tên *</label>
                        <input type="text" x-model="customer.name" placeholder="Nhập họ và tên của bạn"
                               @input="clearFieldError('name')"
                               :class="formErrors.name ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                               class="w-full px-3 py-2.5 text-base rounded-lg transition-all border">
                        <div x-show="formErrors.name" x-text="formErrors.name" class="text-red-500 text-xs mt-1 flex items-center error-message">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                                <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Số điện thoại *</label>
                        <input type="tel" x-model="customer.phone" placeholder="0987 654 321"
                               @input="clearFieldError('phone')"
                               :class="formErrors.phone ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                               class="w-full px-3 py-2.5 text-base rounded-lg transition-all border">
                        <div x-show="formErrors.phone" x-text="formErrors.phone" class="text-red-500 text-xs mt-1 flex items-center error-message">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                                <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </div>

                    <!-- Địa chỉ giao hàng - 3 option chọn -->
                    <div class="space-y-3">
                        <h3 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
                            <svg class="w-4 h-4 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Địa chỉ giao hàng *
                        </h3>

                        <div class="space-y-3">
                            <!-- Tỉnh/Thành phố -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span> Tỉnh/Thành phố
                                </label>
                                <select x-model="selectedProvince" @click.once="getAddressData()" @change="updateFullAddress()"
                                        :class="formErrors.province ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                        class="w-full px-3 py-2 text-base rounded-lg transition-all border">
                                    <option value="">Chọn tỉnh/thành phố</option>
                                    <template x-for="province in provinces" :key="province.Id">
                                        <option :value="province.Id" x-text="province.Name"></option>
                                    </template>
                                </select>
                                <div x-show="formErrors.province" x-text="formErrors.province" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                                        <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>

                            <!-- Quận/Huyện và Phường/Xã - Responsive layout -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-2">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">
                                        <span class="text-red-500">*</span> Quận/Huyện
                                    </label>
                                    <select x-model="selectedDistrict" @change="updateFullAddress()"
                                            :disabled="!selectedProvince"
                                            :class="formErrors.district ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                            class="w-full px-3 py-2 text-base rounded-lg transition-all border disabled:bg-gray-100">
                                        <option value="">Chọn quận/huyện</option>
                                        <template x-for="district in districts" :key="district.Id">
                                            <option :value="district.Id" x-text="district.Name"></option>
                                        </template>
                                    </select>
                                    <div x-show="formErrors.district" x-text="formErrors.district" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                                            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">
                                        <span class="text-red-500">*</span> Phường/Xã
                                    </label>
                                    <select x-model="selectedWard" @change="updateFullAddress()"
                                            :disabled="!selectedDistrict"
                                            :class="formErrors.ward ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                            class="w-full px-3 py-2 text-base rounded-lg transition-all border disabled:bg-gray-100">
                                        <option value="">Chọn phường/xã</option>
                                        <template x-for="ward in wards" :key="ward.Id">
                                            <option :value="ward.Id" x-text="ward.Name"></option>
                                        </template>
                                    </select>
                                    <div x-show="formErrors.ward" x-text="formErrors.ward" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                                            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <!-- Địa chỉ cụ thể -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span> Địa chỉ cụ thể
                                </label>
                                <input type="text" x-model="streetAddress" @input="updateFullAddress()"
                                       placeholder="Số nhà, đường..."
                                       :class="formErrors.streetAddress ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                       class="w-full px-3 py-2 text-base rounded-lg transition-all border">
                                <div x-show="formErrors.streetAddress" x-text="formErrors.streetAddress" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                                        <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>

                            <!-- Preview địa chỉ -->
                            <div x-show="customer.address" class="p-2 bg-green-50 border border-green-200 rounded-lg">
                                <p class="text-xs text-green-800">
                                    <strong>Giao đến:</strong> <span x-text="customer.address"></span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Số lượng sản phẩm -->
                    <div class="space-y-4">
                        <!-- Conditional Quantity Selector -->
                        <div>
                            <!-- Selector for Bead Products -->
                            <template x-if="quickBuyProduct?.category === 'hat_dau_tam_mai_san'">
                                <div id="quick-buy-quantity-section">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Số lượng hạt *</label>
                                    <select x-model="quickBuyQuantity"
                                            @change="revalidateQuickBuyDiscount(); if (quickBuyQuantity) formErrors.quantity = ''"
                                            :class="formErrors.quantity ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                            class="w-full px-3 py-2.5 text-base rounded-lg transition-all border bg-white">
                                        <option value="">-- Chọn số lượng hạt --</option>
                                        <template x-for="i in Array.from({ length: 21 }, (_, index) => 10 + index * 2)">
                                            <option :value="i" x-text="i + ' hạt'"></option>
                                        </template>
                                    </select>
                                    <!-- Error Message -->
                                    <div x-show="formErrors.quantity" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                                            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                                        </svg>
                                        <span x-text="formErrors.quantity"></span>
                                    </div>
                                </div>
                            </template>

                            <!-- Default Selector for Other Products -->
                            <template x-if="quickBuyProduct?.category !== 'hat_dau_tam_mai_san'">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Số lượng *</label>
                                    <select x-model="quickBuyQuantity"
                                            @change="revalidateQuickBuyDiscount()"
                                            class="w-full px-3 py-2.5 text-base rounded-lg transition-all border border-gray-300 focus:ring-pink-500 focus:border-pink-500 bg-white">
                                        <option value="1">1 sản phẩm</option>
                                        <option value="2">2 sản phẩm</option>
                                        <option value="3">3 sản phẩm</option>
                                        <option value="4">4 sản phẩm</option>
                                        <option value="5">5 sản phẩm</option>
                                    </select>
                                </div>
                            </template>
                        </div>

                        <!-- Cân nặng của bé - Riêng 1 hàng -->
                        <div x-show="showWeightInQuickBuy">
                            <label class="block text-sm font-medium text-gray-700 mb-1" x-text="isAdultInQuickBuy ? 'Size tay *' : 'Cân nặng của bé *'"></label>
                            <select x-model="quickBuyWeight"
                                    @change="clearFieldError('weight'); if (quickBuyWeight !== '✏️ Nhập cân nặng > 20kg') quickBuyCustomWeight = ''"
                                    :class="formErrors.weight ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                    class="w-full px-3 py-2.5 text-base rounded-lg transition-all border bg-white">
                                <option value="" x-text="isAdultInQuickBuy ? '-- Chọn size tay --' : '-- Chọn cân nặng --'"></option>
                                <template x-for="option in (isAdultInQuickBuy ? handSizeList : weightOptions)" :key="option">
                                    <option :value="option" x-text="option"></option>
                                </template>
                            </select>
                            <!-- Custom Weight Input for Quick Buy -->
                            <div x-show="quickBuyWeight === '✏️ Nhập cân nặng > 20kg'"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 transform scale-95"
                                 x-transition:enter-end="opacity-100 transform scale-100"
                                 class="mt-2">
                                <div class="flex items-center space-x-2">
                                    <input type="number"
                                           x-model="quickBuyCustomWeight"
                                           @input="
                                             if (quickBuyCustomWeight >= 20) {
                                               clearFieldError('weight');
                                             } else if (quickBuyCustomWeight && quickBuyCustomWeight < 20) {
                                               formErrors.weight = 'Cân nặng phải từ 20kg trở lên';
                                             }
                                           "
                                           placeholder="VD: 20, 21.5, 25..."
                                           min="20"
                                           max="30"
                                           step="0.1"
                                           :class="quickBuyCustomWeight && quickBuyCustomWeight < 20 ? 'border-red-500 focus:ring-red-300 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                           class="flex-1 px-3 py-2 text-base border rounded-lg focus:ring-2 transition-all">
                                    <span class="text-sm text-gray-600 font-medium">kg</span>
                                </div>

                                <!-- Error message for invalid weight -->
                                <div x-show="quickBuyCustomWeight && quickBuyCustomWeight < 20"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 transform scale-95"
                                     x-transition:enter-end="opacity-100 transform scale-100"
                                     class="mt-2 p-2 bg-red-50 border border-red-200 rounded-lg">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4 text-red-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <p class="text-xs text-red-700 font-medium">
                                            Cân nặng phải từ 20kg trở lên. Dưới 20kg vui lòng chọn các option có sẵn.
                                        </p>
                                    </div>
                                </div>



                                <!-- Hiển thị cân nặng đã xác nhận -->
                                <div x-show="quickBuyCustomWeight && quickBuyCustomWeight >= 20"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 transform scale-95"
                                     x-transition:enter-end="opacity-100 transform scale-100"
                                     class="mt-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-green-800">
                                            Đã xác nhận: <span x-text="quickBuyCustomWeight"></span>kg (+20k)
                                        </span>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>

                    <!-- General error message (not for custom weight validation) -->
                    <div x-show="showWeightInQuickBuy && formErrors.weight && quickBuyWeight !== '✏️ Nhập cân nặng > 20kg'" x-text="formErrors.weight" class="text-red-500 text-xs mt-1 flex items-center error-message">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                        </svg>
                    </div>

                    <!-- Helper text cho cân nặng -->
                    <div x-show="showWeightInQuickBuy && !formErrors.weight" class="text-xs flex items-start">
                        <!-- Hiển thị thông báo phụ phí khi cân nặng >= 16kg -->
                        <template x-if="(() => {
                            // Determine actual weight for calculation
                            let actualWeight = quickBuyWeight;
                            if (quickBuyWeight === '✏️ Nhập cân nặng > 20kg' && quickBuyCustomWeight) {
                                actualWeight = quickBuyCustomWeight + 'kg';
                            }
                            const priceData = calculateDynamicPrice(quickBuyProduct, actualWeight);
                            return priceData.hasSurcharge;
                        })()">
                            <div class="text-orange-600 flex items-start">
                                <svg class="w-3 h-3 mr-1 text-orange-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                                <span x-text="isAdultInQuickBuy ? 'Size tay từ 17cm trở lên sẽ +20k' : 'Cân nặng từ 16kg trở lên sẽ +20k do size lớn hơn'"></span>
                            </div>
                        </template>

                        <!-- Hiển thị thông báo thường khi cân nặng < 16kg -->
                        <template x-if="(() => {
                            // Determine actual weight for calculation
                            let actualWeight = quickBuyWeight;
                            if (quickBuyWeight === '✏️ Nhập cân nặng > 20kg' && quickBuyCustomWeight) {
                                actualWeight = quickBuyCustomWeight + 'kg';
                            }
                            const priceData = calculateDynamicPrice(quickBuyProduct, actualWeight);
                            return !priceData.hasSurcharge;
                        })()">
                            <div class="text-gray-500 flex items-start">
                                <svg class="w-3 h-3 mr-1 text-pink-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span x-text="isAdultInQuickBuy ? 'Vui lòng chọn đúng size tay!' : 'Các mẹ chọn đúng cân nặng của bé không trừ hao nha.'"></span>
                                <span x-show="isAdultInQuickBuy" @click="openSizingGuideModal()" class="text-pink-600 underline cursor-pointer hover:text-pink-800 ml-1">Cách đo size</span>
                            </div>
                        </template>
                    </div>

                    <!-- Baby Name Input - Only for mix_the_ten_be products -->
                    <div x-show="quickBuyProduct?.categories?.includes('mix_the_ten_be')" class="mt-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tên bé cần khắc *</label>
                        <input type="text" x-model="quickBuyBabyName" placeholder="Nhập tên bé (Ví dụ Nhím - Nhật Minh)"
                               @input="clearFieldError('babyName')"
                               :class="formErrors.babyName ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                               class="w-full px-3 py-2.5 text-base rounded-lg transition-all border">
                        <div x-show="formErrors.babyName" x-text="formErrors.babyName" class="text-red-500 text-xs mt-1 flex items-center error-message">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                                <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <p class="text-xs text-gray-500 mt-1 flex items-center">
                            <svg class="w-3 h-3 mr-1 text-pink-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Ví dụ "Nhím - Nhật Minh" thì 1 mặt khắc tên "Nhím" 1 mặt khắc tên "Nhật Minh"
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1"
                               x-text="isEngravingProductInQuickBuy ? 'Nhập tên bé cần khắc' : 'Ghi chú thêm (tùy chọn)'"></label>
                        <input type="text" x-model="quickBuyNotes"
                               x-ref="quickBuyNotesInput"
                               :placeholder="isEngravingProductInQuickBuy ? 'Ví dụ: Hoàng Anh - Khoai Tây' : 'Ví dụ: Giao giờ hành chính, làm cẩn thận...'"
                               class="w-full px-3 py-2.5 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-all"
                               :class="{'!border-red-500': formErrors.quickBuyNotes}">
                        <p x-show="formErrors.quickBuyNotes" x-text="formErrors.quickBuyNotes" class="text-xs text-red-600 mt-1"></p>
                        <p x-show="isEngravingProductInQuickBuy && !formErrors.quickBuyNotes" class="text-xs text-gray-500 mt-1">
                            💡 Gợi ý: Nếu khắc 2 mặt, hãy ghi "Tên 1 - Tên 2" (ví dụ: "Nhím - Nhật Minh")
                        </p>
                    </div>

                    <!-- Mã giảm giá - Tái sử dụng component từ modal giỏ hàng -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mã giảm giá (tùy chọn)</label>
                        <div class="bg-white border border-gray-300 rounded-lg p-2.5">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2 flex-1 min-w-0">
                                    <svg x-show="discountCode && !appliedGift" class="h-4 w-4 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <svg x-show="appliedGift" class="h-4 w-4 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path>
                                    </svg>
                                    <p class="font-medium text-gray-700 text-sm truncate">
                                        <span x-show="!discountCode">Chọn mã giảm giá</span>
                                        <span x-show="discountCode" x-text="discountCode"></span>
                                    </p>
                                </div>
                                <button @click="openDiscountModal()" class="bg-pink-500 text-white font-medium py-2 px-3 rounded-lg hover:bg-pink-600 transition-colors text-sm flex-shrink-0">
                                    <span x-show="!appliedDiscountCode && !appliedGift">Chọn</span>
                                    <span x-show="appliedDiscountCode || appliedGift">Đổi</span>
                                </button>
                            </div>
                            <div x-show="appliedGift" class="text-sm text-gray-600 flex items-center mt-2">
                                <span class="mr-1">🎁</span>
                                <span class="truncate">Quà: <strong class="text-blue-600" x-text="appliedGift?.title"></strong></span>
                            </div>
                        </div>
                    </div>

                    <!-- Upsell Section - Compact -->
                    <div class="space-y-3">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-2.5">
                            <div class="text-center mb-2">
                                <p class="text-xs font-semibold text-green-700">💥 CỰC SỐC! Ưu đãi mua kèm!</p>
                                <p class="text-xs text-gray-600 mt-0.5">Còn: <span x-text="countdownTimer.display" class="font-mono font-semibold text-green-700 bg-green-100 px-1 py-0.5 rounded text-xs"></span></p>
                            </div>
                            <div class="space-y-1.5">
                                <template x-for="addon in filteredAddonProducts" :key="addon.id">
                                    <div @click="openAddonDetail(addon)" class="flex items-center space-x-2 p-2 bg-white rounded-md border border-green-100 cursor-pointer hover:bg-gray-50 transition-colors">
                                        <img :src="addon.image" class="w-8 h-8 rounded object-cover flex-shrink-0" loading="lazy">
                                        <div class="flex-grow min-w-0">
                                            <div class="flex items-center space-x-1">
                                                <p class="font-semibold text-gray-800 text-xs leading-tight truncate" x-text="addon.name"></p>
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-blue-600">
                                                    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                                    <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                            <div class="flex items-center space-x-1">
                                                <p class="text-xs text-pink-600 font-bold" x-text="formatCurrency(addon.price)"></p>
                                                <template x-if="addon.original_price"><s class="text-xs text-gray-400" x-text="formatCurrency(addon.original_price)"></s></template>
                                            </div>
                                        </div>
                                        <div class="flex flex-col items-center space-y-1">
                                            <button @click.stop="isAddonInCartForDisplay(addon.id) ? removeFromCart(addon.id) : addAddonToCart(addon)" class="text-xs font-medium rounded-md transition-colors h-6 w-12 flex items-center justify-center" :class="isAddonInCartForDisplay(addon.id) ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-pink-600 text-white hover:bg-pink-700'">
                                                <span x-text="isAddonInCartForDisplay(addon.id) ? 'Xóa' : 'Thêm'"></span>
                                            </button>
                                            <template x-if="addon.id === 'addon_tui_dau_tam'"><p class="text-xs text-green-600 font-semibold" x-text="isFreeshippingFromDiscount() ? '-8K' : '+ Freeship'"></p></template>
                                            <template x-if="addon.id === 'addon_bo_dau_tam_7_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                            <template x-if="addon.id === 'addon_bo_dau_tam_9_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                            <template x-if="addon.id === 'addon_moc_chia_khoa'"><p class="text-xs text-green-600 font-semibold">-5K</p></template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Phương thức thanh toán - Premium Card Design -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phương thức thanh toán *</label>

                        <div class="space-y-2">
                            <!-- COD Option - Compact Card -->
                            <div @click="quickBuyPaymentMethod = 'cod'"
                                 class="relative cursor-pointer group">
                                <div class="border-2 rounded-lg p-2.5 transition-all duration-300 transform"
                                     :class="quickBuyPaymentMethod === 'cod' ?
                                        'border-pink-500 bg-gradient-to-r from-pink-50 to-purple-50 shadow-md scale-[1.01]' :
                                        'border-gray-200 bg-white hover:border-pink-300 hover:shadow-sm'">

                                    <!-- Selection Indicator -->
                                    <div class="absolute top-1.5 right-1.5 w-4 h-4 rounded-full border-2 transition-all duration-300"
                                         :class="quickBuyPaymentMethod === 'cod' ? 'border-pink-500 bg-pink-500' : 'border-gray-300'">
                                        <div x-show="quickBuyPaymentMethod === 'cod'"
                                             class="w-1.5 h-1.5 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
                                             x-transition:enter="transition ease-out duration-200"
                                             x-transition:enter-start="opacity-0 scale-0"
                                             x-transition:enter-end="opacity-100 scale-100"></div>
                                    </div>

                                    <div class="flex items-center space-x-2.5">
                                        <div class="w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300"
                                             :class="quickBuyPaymentMethod === 'cod' ? 'bg-pink-100' : 'bg-gray-100 group-hover:bg-pink-50'">
                                            <span class="text-base">💰</span>
                                        </div>
                                        <div class="flex-1 pr-6">
                                            <h4 class="font-semibold text-sm transition-colors duration-300"
                                                :class="quickBuyPaymentMethod === 'cod' ? 'text-pink-700' : 'text-gray-800'">
                                                COD - Thanh toán khi nhận
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bank Transfer Option - Compact Card -->
                            <div @click="quickBuyPaymentMethod = 'bank_transfer'"
                                 class="relative cursor-pointer group">
                                <div class="border-2 rounded-lg p-2.5 transition-all duration-300 transform"
                                     :class="quickBuyPaymentMethod === 'bank_transfer' ?
                                        'border-green-500 bg-gradient-to-r from-green-50 to-emerald-50 shadow-md scale-[1.01]' :
                                        'border-gray-200 bg-white hover:border-green-300 hover:shadow-sm'">

                                    <!-- Selection Indicator -->
                                    <div class="absolute top-1.5 right-1.5 w-4 h-4 rounded-full border-2 transition-all duration-300"
                                         :class="quickBuyPaymentMethod === 'bank_transfer' ? 'border-green-500 bg-green-500' : 'border-gray-300'">
                                        <div x-show="quickBuyPaymentMethod === 'bank_transfer'"
                                             class="w-1.5 h-1.5 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
                                             x-transition:enter="transition ease-out duration-200"
                                             x-transition:enter-start="opacity-0 scale-0"
                                             x-transition:enter-end="opacity-100 scale-100"></div>
                                    </div>

                                    <div class="flex items-center space-x-2.5">
                                        <div class="w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300"
                                             :class="quickBuyPaymentMethod === 'bank_transfer' ? 'bg-green-100' : 'bg-gray-100 group-hover:bg-green-50'">
                                            <span class="text-base">🏦</span>
                                        </div>
                                        <div class="flex-1 pr-6">
                                            <h4 class="font-semibold text-sm transition-colors duration-300"
                                                :class="quickBuyPaymentMethod === 'bank_transfer' ? 'text-green-700' : 'text-gray-800'">
                                                Chuyển khoản ngân hàng
                                            </h4>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Thông tin chuyển khoản - Hiển thị khi chọn Bank Transfer -->
                        <div x-show="quickBuyPaymentMethod === 'bank_transfer'"
                             x-transition:enter="transition ease-out duration-300"
                             x-transition:enter-start="opacity-0 transform -translate-y-2"
                             x-transition:enter-end="opacity-100 transform translate-y-0"
                             x-transition:leave="transition ease-in duration-200"
                             x-transition:leave-start="opacity-100 transform translate-y-0"
                             x-transition:leave-end="opacity-0 transform -translate-y-2"
                             class="mt-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-3">

                            <!-- Header -->
                            <div class="flex items-center space-x-2 mb-2">
                                <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                    </svg>
                                </div>
                                <h5 class="font-semibold text-sm text-blue-800">Thông tin chuyển khoản</h5>
                            </div>

                            <!-- Total Amount - Prominent Display -->
                            <div class="bg-white border border-blue-200 rounded-md p-2 mb-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">Số tiền cần chuyển:</span>
                                    <span class="text-lg font-bold text-red-600" x-text="formatCurrency(quickBuyTotal)"></span>
                                </div>
                            </div>

                            <!-- Bank Info - Single Column Layout -->
                            <div class="space-y-1.5 text-xs">
                                <div>
                                    <span class="text-gray-600">Người nhận:</span>
                                    <span class="font-semibold text-gray-800 ml-2">LE THI ANH</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Ngân hàng:</span>
                                    <span class="font-semibold text-blue-700 ml-2">Techcombank</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="text-gray-600">Số tài khoản:</span>
                                    <span class="font-mono font-semibold text-gray-800 ml-2">0968969012</span>
                                    <button @click="copyBankAccount()"
                                            class="group flex items-center justify-center w-5 h-5 rounded hover:bg-blue-100 transition-colors duration-200 ml-1"
                                            title="Sao chép số tài khoản">
                                        <svg class="w-3 h-3 text-gray-400 group-hover:text-blue-600 transition-colors duration-200"
                                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                        </svg>
                                    </button>
                                </div>
                                <div>
                                    <span class="text-gray-600">Nội dung CK:</span>
                                    <span class="font-mono font-semibold text-green-700 ml-2" x-text="customer.phone || 'Số điện thoại của bạn'"></span>
                                </div>
                            </div>

                            <!-- Copy Button -->
                            <div class="mt-2 pt-2 border-t border-blue-200">
                                <!-- Copy Success Message -->
                                <div x-show="quickBuyCopySuccess"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 transform -translate-y-1"
                                     x-transition:enter-end="opacity-100 transform translate-y-0"
                                     x-transition:leave="transition ease-in duration-200"
                                     x-transition:leave-start="opacity-100 transform translate-y-0"
                                     x-transition:leave-end="opacity-0 transform -translate-y-1"
                                     class="mb-2 p-2 bg-green-50 border border-green-200 rounded-md">
                                    <div class="flex items-center space-x-1">
                                        <svg class="w-3 h-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <p class="text-xs text-green-700 font-medium">Đã sao chép số tài khoản!</p>
                                    </div>
                                </div>

                                <!-- Button Xác nhận chuyển khoản -->
                                <button @click.stop="isQuickBuyTransferConfirmed = true"
                                        :class="isQuickBuyTransferConfirmed ? 'bg-blue-600 hover:bg-blue-700' : 'bg-green-600 hover:bg-green-700'"
                                        class="w-full py-1.5 text-white text-xs font-medium rounded-md transition-colors duration-200 flex items-center justify-center space-x-1">
                                    <svg x-show="!isQuickBuyTransferConfirmed" class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <svg x-show="isQuickBuyTransferConfirmed" class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span x-text="isQuickBuyTransferConfirmed ? 'Đã chuyển khoản' : 'Xác nhận chuyển khoản'"></span>
                                </button>
                            </div>

                            <!-- Important Note -->
                            <div class="mt-2">
                                <p class="text-xs text-gray-700">
                                    <strong>Lưu ý:</strong> Vui lòng chuyển đúng số tiền và nội dung.
                                </p>
                            </div>
                        </div>

                        <!-- Payment method error -->
                        <div x-show="formErrors.quickBuyPaymentMethod" x-text="formErrors.quickBuyPaymentMethod" class="text-red-500 text-xs mt-2 flex items-center error-message">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-1 flex-shrink-0">
                                <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Chi tiết đơn hàng -->
                <div class="bg-gray-50 rounded-lg p-3 space-y-3">
                    <!-- Header -->
                    <div class="flex items-center space-x-2 pb-2 border-b border-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-gray-600">
                            <path fill-rule="evenodd" d="M7.502 6h7.128A3.375 3.375 0 0 1 18 9.375v9.375a3 3 0 0 0 3-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 0 0-.673-.05A3 3 0 0 0 15 1.5h-1.5a3 3 0 0 0-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6ZM13.5 3A1.5 1.5 0 0 0 12 4.5h4.5A1.5 1.5 0 0 0 15 3h-1.5Z" clip-rule="evenodd" />
                            <path fill-rule="evenodd" d="M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V9.375ZM6 12a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V12Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 15a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V15Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 18a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V18Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
                        </svg>
                        <h4 class="text-sm font-semibold text-gray-800">Chi tiết đơn hàng</h4>
                    </div>

                    <!-- Sản phẩm chính -->
                    <div class="space-y-2">
                        <div class="flex justify-between items-start text-sm">
                            <div class="flex items-start space-x-2 flex-1 pr-2">
                                <img :src="quickBuyProduct?.image" class="w-10 h-10 rounded object-cover flex-shrink-0" :alt="quickBuyProduct?.name" loading="lazy">
                                <div class="flex-1 min-w-0">
                                    <p class="font-medium text-gray-800 leading-tight" x-text="quickBuyProduct?.name"></p>
                                    <p class="text-xs text-gray-500">
                                        <span x-text="'SL: ' + quickBuyQuantity"></span>
                                        <template x-if="quickBuyWeight">
                                            <span x-text="' • Cân nặng: ' + quickBuyWeight"></span>
                                        </template>
                                    </p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-gray-800" x-text="formatCurrency((() => {
                                    let actualWeight = quickBuyWeight;
                                    if (quickBuyWeight === '✏️ Nhập cân nặng > 20kg' && quickBuyCustomWeight) {
                                        actualWeight = quickBuyCustomWeight + 'kg';
                                    }
                                    return calculateDynamicPrice(quickBuyProduct, actualWeight).finalPrice * quickBuyQuantity;
                                })())"></p>
                                <template x-if="(() => {
                                    let actualWeight = quickBuyWeight;
                                    if (quickBuyWeight === '✏️ Nhập cân nặng > 20kg' && quickBuyCustomWeight) {
                                        actualWeight = quickBuyCustomWeight + 'kg';
                                    }
                                    return calculateDynamicPrice(quickBuyProduct, actualWeight).hasSurcharge;
                                })()">
                                    <p class="text-xs text-orange-600">Phụ phí +20k</p>
                                </template>
                            </div>
                        </div>

                        <!-- Sản phẩm bán kèm -->
                        <template x-for="addon in quickBuyAddons" :key="addon.id">
                            <div class="flex justify-between items-start text-sm bg-green-50 rounded-md p-2 border border-green-100">
                                <div class="flex-1 pr-2">
                                    <p class="font-medium text-gray-800" x-text="addon.name"></p>
                                    <p class="text-xs text-green-600 font-medium">
                                        <span x-text="'SL: ' + addon.quantity + ' • Sản phẩm bán kèm'"></span>
                                    </p>
                                </div>
                                <div class="text-right">
                                    <p class="font-medium text-gray-800" x-text="formatCurrency(addon.price * addon.quantity)"></p>
                                    <template x-if="addon.id === 'addon_tui_dau_tam'">
                                        <p class="text-xs text-green-600 font-medium">Tặng freeship</p>
                                    </template>
                                    <template x-if="addon.id === 'addon_moc_chia_khoa'">
                                        <p class="text-xs text-green-600 font-medium">Giảm 5K đơn hàng</p>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Tính toán -->
                    <div class="space-y-1 pt-2 border-t border-gray-200">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Tạm tính</span>
                            <span class="font-medium" x-text="formatCurrency(quickBuySubtotal)"></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Phí vận chuyển</span>
                            <span class="font-medium" x-text="formatCurrency(SHIPPING_FEE)"></span>
                        </div>

                        <!-- Miễn phí ship cho combo -->
                        <template x-if="quickBuyProduct && quickBuyProduct.freeShipping">
                            <div class="flex justify-between text-sm text-green-600 font-medium">
                                <span>💥 Freeship combo</span>
                                <span>-21.000đ</span>
                            </div>
                        </template>

                        <!-- Miễn phí ship từ addon (không phải combo) -->
                        <template x-if="quickBuyShippingDiscount > 0 && !isBuyingCombo">
                            <div class="flex justify-between text-sm text-green-600 font-medium">
                                <span>Miễn phí ship</span>
                                <span x-text="'-' + formatCurrency(quickBuyShippingDiscount)"></span>
                            </div>
                        </template>
                        <template x-if="discountAmount > 0">
                            <div class="flex justify-between text-sm text-green-600 font-medium">
                                <span>Mã giảm giá <span x-text="'(' + appliedDiscountCode + ')'"></span></span>
                                <span x-text="'-' + formatCurrency(discountAmount)"></span>
                            </div>
                        </template>
                        <template x-if="quickBuyAddonDiscount > 0">
                            <div class="flex justify-between text-sm text-green-600 font-medium">
                                <span>Giảm giá bán kèm</span>
                                <span x-text="'-' + formatCurrency(quickBuyAddonDiscount)"></span>
                            </div>
                        </template>
                    </div>

                    <!-- Tổng cộng -->
                    <div class="border-t-2 border-gray-300 pt-2 flex justify-between font-bold text-base">
                        <span class="text-gray-800">Tổng cộng</span>
                        <span class="text-pink-600" x-text="formatCurrency(quickBuyTotal)"></span>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex-shrink-0 bg-white border-t border-gray-200 p-3 rounded-b-3xl sm:rounded-b-2xl">
                <div class="flex gap-2">
                    <button @click="console.log('🔍 Cancel button clicked on QuickBuy'); closeQuickBuyModal()" class="px-4 py-2.5 sm:py-3 bg-gray-200 text-gray-700 font-medium rounded-lg text-xs sm:text-sm">
                        Hủy
                    </button>
                    <button @click="quickBuySubmit()" :disabled="isQuickBuySubmitting || !canPlaceQuickBuyOrder"
                            :class="canPlaceQuickBuyOrder && !isQuickBuySubmitting ?
                                'bg-gradient-to-r from-pink-500 to-purple-600' :
                                'bg-gray-400 cursor-not-allowed'"
                            class="flex-1 px-4 py-2.5 sm:py-3 text-white font-bold rounded-lg text-xs sm:text-sm shadow-lg">

                        <!-- Loading spinner -->
                        <svg x-show="isQuickBuySubmitting" class="loading-spinner w-4 h-4 text-white inline mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>

                        <!-- Single span with computed text -->
                        <span x-text="isQuickBuySubmitting ? 'Đang xử lý...' : (canPlaceQuickBuyOrder ? `Đặt hàng • ${formatCurrency(quickBuyTotal)}` : 'Xác nhận chuyển khoản')"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Transfer Confirmation Modal -->
    <div x-show="isCheckoutConfirmTransferModalOpen" @keydown.escape.window="isCheckoutConfirmTransferModalOpen = false"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 z-[9950]">
        <div
             class="bg-white rounded-2xl shadow-2xl w-full max-w-sm">

            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-4 rounded-t-2xl">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">Xác nhận chuyển khoản</h3>
                        <p class="text-blue-100 text-sm">Vui lòng xác nhận trước khi đặt hàng</p>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="p-4">
                <!-- Confirmation State -->
                <div class="text-center mb-4">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <span class="text-2xl">🏦</span>
                    </div>
                    <h4 class="font-semibold text-gray-800 text-base mb-2">Bạn đã chuyển khoản thanh toán đầy đủ số tiền rồi chứ?</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">Vui lòng xác nhận bạn đã thực hiện chuyển khoản với đầy đủ số tiền <strong class="text-blue-600" x-text="formatCurrency(cartTotal())"></strong> trước khi đặt hàng.</p>
                </div>

                <!-- Bank Info Reminder -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                    <div class="text-xs space-y-1.5">
                        <div>
                            <span class="text-gray-600">Tên người nhận:</span>
                            <span class="font-semibold text-gray-800 ml-2">LE THI ANH</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-gray-600">Số tài khoản:</span>
                            <span class="font-mono font-semibold text-gray-800 ml-2">0968969012</span>
                            <button @click="copyBankAccount()"
                                    class="group flex items-center justify-center w-5 h-5 rounded hover:bg-blue-100 transition-colors duration-200 ml-1"
                                    title="Sao chép số tài khoản">
                                <svg class="w-3 h-3 text-gray-400 group-hover:text-blue-600 transition-colors duration-200"
                                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                            </button>
                        </div>
                        <div>
                            <span class="text-gray-600">Ngân hàng:</span>
                            <span class="font-semibold text-blue-700 ml-2">Techcombank</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Nội dung CK:</span>
                            <span class="font-mono font-semibold text-green-700 ml-2" x-text="customer.phone"></span>
                        </div>
                        <div class="border-t border-blue-200 pt-1.5 mt-2">
                            <span class="text-gray-600">Số tiền:</span>
                            <span class="font-bold text-blue-700 ml-2" x-text="formatCurrency(cartTotal())"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex gap-2 p-4 pt-0">
                <button @click="isCheckoutConfirmTransferModalOpen = false"
                        class="flex-1 py-2.5 sm:py-3 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-colors text-xs sm:text-sm">
                    Chưa chuyển
                </button>
                <button @click="isCheckoutConfirmTransferModalOpen = false; validateAndShowConfirmModal()"
                        class="flex-1 py-2.5 sm:py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all text-xs sm:text-sm shadow-lg">
                    Đã chuyển khoản
                </button>
            </div>
        </div>
    </div>

        <!-- Product Detail Modal -->
    <div x-show="isProductDetailOpen" @keydown.escape.window="console.log('🔍 ESC pressed on ProductDetail, isQuickBuyModalOpen:', isQuickBuyModalOpen, 'isDiscountModalOpen:', isDiscountModalOpen); if (!isQuickBuyModalOpen && !isDiscountModalOpen) closeProductDetail()"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-3 sm:p-4 pt-safe-top pb-safe-bottom z-[9000]">
        <div class="bg-white rounded-3xl sm:rounded-2xl shadow-xl w-full max-w-sm sm:max-w-2xl max-h-[85vh] sm:max-h-[90vh] overflow-hidden transform">

            <template x-if="currentProductDetail">
                <div class="flex flex-col h-full max-h-[85vh] sm:max-h-[90vh]">
                    <!-- Header - Simplified -->
                    <div class="flex-shrink-0 px-3 sm:px-4 py-3 border-b bg-white">
                        <div class="flex items-center justify-between">
                            <div class="flex-1 min-w-0">
                                <h2 class="text-base font-semibold text-gray-900 truncate" x-text="currentProductDetail.name"></h2>
                            </div>
                            <button @click="closeProductDetail()"
                                    class="ml-3 text-pink-600 hover:text-white w-8 h-8 bg-pink-100 hover:bg-pink-500 rounded-full flex items-center justify-center flex-shrink-0 transition-all shadow-sm hover:shadow-md">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Content - Scrollable (bao gồm cả hình ảnh) -->
                    <div class="flex-1 overflow-y-auto modal-scroll px-3 py-2 space-y-2">
                        <!-- Product Image -->
                        <div class="relative bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl aspect-square">
                            <img :src="currentProductDetail.image" :alt="currentProductDetail.name"
                                 class="w-full h-full object-cover rounded-xl shadow-lg" loading="lazy">
                            <!-- Sale Badge -->
                            <template x-if="currentProductDetail.original_price">
                                <div class="absolute top-3 left-3 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold">
                                    SALE
                                </div>
                            </template>
                        </div>

                        <!-- Price Section - Mobile Optimized -->
                        <div class="bg-white rounded-2xl p-3 sm:p-5 shadow-sm border border-gray-100">
                            <!-- Price Row -->
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-baseline space-x-2 sm:space-x-3 flex-wrap">
                                        <span class="text-2xl sm:text-3xl font-black text-gray-900" x-text="formatCurrency(currentProductDetail.price)"></span>
                                        <template x-if="currentProductDetail.original_price">
                                            <span class="text-sm sm:text-base text-gray-400 line-through" x-text="formatCurrency(currentProductDetail.original_price)"></span>
                                        </template>
                                    </div>
                                </div>
                                <template x-if="currentProductDetail.original_price">
                                    <div class="bg-gradient-to-r from-red-500 to-red-600 text-white px-2 py-1 sm:px-3 sm:py-1.5 rounded-lg text-xs sm:text-sm font-bold shadow-lg flex-shrink-0 ml-2">
                                        <div class="text-center">
                                            <div class="text-[10px] sm:text-xs">TIẾT KIỆM</div>
                                            <div class="text-sm sm:text-base" x-text="Math.round((1 - currentProductDetail.price / currentProductDetail.original_price) * 100) + '%'"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <!-- Divider -->
                            <div class="border-t border-gray-100 my-2 sm:my-3"></div>

                            <!-- Stats Row - Mobile Optimized Layout -->
                            <div class="flex items-center justify-between">
                                <!-- Mobile: Flex layout với tỷ lệ tùy chỉnh, Desktop: Flex với space-x-4 -->
                                <div class="flex items-center w-full sm:space-x-4">
                                    <!-- Rating - Ít diện tích (20%) -->
                                    <div class="flex items-center space-x-1 w-1/5 sm:w-auto">
                                        <svg class="w-3 h-3 sm:w-4 sm:h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                        </svg>
                                        <span class="text-xs sm:text-sm font-medium text-gray-700" x-text="currentProductDetail.rating"></span>
                                    </div>

                                    <!-- Separator -->
                                    <div class="hidden sm:block w-px h-3 sm:h-4 bg-gray-300"></div>

                                    <!-- Sales - Vừa phải (35%) -->
                                    <div class="flex items-center space-x-1 w-2/5 sm:w-auto justify-center sm:justify-start">
                                        <svg class="w-3 h-3 sm:w-4 sm:h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                        </svg>
                                        <span class="text-xs sm:text-sm font-medium text-gray-700" x-text="`${currentProductDetail.purchases}+ bán`"></span>
                                    </div>

                                    <!-- Separator -->
                                    <div class="hidden sm:block w-px h-3 sm:h-4 bg-gray-300"></div>

                                    <!-- Trust Badge - Nhiều diện tích (45%) -->
                                    <div class="flex items-center space-x-1 bg-green-50 px-2 py-1 rounded-full w-2/5 sm:w-auto justify-center sm:justify-start">
                                        <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        <span class="text-xs font-medium text-green-700">Thủ công 100%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Social Proof - Live Viewers -->
                        <div class="mb-4">
                            <div class="bg-orange-50/50 rounded-lg px-3 py-2 flex items-center space-x-2">
                                <div class="relative flex items-center justify-center w-4 h-4">
                                    <!-- Ripple effects -->
                                    <div class="absolute w-3 h-3 bg-orange-300 rounded-full live-ripple"></div>
                                    <div class="absolute w-3 h-3 bg-orange-200 rounded-full live-ripple-delayed"></div>
                                    <!-- Core dot -->
                                    <div class="w-2 h-2 bg-orange-500 rounded-full live-dot relative z-10"></div>
                                </div>
                                <p class="text-sm text-orange-700 font-medium flex items-center">
                                    <span class="font-bold mx-1 text-orange-800" x-text="productDetailViewers"></span>
                                    <span> người cũng đang xem sản phẩm này</span>
                                </p>
                            </div>
                        </div>

                        <!-- Upsell Section - Compact -->
                        <div class="space-y-3 mb-6">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-2.5">
                                <div class="text-center mb-2">
                                    <p class="text-xs font-semibold text-green-700">💥 CỰC SỐC! Ưu đãi mua kèm!</p>
                                    <p class="text-xs text-gray-600 mt-0.5">Còn: <span x-text="countdownTimer.display" class="font-mono font-semibold text-green-700 bg-green-100 px-1 py-0.5 rounded text-xs"></span></p>
                                </div>
                                <div class="space-y-1.5">
                                    <template x-for="addon in filteredAddonProducts" :key="addon.id">
                                        <div @click="openAddonDetail(addon)" class="flex items-center space-x-2 p-2 bg-white rounded-md border border-green-100 cursor-pointer hover:bg-gray-50 transition-colors">
                                            <img :src="addon.image" class="w-8 h-8 rounded object-cover flex-shrink-0" loading="lazy">
                                            <div class="flex-grow min-w-0">
                                                <div class="flex items-center space-x-1">
                                                    <p class="font-semibold text-gray-800 text-xs leading-tight truncate" x-text="addon.name"></p>
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-blue-600">
                                                        <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                                        <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
                                                    </svg>
                                                </div>
                                                <div class="flex items-center space-x-1">
                                                    <p class="text-xs text-pink-600 font-bold" x-text="formatCurrency(addon.price)"></p>
                                                    <template x-if="addon.original_price"><s class="text-xs text-gray-400" x-text="formatCurrency(addon.original_price)"></s></template>
                                                </div>
                                            </div>
                                            <div class="flex flex-col items-center space-y-1">
                                                <button @click.stop="isAddonInCartForDisplay(addon.id) ? removeFromCart(addon.id) : addAddonToCart(addon)" class="text-xs font-medium rounded-md transition-colors h-6 w-12 flex items-center justify-center" :class="isAddonInCartForDisplay(addon.id) ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-pink-600 text-white hover:bg-pink-700'">
                                                    <span x-text="isAddonInCartForDisplay(addon.id) ? 'Xóa' : 'Thêm'"></span>
                                                </button>
                                                <template x-if="addon.id === 'addon_tui_dau_tam'"><p class="text-xs text-green-600 font-semibold" x-text="isFreeshippingFromDiscount() ? '-8K' : '+ Freeship'"></p></template>
                                                <template x-if="addon.id === 'addon_bo_dau_tam_7_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                                <template x-if="addon.id === 'addon_bo_dau_tam_9_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                                <template x-if="addon.id === 'addon_moc_chia_khoa'"><p class="text-xs text-green-600 font-semibold">-5K</p></template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- Lưu ý quan trọng -->
                        <div x-show="shouldShowBeadCountNote(currentProductDetail)" class="mb-6 p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-200">
                            <div class="flex items-start space-x-3">

                                <div>
                                    <h4 class="text-sm font-bold text-amber-800 mb-2 underline">💡 Lưu ý quan trọng</h4>
                                    <p class="text-sm text-amber-700 leading-relaxed">
                                        Số hạt dâu em làm vòng được làm theo "Sinh Lão Bệnh Tử", số hạt em làm đều là số đẹp rơi vào chữ "Sinh" hoặc chữ "Lão" (lấy số hạt dâu chia cho 4, nếu dư 1 là "Sinh", nếu dư 2 là "Lão" ạ) nên các mẹ yên tâm đeo cho bé nha.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic Product Details Section -->
                        <template x-if="productDetailContent">
                            <div class="mb-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4" x-text="productDetailContent.title"></h3>

                                <template x-for="section in productDetailContent.sections" :key="section.heading">
                                    <div class="mb-6">
                                        <h4 class="text-base font-semibold text-gray-800 mb-3" x-text="section.heading"></h4>
                                        <div class="space-y-2">
                                            <template x-for="item in section.content" :key="item">
                                                <div class="flex items-start space-x-2">
                                                    <span class="text-green-500 mt-1">•</span>
                                                    <span class="text-gray-700" x-text="item"></span>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Fallback content if productDetailContent is not available -->
                        <template x-if="!productDetailContent">
                            <div class="mb-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-3">💎 Thông Tin Sản Phẩm</h3>
                                <div class="space-y-2">
                                    <div class="flex items-start space-x-2">
                                        <span class="text-green-500 mt-1">•</span>
                                        <span class="text-gray-700">100% tự nhiên, an toàn cho làn da nhạy cảm</span>
                                    </div>
                                    <div class="flex items-start space-x-2">
                                        <span class="text-green-500 mt-1">•</span>
                                        <span class="text-gray-700">Chất lượng cao, được kiểm tra kỹ lưỡng</span>
                                    </div>
                                </div>
                            </div>
                        </template>


                    </div>

                    <!-- Fixed Footer -->
                    <div class="flex-shrink-0 bg-white border-t border-gray-200 p-3 rounded-b-3xl sm:rounded-b-2xl">
                        <div class="flex space-x-2">
                            <button @click="addProductDetailToCart()"
                                    class="flex-1 bg-pink-100 text-pink-700 font-semibold py-3 px-3 rounded-lg hover:bg-pink-200 transition-colors flex items-center justify-center space-x-1">
                                <div class="relative">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                        <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19H16.16a1.75 1.75 0 0 0 1.743-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5ZM7.5 10a2.5 2.5 0 0 0 5 0V8.75a.75.75 0 0 1 1.5 0V10a4 4 0 0 1-8 0V8.75a.75.75 0 0 1 1.5 0V10Z" clip-rule="evenodd" />
                                    </svg>
                                    <div class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-pink-700 text-white rounded-full flex items-center justify-center text-xs font-bold">
                                        +
                                    </div>
                                </div>
                                <span class="text-sm">Thêm vào giỏ</span>
                            </button>
                            <button @click="buyProductDetailNow()"
                                    class="flex-1 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-3 rounded-lg transition-all flex items-center justify-center space-x-1 shadow-lg">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                </svg>
                                <span class="text-sm">Mua ngay</span>
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Hand Size Modal for Adult Products - Centered with Proper Spacing -->
    <div x-show="isHandSizeModalOpen" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9400]" @click.away="closeHandSizeModal()">
        <div x-show="isHandSizeModalOpen" class="bg-white w-full max-w-sm sm:max-w-md lg:max-w-lg xl:max-w-xl mx-auto rounded-2xl shadow-2xl overflow-hidden max-h-[85vh] sm:max-h-[90vh] flex flex-col transform my-4" @click.stop>

            <!-- Header - Compact -->
            <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-2 sm:p-4 rounded-t-2xl flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-1 sm:space-x-2">
                        <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-sm sm:text-base font-bold">Chọn size tay</h3>
                        </div>
                    </div>
                    <button @click="closeHandSizeModal()" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Hand Size Selection Section - Scrollable Content -->
            <div class="flex-1 overflow-y-auto px-4 pt-4">


                <!-- Hand Size Options Grid -->
                <div class="space-y-3 mb-4 sm:mb-6">
                    <!-- Preset Hand Sizes - 13cm to 20cm -->
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-3 rounded-lg border border-purple-100">
                        <p class="text-xs text-gray-600 mb-3 text-center font-medium">⚡ Chọn nhanh size tay phổ biến</p>
                        <div class="grid grid-cols-4 gap-2">
                            <template x-for="size in ['13cm', '14cm', '15cm', '16cm', '17cm', '18cm', '19cm', '20cm']" :key="'handsize-' + size">
                                <button @click="selectHandSize(size)"
                                        :class="handSizeOptions.selectedSize === size ? 'bg-purple-500 text-white border-purple-500 shadow-md' : 'bg-white text-gray-700 border-gray-200 hover:border-purple-300 active:bg-purple-50'"
                                        class="py-2.5 px-2 text-xs font-bold border-2 rounded-lg transition-all duration-200 hover:shadow-sm touch-manipulation">
                                    <span x-text="size"></span>
                                </button>
                            </template>
                        </div>
                    </div>

<!-- Size Guide Banner -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-3 rounded-lg border border-blue-100 mb-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-blue-600">📏</span>
                            <span class="text-xs font-medium text-blue-800">Hướng dẫn đo size</span>
                        </div>
                        <button @click="showHandSizeGuide = !showHandSizeGuide"
                                class="text-blue-600 hover:text-blue-800 text-xs font-medium">
                            <span x-text="showHandSizeGuide ? 'Ẩn' : 'Xem'"></span>
                        </button>
                    </div>

                    <!-- Size Guide Content -->
                    <div x-show="showHandSizeGuide"
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 transform scale-95"
                         x-transition:enter-end="opacity-100 transform scale-100"
                         class="mt-3 pt-3 border-t border-blue-200">
                        <div class="space-y-2">
                            <p class="text-xs text-blue-700">
                                <strong>Cách đo:</strong> Cuốn thước dây sát cổ tay hoặc sợi chỉ quấn sát cổ tay, sau đó đo độ dài sợi dây bằng thước kẻ.
                            </p>
                            <p class="text-xs text-blue-700">
                                <strong>Mẹo:</strong> Nếu không có thước thì lấy tờ tiền 500k quấn sát cổ tay, tờ 500k dài 15cm, xem thừa thiếu bao nhiêu là ra size tay.
                            </p>
                            <p class="text-xs text-blue-700">
                                <strong>Lưu ý:</strong> Quấn sát cổ tay không trừ hao cả sẽ bị rộng.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Upsell Section - Compact -->
                <div class="space-y-3 mb-4">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-2.5">
                        <div class="text-center mb-2">
                            <p class="text-xs font-semibold text-green-700">💥 CỰC SỐC! Ưu đãi mua kèm!</p>
                            <p class="text-xs text-gray-600 mt-0.5">Còn: <span x-text="countdownTimer.display" class="font-mono font-semibold text-green-700 bg-green-100 px-1 py-0.5 rounded text-xs"></span></p>
                        </div>
                        <div class="space-y-1.5">
                            <template x-for="addon in filteredAddonProducts" :key="addon.id">
                                <div @click="openAddonDetail(addon)" class="flex items-center space-x-2 p-2 bg-white rounded-md border border-green-100 cursor-pointer hover:bg-gray-50 transition-colors">
                                    <img :src="addon.image" class="w-8 h-8 rounded object-cover flex-shrink-0" loading="lazy">
                                    <div class="flex-grow min-w-0">
                                        <div class="flex items-center space-x-1">
                                            <p class="font-semibold text-gray-800 text-xs leading-tight truncate" x-text="addon.name"></p>
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-blue-600">
                                                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                                <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                            <p class="text-xs text-pink-600 font-bold" x-text="formatCurrency(addon.price)"></p>
                                            <template x-if="addon.original_price"><s class="text-xs text-gray-400" x-text="formatCurrency(addon.original_price)"></s></template>
                                        </div>
                                    </div>
                                    <div class="flex flex-col items-center space-y-1">
                                        <button @click.stop="isAddonInCartForDisplay(addon.id) ? removeFromCart(addon.id) : addAddonToCart(addon)" class="text-xs font-medium rounded-md transition-colors h-6 w-12 flex items-center justify-center" :class="isAddonInCartForDisplay(addon.id) ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-pink-600 text-white hover:bg-pink-700'">
                                            <span x-text="isAddonInCartForDisplay(addon.id) ? 'Xóa' : 'Thêm'"></span>
                                        </button>
                                        <template x-if="addon.id === 'addon_tui_dau_tam'"><p class="text-xs text-green-600 font-semibold" x-text="isFreeshippingFromDiscount() ? '-8K' : '+ Freeship'"></p></template>
                                        <template x-if="addon.id === 'addon_bo_dau_tam_7_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                        <template x-if="addon.id === 'addon_bo_dau_tam_9_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                        <template x-if="addon.id === 'addon_moc_chia_khoa'"><p class="text-xs text-green-600 font-semibold">-5K</p></template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                </div>

            </div>

            <!-- Footer - Compact -->
            <div class="flex-shrink-0 p-3 border-t bg-white rounded-b-2xl">
                <button @click="addItemWithHandSize()"
                        :disabled="!handSizeOptions.selectedSize"
                        :class="!handSizeOptions.selectedSize ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold'"
                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg text-xs sm:text-sm shadow-md">
                    <span class="flex items-center justify-center">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        Thêm vào giỏ hàng
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Item Options Modal - Centered with Proper Spacing -->
    <div x-show="isItemOptionsModalOpen" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9400]" @click.away="closeItemOptionsModal()">
        <div x-show="isItemOptionsModalOpen" class="bg-white w-full max-w-sm sm:max-w-md lg:max-w-lg xl:max-w-xl mx-auto rounded-2xl shadow-2xl overflow-hidden max-h-[85vh] sm:max-h-[90vh] flex flex-col transform my-4" @click.stop>

			<!-- Header - Compact (Unified with Bead Quantity Modal) -->
			<div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-2 sm:p-4 rounded-t-2xl flex-shrink-0">
				<div class="flex items-center justify-between">
					<div class="flex items-center space-x-1 sm:space-x-2">
						<div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
							<svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h8M8 11h8m-8 4h5"/>
							</svg>
						</div>
						<div>
							<h3 class="text-sm sm:text-base font-bold">Chọn cân nặng bé</h3>
						</div>
					</div>
					<button @click="closeItemOptionsModal()" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
						<svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
						</svg>
					</button>
				</div>
			</div>

			<!-- Weight Selection Section - Scrollable Content -->
            <div class="flex-1 overflow-y-auto px-4 pt-4">
				<!-- Product Info (moved from header for consistency) -->
				<div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl p-3 sm:p-4 border border-pink-100 mb-3">
					<div class="flex items-center space-x-3">
						<img :src="currentItemForOptions?.image" alt="Product Image" class="w-12 h-12 sm:w-14 sm:h-14 rounded-md object-cover shadow-sm border border-pink-100" loading="lazy">
						<div>
							<h3 class="text-sm sm:text-base font-bold text-gray-800" x-text="currentItemForOptions?.name || 'Tùy chỉnh sản phẩm'"></h3>
							<!-- Dynamic Price Display -->
							<div class="space-y-1">
								<template x-if="!itemOptions.selectedWeight || itemOptions.selectedWeight === 'Chưa sinh'">
									<p class="text-pink-600 font-bold text-sm sm:text-base" x-text="formatCurrency(currentItemForOptions?.price || 0)"></p>
								</template>
								<template x-if="itemOptions.selectedWeight && itemOptions.selectedWeight !== 'Chưa sinh'">
									<div>
										<template x-if="(() => {
											const weight = itemOptions.selectedWeight === 'custom' ? itemOptions.customWeight + 'kg' : itemOptions.selectedWeight;
											const priceData = calculateDynamicPrice(currentItemForOptions, weight);
											return !priceData.hasSurcharge;
										})()">
											<p class="text-pink-600 font-bold text-sm sm:text-base" x-text="(() => {
												const weight = itemOptions.selectedWeight === 'custom' ? itemOptions.customWeight + 'kg' : itemOptions.selectedWeight;
												const priceData = calculateDynamicPrice(currentItemForOptions, weight);
												return formatCurrency(priceData.finalPrice);
											})()"></p>
										</template>
										<template x-if="(() => {
											const weight = itemOptions.selectedWeight === 'custom' ? itemOptions.customWeight + 'kg' : itemOptions.selectedWeight;
											const priceData = calculateDynamicPrice(currentItemForOptions, weight);
											return priceData.hasSurcharge;
										})()">
											<div>
												<p class="text-pink-600 font-bold text-sm sm:text-base" x-text="(() => {
													const weight = itemOptions.selectedWeight === 'custom' ? itemOptions.customWeight + 'kg' : itemOptions.selectedWeight;
													const priceData = calculateDynamicPrice(currentItemForOptions, weight);
													return formatCurrency(priceData.finalPrice);
												})()"></p>
												<p class="text-xs text-gray-600" x-text="(() => {
													const weight = itemOptions.selectedWeight === 'custom' ? itemOptions.customWeight + 'kg' : itemOptions.selectedWeight;
													const priceData = calculateDynamicPrice(currentItemForOptions, weight);
													return formatCurrency(currentItemForOptions?.price) + ' + ' + formatCurrency(priceData.surcharge) + ' (size lớn)';
												})()"></p>
											</div>
										</template>
									</div>
								</template>
							</div>
						</div>
					</div>
				</div>
                <!-- Section Title -->
				<div class="mb-4 sm:mb-6">
					<div class="flex items-start gap-2.5 rounded-lg border border-amber-200 bg-gradient-to-r from-amber-50 to-orange-50 p-3 sm:p-4 shadow-[0_1px_0_rgba(251,191,36,0.25)]">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" class="h-4 w-4 sm:h-5 sm:w-5 text-amber-600 mt-0.5 flex-shrink-0">
							<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
						</svg>
						<div class="text-left">
							<p class="text-xs sm:text-sm text-amber-800 font-medium">Lưu ý: Vui lòng chọn đúng cân nặng của bé, không trừ hao.</p>
							<p class="hidden sm:block text-xs text-amber-700 mt-0.5">Chọn chính xác giúp vòng vừa tay và lên form đẹp cho bé.</p>
						</div>
					</div>
				</div>

                <!-- Weight Options Grid -->
                <div class="space-y-3 mb-4 sm:mb-6">
                    <!-- Quick Preset Weights - 3kg to 15kg, 5 buttons per row -->
                    <div class="bg-gradient-to-r from-pink-50 to-purple-50 p-3 rounded-lg border border-pink-100">
                        <p class="text-xs text-gray-600 mb-2 text-center font-medium">⚡ Chọn nhanh cân nặng</p>
                        <div class="grid grid-cols-4 gap-1.5">
                            <!-- Special option - Chưa sinh -->
                            <button @click="itemOptions.selectedWeight = 'Chưa sinh'"
                                    :class="itemOptions.selectedWeight === 'Chưa sinh' ? 'bg-pink-500 text-white border-pink-500 shadow-md' : 'bg-white text-gray-700 border-gray-200 hover:border-pink-300 active:bg-pink-50'"
                                    class="py-2 px-1 text-xs font-bold border-2 rounded-md transition-all duration-200 hover:shadow-sm touch-manipulation">
                                <span>Chưa sinh</span>
                            </button>
                            <template x-for="weight in ['3kg', '4kg', '5kg', '6kg', '7kg', '8kg', '9kg', '10kg', '11kg', '12kg', '13kg', '14kg', '15kg']" :key="'preset-' + weight">
                                <button @click="itemOptions.selectedWeight = weight"
                                        :class="itemOptions.selectedWeight === weight ? 'bg-pink-500 text-white border-pink-500 shadow-md' : 'bg-white text-gray-700 border-gray-200 hover:border-pink-300 active:bg-pink-50'"
                                        class="py-2 px-1 text-xs font-bold border-2 rounded-md transition-all duration-200 hover:shadow-sm touch-manipulation">
                                    <span x-text="weight"></span>
                                </button>
                            </template>
                        </div>
                    </div>



                    <!-- Custom weight option -->
                    <button @click="itemOptions.selectedWeight = 'custom'"
                            :class="itemOptions.selectedWeight === 'custom' ? 'bg-pink-500 text-white border-pink-500' : 'bg-white text-gray-700 border-gray-200 hover:border-pink-300 active:bg-pink-50'"
                            class="w-full py-2.5 sm:py-3 px-3 sm:px-4 text-xs sm:text-sm font-medium border-2 rounded-lg transition-all duration-200 hover:shadow-md flex items-center justify-center space-x-2 touch-manipulation">
                        <span>✏️</span>
                        <span>Nhập cân nặng khác (từ 16kg trở lên)</span>
                    </button>

                    <!-- Custom weight input -->
                    <div x-show="itemOptions.selectedWeight === 'custom'"
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 transform scale-95"
                         x-transition:enter-end="opacity-100 transform scale-100"
                         class="mt-3">
                        <div class="flex items-center space-x-2">
                            <input type="number"
                                   x-model="itemOptions.customWeight"
                                   placeholder="VD: 16, 17, 18, 20..."
                                   min="16" max="30" step="0.1"
                                   :class="itemOptions.customWeight && itemOptions.customWeight < 16 ? 'border-red-500 focus:ring-red-300 focus:border-red-500' : 'border-gray-300 focus:ring-pink-300 focus:border-transparent'"
                                   class="flex-1 px-3 py-2.5 text-base border rounded-lg focus:ring-2">
                            <span class="text-sm text-gray-600 font-medium">kg</span>
                        </div>

                        <!-- Error message for weight < 16kg -->
                        <div x-show="itemOptions.customWeight && itemOptions.customWeight < 16"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 transform scale-95"
                             x-transition:enter-end="opacity-100 transform scale-100"
                             class="mt-2 p-2 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-red-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <p class="text-xs text-red-700 font-medium">
                                    Cân nặng phải từ 16kg trở lên, từ 3kg-15kg vui lòng chọn ở phía trên.
                                </p>
                            </div>
                        </div>

                        <!-- Success message for valid weight -->
                        <div x-show="itemOptions.customWeight && itemOptions.customWeight >= 16"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 transform scale-95"
                             x-transition:enter-end="opacity-100 transform scale-100"
                             class="mt-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <p class="text-xs text-green-700 font-medium">
                                    Cân nặng hợp lệ: <span x-text="itemOptions.customWeight"></span>kg
                                </p>
                            </div>
                        </div>

                        <!-- General help text -->
                        <p x-show="!itemOptions.customWeight || itemOptions.customWeight >= 16" class="text-xs text-gray-500 mt-2">💡 Chỉ nhập từ 16kg trở lên (3kg-15kg đã có preset)</p>
                    </div>

                    <!-- Pricing Info Message -->
                    <div x-show="(() => {
                        const weight = itemOptions.selectedWeight === 'custom' ? itemOptions.customWeight + 'kg' : itemOptions.selectedWeight;
                        const priceData = calculateDynamicPrice(currentItemForOptions, weight);
                        return priceData.hasSurcharge;
                    })()" class="bg-orange-50 border border-orange-200 rounded-lg p-3 mt-3">
                        <div class="flex items-start space-x-2">
                            <div class="text-orange-500 mt-0.5">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-xs font-medium text-orange-800">Thông tin giá</p>
                                <p class="text-xs text-orange-700" x-text="isAdultProduct(currentItemForOptions) ? 'Size tay từ 17cm trở lên sẽ +20k' : 'Cân nặng từ 16kg trở lên sẽ +20k do size lớn hơn'"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Baby Name Input - Only for Mix thẻ tên bé category -->
                <div x-show="currentItemForOptions && currentItemForOptions.category === 'mix_the_ten_be'"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 transform scale-95"
                     x-transition:enter-end="opacity-100 transform scale-100"
                     class="space-y-3 mb-4">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-4 shadow-sm">
                        <div class="flex items-start space-x-3">

                            <div class="flex-1">
                                <h4 class="text-sm font-bold text-gray-800 mb-2 flex items-center">
                                    <span class="mr-2">👶</span>
                                    Tên của bé
                                </h4>
                                <div class="space-y-2">
                                    <input type="text"
                                           x-model="itemOptions.babyName"
                                           placeholder="VD: Nhím - Nhím hoặc Nhím - Nhật Minh,..."
                                           class="w-full px-3 py-2.5 text-sm border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-300 focus:border-transparent bg-white/70 placeholder-gray-400">
                                    <div class="bg-white/70 rounded-lg p-2 border border-blue-100">
                                        <p class="text-xs text-gray-700 leading-relaxed">
                                            <span class="font-medium text-blue-600">Lưu ý:</span>
                                            Thẻ tên có thể khắc 2 mặt khác nhau. .
                                        </p>
                                        <p class="text-xs text-gray-600 mt-1">
                                            <span class="font-medium">Ví dụ:</span> "Mặt 1: Nhím, Mặt 2: Nhật Minh"
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upsell Section - Compact -->
                <div class="space-y-3 mb-4">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-2.5">
                        <div class="text-center mb-2">
                            <p class="text-xs font-semibold text-green-700">💥 CỰC SỐC! Ưu đãi mua kèm!</p>
                            <p class="text-xs text-gray-600 mt-0.5">Còn: <span x-text="countdownTimer.display" class="font-mono font-semibold text-green-700 bg-green-100 px-1 py-0.5 rounded text-xs"></span></p>
                        </div>
                        <div class="space-y-1.5">
                            <template x-for="addon in filteredAddonProducts" :key="addon.id">
                                <div @click="openAddonDetail(addon)" class="flex items-center space-x-2 p-2 bg-white rounded-md border border-green-100 cursor-pointer hover:bg-gray-50 transition-colors">
                                    <img :src="addon.image" class="w-8 h-8 rounded object-cover flex-shrink-0" loading="lazy">
                                    <div class="flex-grow min-w-0">
                                        <div class="flex items-center space-x-1">
                                            <p class="font-semibold text-gray-800 text-xs leading-tight truncate" x-text="addon.name"></p>
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-blue-600">
                                                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                                <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                            <p class="text-xs text-pink-600 font-bold" x-text="formatCurrency(addon.price)"></p>
                                            <template x-if="addon.original_price"><s class="text-xs text-gray-400" x-text="formatCurrency(addon.original_price)"></s></template>
                                        </div>
                                    </div>
                                    <div class="flex flex-col items-center space-y-1">
                                        <button @click.stop="isAddonInCartForDisplay(addon.id) ? removeFromCart(addon.id) : addAddonToCart(addon)" class="text-xs font-medium rounded-md transition-colors h-6 w-12 flex items-center justify-center" :class="isAddonInCartForDisplay(addon.id) ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-pink-600 text-white hover:bg-pink-700'">
                                            <span x-text="isAddonInCartForDisplay(addon.id) ? 'Xóa' : 'Thêm'"></span>
                                        </button>
                                        <template x-if="addon.id === 'addon_tui_dau_tam'"><p class="text-xs text-green-600 font-semibold" x-text="isFreeshippingFromDiscount() ? '-8K' : '+ Freeship'"></p></template>
                                        <template x-if="addon.id === 'addon_bo_dau_tam_7_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                        <template x-if="addon.id === 'addon_bo_dau_tam_9_canh'"><p class="text-xs text-green-600 font-semibold">+ Freeship</p></template>
                                        <template x-if="addon.id === 'addon_moc_chia_khoa'"><p class="text-xs text-green-600 font-semibold">-5K</p></template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Footer - Fixed Bottom -->
            <div class="flex-shrink-0 p-4 sm:p-6 bg-white rounded-b-2xl">
                <button @click="addItemWithOptions()"
                        :disabled="!itemOptions.selectedWeight || (itemOptions.selectedWeight === 'custom' && (!itemOptions.customWeight || itemOptions.customWeight < 16))"
                        :class="(!itemOptions.selectedWeight || (itemOptions.selectedWeight === 'custom' && (!itemOptions.customWeight || itemOptions.customWeight < 16))) ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-gradient-to-r from-pink-500 to-purple-500 text-white hover:from-pink-600 hover:to-purple-600 active:from-pink-600 active:to-purple-600'"
                        class="w-full py-2.5 sm:py-3 px-4 sm:px-6 font-bold text-xs sm:text-sm rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl active:scale-[0.98] sm:hover:scale-[1.02] flex items-center justify-center space-x-2 touch-manipulation">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17M17 13a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <span>Thêm vào giỏ hàng</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal - Tối ưu cho mẹ bỉm sữa -->
    <div x-show="isCheckoutModalOpen"
         @keydown.escape.window="console.log('🔍 ESC key pressed trên checkout modal'); closeCheckoutModal()"
         @click="console.log('🔍 Click trên checkout modal overlay')"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9550]">

        <div @click="console.log('🔍 Click trên checkout modal content')" class="bg-white rounded-2xl shadow-xl w-full max-w-sm sm:max-w-lg lg:max-w-2xl max-h-[85vh] sm:max-h-[90vh] flex flex-col my-4">

            <!-- Header - Compact -->
            <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-2 sm:p-4 rounded-t-2xl flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-1 sm:space-x-2">
                        <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-sm sm:text-base font-bold">Thông Tin Nhận Hàng</h2>
                        </div>
                    </div>
                    <button @click.stop="console.log('🔍 Nút X header checkout được click'); goBackToMiniCart()"
                            class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>



            <!-- Body - Scrollable content -->
            <div class="flex-1 overflow-y-auto modal-scroll">
                <div class="p-3 space-y-4">
                    <!-- Social Proof - Compact -->
                    <div class="mb-3">
                        <div class="bg-blue-50/50 rounded-md px-2 py-1 flex items-center space-x-1.5">
                            <div class="relative flex items-center justify-center w-3 h-3">
                                <!-- Ripple effects -->
                                <div class="absolute w-2.5 h-2.5 bg-blue-300 rounded-full live-ripple"></div>
                                <div class="absolute w-2.5 h-2.5 bg-blue-200 rounded-full live-ripple-delayed"></div>
                                <!-- Core dot -->
                                <div class="w-1.5 h-1.5 bg-blue-500 rounded-full live-dot relative z-10"></div>
                            </div>
                            <p class="text-xs text-blue-700 font-medium" x-text="socialProofViewers + ' người cũng đang nhập TT nhận hàng'"></p>
                        </div>
                    </div>

                    <!-- Thông tin cá nhân - Compact -->
                    <div class="space-y-3">
                        <h3 class="text-base font-semibold text-gray-800 mb-3 flex items-center">
                            <svg class="w-4 h-4 text-pink-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Thông tin người nhận
                        </h3>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span> Họ và tên
                                </label>
                                <input type="text" x-model="customer.name"
                                       placeholder="Nhập họ và tên"
                                       x-ref="firstInput"
                                       :class="formErrors.name ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                       class="w-full px-3 py-2 text-base rounded-lg transition-all border">
                                <div x-show="formErrors.name" x-text="formErrors.name" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                    <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span> Số điện thoại
                                </label>
                                <input type="tel" x-model="customer.phone"
                                       placeholder="0987 654 321"
                                       :class="formErrors.phone ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                       class="w-full px-3 py-2 text-base rounded-lg transition-all border">
                                <div x-show="formErrors.phone" x-text="formErrors.phone" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                    <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Địa chỉ giao hàng - Compact -->
                    <div class="space-y-3">
                        <h3 class="text-base font-semibold text-gray-800 mb-3 flex items-center">
                            <svg class="w-4 h-4 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Địa chỉ giao hàng
                        </h3>

                        <!-- Lưu ý địa chỉ hành chính -->
                        <div class="mb-3 p-2.5 bg-amber-50 border border-amber-200 rounded-lg">
                            <div class="flex items-start space-x-2">

                                <p class="text-xs text-amber-700 font-medium leading-relaxed">
                                    <strong class="underline">Lưu ý:</strong> Hiện tại các đơn vị vận chuyển chưa cập nhật địa chỉ hành chính mới nên vẫn sử dụng địa chỉ hành chính cũ.
                                </p>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <!-- Tỉnh/Thành phố -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span> Tỉnh/Thành phố
                                </label>
                                <select x-model="selectedProvince" @click.once="getAddressData()" @change="updateFullAddress()"
                                        :class="formErrors.province ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                        class="w-full px-3 py-2 text-base rounded-lg transition-all border">
                                    <option value="">Chọn tỉnh/thành phố</option>
                                    <template x-for="province in provinces" :key="province.Id">
                                        <option :value="province.Id" x-text="province.Name"></option>
                                    </template>
                                </select>
                                <div x-show="formErrors.province" x-text="formErrors.province" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                    <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>

                            <!-- Quận/Huyện và Phường/Xã trên cùng 1 hàng -->
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">
                                        <span class="text-red-500">*</span> Quận/Huyện
                                    </label>
                                    <select x-model="selectedDistrict" @change="updateFullAddress()"
                                            :disabled="!selectedProvince"
                                            :class="formErrors.district ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                            class="w-full px-3 py-2 text-base rounded-lg transition-all border disabled:bg-gray-100">
                                        <option value="">Chọn quận/huyện</option>
                                        <template x-for="district in districts" :key="district.Id">
                                            <option :value="district.Id" x-text="district.Name"></option>
                                        </template>
                                    </select>
                                    <div x-show="formErrors.district" x-text="formErrors.district" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                        <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">
                                        <span class="text-red-500">*</span> Phường/Xã
                                    </label>
                                    <select x-model="selectedWard" @change="updateFullAddress()"
                                            :disabled="!selectedDistrict"
                                            :class="formErrors.ward ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                            class="w-full px-3 py-2 text-base rounded-lg transition-all border disabled:bg-gray-100">
                                        <option value="">Chọn phường/xã</option>
                                        <template x-for="ward in wards" :key="ward.Id">
                                            <option :value="ward.Id" x-text="ward.Name"></option>
                                        </template>
                                    </select>
                                    <div x-show="formErrors.ward" x-text="formErrors.ward" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                        <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <!-- Địa chỉ cụ thể -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span> Địa chỉ cụ thể
                                </label>
                                <input type="text" x-model="streetAddress" @input="updateFullAddress()"
                                       placeholder="Số nhà, đường..."
                                       :class="formErrors.streetAddress ? 'border-red-500 focus:ring-red-500 focus:border-red-500' : 'border-gray-300 focus:ring-pink-500 focus:border-pink-500'"
                                       class="w-full px-3 py-2 text-base rounded-lg transition-all border">
                                <div x-show="formErrors.streetAddress" x-text="formErrors.streetAddress" class="text-red-500 text-xs mt-1 flex items-center error-message">
                                    <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>

                            <!-- Preview địa chỉ - Compact -->
                            <div x-show="customer.address" class="p-2 bg-green-50 border border-green-200 rounded-lg">
                                <p class="text-xs text-green-800">
                                    <strong>Giao đến:</strong> <span x-text="customer.address"></span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Ghi chú - Compact -->
                    <div class="space-y-3">
                        <h3 class="text-base font-semibold text-gray-800 mb-2 flex items-center">
                            <svg class="w-4 h-4 text-blue-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            Ghi chú (tùy chọn)
                        </h3>

                        <textarea x-model="customer.notes"
                                  placeholder="Ghi chú thời gian giao hàng..."
                                  rows="2"
                                  class="w-full px-3 py-2 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-all resize-none"></textarea>

                        <!-- Preset Note Buttons -->
                        <div class="mt-2">
                            <p class="text-xs text-gray-500 mb-2">💡 Gợi ý nhanh:</p>
                            <div class="flex flex-wrap gap-1.5">
                                <button @click="customer.notes = 'Giao giờ hành chính (8h-17h)'"
                                        class="preset-note-btn px-2 py-1 bg-blue-50 text-blue-700 border border-blue-200 rounded-md hover:bg-blue-100">
                                    🕘 Giờ hành chính
                                </button>
                                <button @click="customer.notes = 'Giao buổi chiều (14h-18h)'"
                                        class="preset-note-btn px-2 py-1 bg-orange-50 text-orange-700 border border-orange-200 rounded-md hover:bg-orange-100">
                                    🌅 Buổi chiều
                                </button>
                                <button @click="customer.notes = 'Gọi trước khi giao 15 phút'"
                                        class="preset-note-btn px-2 py-1 bg-green-50 text-green-700 border border-green-200 rounded-md hover:bg-green-100">
                                    📞 Gọi trước
                                </button>
                                <button @click="customer.notes = 'Giao tận tay, không gửi bảo vệ'"
                                        class="preset-note-btn px-2 py-1 bg-purple-50 text-purple-700 border border-purple-200 rounded-md hover:bg-purple-100">
                                    👤 Tận tay
                                </button>
                                <button @click="customer.notes = 'Để cửa nếu không có người'"
                                        class="preset-note-btn px-2 py-1 bg-gray-50 text-gray-700 border border-gray-200 rounded-md hover:bg-gray-100">
                                    🚪 Để cửa
                                </button>

                            </div>
                        </div>
                    </div>

                    <!-- Sản phẩm đã chọn - Compact -->
                    <div class="space-y-3">
                        <h3 class="text-base font-semibold text-gray-800 mb-2 flex items-center">
                            <svg class="w-4 h-4 text-purple-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            Sản phẩm (<span x-text="cart.length"></span>)
                        </h3>

                        <div class="space-y-2 max-h-32 overflow-y-auto modal-scroll bg-gray-50 rounded-lg p-3">
                            <template x-for="item in cart" :key="item.cartId">
                                <div class="flex items-center space-x-2 p-2 bg-white rounded">
                                    <img :src="item.image" :alt="item.name" class="w-8 h-8 object-cover rounded" loading="lazy">
                                    <div class="flex-1 min-w-0">
                                        <p class="text-xs font-medium text-gray-800 truncate" x-text="item.displayName || item.name"></p>
                                        <p class="text-xs text-gray-500" x-text="`SL: ${item.beadQuantity || item.quantity}`"></p>
                                        <!-- Hiển thị tên bé trong checkout -->
                                        <p x-show="item.babyName" class="text-xs text-pink-600 font-medium" x-text="`Khắc: ${item.babyName}`"></p>
                                    </div>
                                    <p class="text-xs font-bold text-pink-600" x-text="formatCurrency(item.price * (item.beadQuantity || item.quantity))"></p>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Phương thức thanh toán - Compact -->
                    <div class="space-y-3">
                        <h3 class="text-base font-semibold text-gray-800 mb-2 flex items-center">
                            <svg class="w-4 h-4 text-indigo-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                            </svg>
                            Thanh toán
                        </h3>

                        <div class="space-y-2">
                            <!-- COD Option - Compact Card -->
                            <div @click.stop="console.log('🔍 Click COD payment method'); console.log('🔍 Trước khi chọn COD - isMiniCartOpen:', isMiniCartOpen); paymentMethod = 'cod'"
                                 class="relative cursor-pointer group">
                                <div class="border-2 rounded-lg p-2.5 transition-all duration-300 transform"
                                     :class="paymentMethod === 'cod' ?
                                        'border-pink-500 bg-gradient-to-r from-pink-50 to-purple-50 shadow-md scale-[1.01]' :
                                        'border-gray-200 bg-white hover:border-pink-300 hover:shadow-sm'">

                                    <!-- Selection Indicator -->
                                    <div class="absolute top-1.5 right-1.5 w-4 h-4 rounded-full border-2 transition-all duration-300"
                                         :class="paymentMethod === 'cod' ? 'border-pink-500 bg-pink-500' : 'border-gray-300'">
                                        <div x-show="paymentMethod === 'cod'"
                                             class="w-1.5 h-1.5 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
                                             x-transition:enter="transition ease-out duration-200"
                                             x-transition:enter-start="opacity-0 scale-0"
                                             x-transition:enter-end="opacity-100 scale-100"></div>
                                    </div>

                                    <div class="flex items-center space-x-2.5">
                                        <div class="w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300"
                                             :class="paymentMethod === 'cod' ? 'bg-pink-100' : 'bg-gray-100 group-hover:bg-pink-50'">
                                            <span class="text-base">💰</span>
                                        </div>
                                        <div class="flex-1 pr-6">
                                            <h4 class="font-semibold text-sm transition-colors duration-300"
                                                :class="paymentMethod === 'cod' ? 'text-pink-700' : 'text-gray-800'">
                                                COD - Thanh toán khi nhận
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bank Transfer Option - Compact Card -->
                            <div @click.stop="console.log('🔍 Click Bank Transfer payment method'); console.log('🔍 Trước khi chọn Bank Transfer - isMiniCartOpen:', isMiniCartOpen); paymentMethod = 'bank_transfer'"
                                 class="relative cursor-pointer group">
                                <div class="border-2 rounded-lg p-2.5 transition-all duration-300 transform"
                                     :class="paymentMethod === 'bank_transfer' ?
                                        'border-green-500 bg-gradient-to-r from-green-50 to-emerald-50 shadow-md scale-[1.01]' :
                                        'border-gray-200 bg-white hover:border-green-300 hover:shadow-sm'">

                                    <!-- Selection Indicator -->
                                    <div class="absolute top-1.5 right-1.5 w-4 h-4 rounded-full border-2 transition-all duration-300"
                                         :class="paymentMethod === 'bank_transfer' ? 'border-green-500 bg-green-500' : 'border-gray-300'">
                                        <div x-show="paymentMethod === 'bank_transfer'"
                                             class="w-1.5 h-1.5 bg-white rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
                                             x-transition:enter="transition ease-out duration-200"
                                             x-transition:enter-start="opacity-0 scale-0"
                                             x-transition:enter-end="opacity-100 scale-100"></div>
                                    </div>

                                    <div class="flex items-center space-x-2.5">
                                        <div class="w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300"
                                             :class="paymentMethod === 'bank_transfer' ? 'bg-green-100' : 'bg-gray-100 group-hover:bg-green-50'">
                                            <span class="text-base">🏦</span>
                                        </div>
                                        <div class="flex-1 pr-6">
                                            <h4 class="font-semibold text-sm transition-colors duration-300"
                                                :class="paymentMethod === 'bank_transfer' ? 'text-green-700' : 'text-gray-800'">
                                                Chuyển khoản ngân hàng
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Thông tin chuyển khoản - Hiển thị khi chọn Bank Transfer -->
                        <div x-show="paymentMethod === 'bank_transfer'"
                             x-transition:enter="transition ease-out duration-300"
                             x-transition:enter-start="opacity-0 transform -translate-y-2"
                             x-transition:enter-end="opacity-100 transform translate-y-0"
                             x-transition:leave="transition ease-in duration-200"
                             x-transition:leave-start="opacity-100 transform translate-y-0"
                             x-transition:leave-end="opacity-0 transform -translate-y-2"
                             class="mt-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-3">

                            <!-- Header -->
                            <div class="flex items-center space-x-2 mb-2">
                                <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                    </svg>
                                </div>
                                <h5 class="font-semibold text-sm text-blue-800">Thông tin chuyển khoản</h5>
                            </div>

                            <!-- Total Amount - Prominent Display -->
                            <div class="bg-white border border-blue-200 rounded-md p-2 mb-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">Số tiền cần chuyển:</span>
                                    <span class="text-lg font-bold text-red-600" x-text="formatCurrency(cartTotal())"></span>
                                </div>
                            </div>

                            <!-- Bank Info - Single Column Layout -->
                            <div class="space-y-1.5 text-xs">
                                <div>
                                    <span class="text-gray-600">Người nhận:</span>
                                    <span class="font-semibold text-gray-800 ml-2">LE THI ANH</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Ngân hàng:</span>
                                    <span class="font-semibold text-blue-700 ml-2">Techcombank</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="text-gray-600">Số tài khoản:</span>
                                    <span class="font-mono font-semibold text-gray-800 ml-2">0968969012</span>
                                    <button @click="copyBankAccount()"
                                            class="group flex items-center justify-center w-5 h-5 rounded hover:bg-blue-100 transition-colors duration-200 ml-1"
                                            title="Sao chép số tài khoản">
                                        <svg class="w-3 h-3 text-gray-400 group-hover:text-blue-600 transition-colors duration-200"
                                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                        </svg>
                                    </button>
                                </div>
                                <div>
                                    <span class="text-gray-600">Nội dung CK:</span>
                                    <span class="font-mono font-semibold text-green-700 ml-2" x-text="customer.phone || 'Số điện thoại của bạn'"></span>
                                </div>
                            </div>

                            <!-- Copy Button -->
                            <div class="mt-2 pt-2 border-t border-blue-200">
                                <!-- Copy Success Message -->
                                <div x-show="checkoutCopySuccess"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 transform -translate-y-1"
                                     x-transition:enter-end="opacity-100 transform translate-y-0"
                                     x-transition:leave="transition ease-in duration-200"
                                     x-transition:leave-start="opacity-100 transform translate-y-0"
                                     x-transition:leave-end="opacity-0 transform -translate-y-1"
                                     class="mb-2 p-2 bg-green-50 border border-green-200 rounded-md">
                                    <div class="flex items-center space-x-1">
                                        <svg class="w-3 h-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <p class="text-xs text-green-700 font-medium">Đã sao chép số tài khoản!</p>
                                    </div>
                                </div>

                                <!-- Button Xác nhận chuyển khoản -->
                                <button @click.stop="console.log('🔍 Click Xác nhận chuyển khoản'); console.log('🔍 Trước khi xác nhận - isMiniCartOpen:', isMiniCartOpen); isCheckoutTransferConfirmed = true; console.log('🔍 Sau khi xác nhận - isMiniCartOpen:', isMiniCartOpen)"
                                        :class="isCheckoutTransferConfirmed ? 'bg-blue-600 hover:bg-blue-700' : 'bg-green-600 hover:bg-green-700'"
                                        class="w-full py-1.5 text-white text-xs font-medium rounded-md transition-colors duration-200 flex items-center justify-center space-x-1">
                                    <svg x-show="!isCheckoutTransferConfirmed" class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <svg x-show="isCheckoutTransferConfirmed" class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span x-text="isCheckoutTransferConfirmed ? 'Đã chuyển khoản' : 'Xác nhận chuyển khoản'"></span>
                                </button>
                            </div>

                            <!-- Important Note -->
                            <div class="mt-2">
                                <p class="text-xs text-gray-700">
                                    <strong>Lưu ý:</strong> Vui lòng chuyển đúng số tiền và nội dung
                                </p>
                            </div>
                        </div>

                        <!-- Payment method error -->
                        <div x-show="formErrors.paymentMethod" x-text="formErrors.paymentMethod" class="text-red-500 text-xs mt-2 flex items-center error-message">
                            <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                            </svg>
                        </div>

                        <!-- Thông báo kiểm tra hàng -->
                        <div class="mt-3 flex items-start space-x-2">
                            <svg class="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-xs text-gray-600 leading-relaxed">
                                Khi nhận hàng, bạn có thể kiểm tra hàng, hài lòng mới thanh toán
                            </p>
                        </div>
                    </div>

                    <!-- Tổng kết - Compact -->
                    <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg p-3 border border-pink-200">
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Tạm tính:</span>
                                <span class="font-medium" x-text="formatCurrency(cartSubtotal())"></span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Phí ship:</span>
                                <span class="font-medium" x-text="formatCurrency(shippingFee())"></span>
                            </div>

                            <template x-if="shippingDiscount > 0">
                                <div class="flex justify-between text-sm text-green-600 font-medium">
                                    <span>Miễn phí ship</span>
                                    <span x-text="'-' + formatCurrency(shippingDiscount)"></span>
                                </div>
                            </template>

                            <template x-if="discountAmount > 0">
                                <div class="flex justify-between text-sm text-green-600 font-medium">
                                    <span>Mã giảm giá</span>
                                    <span x-text="'-' + formatCurrency(discountAmount)"></span>
                                </div>
                            </template>

                            <template x-if="addonDiscount > 0">
                                <div class="flex justify-between text-sm text-green-600 font-medium">
                                    <span>Ưu đãi combo</span>
                                    <span x-text="'-' + formatCurrency(addonDiscount)"></span>
                                </div>
                            </template>

                            <template x-if="tuiDauTamBonusDiscount > 0">
                                <div class="flex justify-between text-sm text-green-600 font-medium">
                                    <span>Ưu đãi đặc biệt</span>
                                    <span x-text="'-' + formatCurrency(tuiDauTamBonusDiscount)"></span>
                                </div>
                            </template>

                            <div class="border-t border-pink-200 pt-2">
                                <div class="flex justify-between text-base font-bold">
                                    <span>Tổng cộng:</span>
                                    <span class="text-pink-600" x-text="formatCurrency(cartTotal())"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer - Mobile optimized -->
            <div class="flex-shrink-0 bg-white border-t border-gray-200 p-3 rounded-b-2xl">
                <div class="flex flex-row gap-2 sm:gap-3">
                    <button @click.stop="console.log('🔍 Nút Quay lại footer checkout được click'); goBackToMiniCart()"
                            class="flex-none w-20 sm:w-auto px-2 sm:px-4 py-2.5 sm:py-3 bg-gray-200 text-gray-700 font-medium rounded-lg text-xs sm:text-sm min-h-[40px] sm:min-h-[48px]">
                        Quay lại
                    </button>
                    <button @click="validateAndShowConfirmModal()"
                            :disabled="!canPlaceOrder"
                            :class="canPlaceOrder ?
                                'bg-gradient-to-r from-pink-500 to-purple-600 cursor-pointer' :
                                'bg-gray-400 cursor-not-allowed'"
                            class="flex-1 px-2 sm:px-4 py-2.5 sm:py-3 text-white font-bold rounded-lg text-xs sm:text-sm shadow-lg min-h-[40px] sm:min-h-[48px]">
                        <span x-show="canPlaceOrder">Đặt hàng - <span x-text="formatCurrency(cartTotal())"></span></span>
                        <span x-show="!canPlaceOrder">Xác nhận chuyển khoản</span>
                    </button>
                </div>
            </div>
        </div>


    </div>

    <!-- Bead Quantity Selection Modal - Chọn số lượng hạt dâu -->
    <div x-show="isBeadQuantityModalOpen" @keydown.escape.window="closeBeadQuantityModal()"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9400]">
        <div x-show="isBeadQuantityModalOpen" class="bg-white rounded-2xl shadow-2xl w-full max-w-sm sm:max-w-md lg:max-w-lg xl:max-w-xl mx-auto max-h-[85vh] sm:max-h-[90vh] flex flex-col transform my-4">

            <!-- Header - Compact -->
            <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-2 sm:p-4 rounded-t-2xl flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-1 sm:space-x-2">
                        <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-sm sm:text-base font-bold">Chọn số lượng hạt dâu</h3>
                        </div>
                    </div>
                    <button @click="closeBeadQuantityModal()" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="flex-1 overflow-y-auto p-4 space-y-6">
                <!-- Product Info -->
                <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl p-4 border border-pink-100">
                    <div class="flex items-center space-x-3">
                        <img :src="currentBeadProduct?.image" class="w-16 h-16 rounded-xl object-cover shadow-md" loading="lazy">
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800" x-text="currentBeadProduct?.name"></h4>
                            <p class="text-pink-600 font-bold text-lg" x-text="formatCurrency(currentBeadProduct?.price || 0)"></p>
                        </div>
                    </div>
                </div>

                <!-- Quantity Selector -->
                <div class="space-y-4">
                    <h4 class="font-bold text-gray-800 text-center">Số lượng hạt dâu</h4>

                    <!-- Custom Counter -->
                    <div class="flex items-center justify-center space-x-4">
                        <button @click="if (beadOptions.quantity > 1) beadOptions.quantity--"
                                :disabled="beadOptions.quantity <= 1"
                                class="w-12 h-12 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 disabled:hover:scale-100">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M20 12H4"/>
                            </svg>
                        </button>

                        <div class="bg-white border-2 border-pink-200 rounded-xl px-6 py-3 min-w-[100px] text-center">
                            <span class="text-2xl font-bold text-gray-800" x-text="beadOptions.quantity"></span>
                            <div class="text-xs text-gray-500 mt-1">hạt</div>
                        </div>

                        <button @click="if (beadOptions.quantity < 50) beadOptions.quantity++"
                                :disabled="beadOptions.quantity >= 50"
                                class="w-12 h-12 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 disabled:hover:scale-100">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Preset Buttons -->
                    <div class="space-y-3">
                        <h5 class="font-medium text-gray-700 text-center">Chọn nhanh số lượng phổ biến</h5>
                                                <div class="grid grid-cols-4 gap-2 text-xs sm:text-sm">
                            <button @click="beadOptions.quantity = 14" :class="beadOptions.quantity === 14 ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' : 'bg-gray-100 hover:bg-pink-50 text-gray-700'" class="py-2 sm:py-3 px-1 sm:px-2 rounded-lg font-medium transition-all transform hover:scale-105 border-2 border-transparent hover:border-pink-200">14 hạt</button>
                            <button @click="beadOptions.quantity = 18" :class="beadOptions.quantity === 18 ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' : 'bg-gray-100 hover:bg-pink-50 text-gray-700'" class="py-2 sm:py-3 px-1 sm:px-2 rounded-lg font-medium transition-all transform hover:scale-105 border-2 border-transparent hover:border-pink-200">18 hạt</button>
                            <button @click="beadOptions.quantity = 25" :class="beadOptions.quantity === 25 ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' : 'bg-gray-100 hover:bg-pink-50 text-gray-700'" class="py-2 sm:py-3 px-1 sm:px-2 rounded-lg font-medium transition-all transform hover:scale-105 border-2 border-transparent hover:border-pink-200">25 hạt</button>
                            <button @click="beadOptions.quantity = 30" :class="beadOptions.quantity === 30 ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' : 'bg-gray-100 hover:bg-pink-50 text-gray-700'" class="py-2 sm:py-3 px-1 sm:px-2 rounded-lg font-medium transition-all transform hover:scale-105 border-2 border-transparent hover:border-pink-200">30 hạt</button>
                            <button @click="beadOptions.quantity = 35" :class="beadOptions.quantity === 35 ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' : 'bg-gray-100 hover:bg-pink-50 text-gray-700'" class="py-2 sm:py-3 px-1 sm:px-2 rounded-lg font-medium transition-all transform hover:scale-105 border-2 border-transparent hover:border-pink-200">35 hạt</button>
                            <button @click="beadOptions.quantity = 40" :class="beadOptions.quantity === 40 ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' : 'bg-gray-100 hover:bg-pink-50 text-gray-700'" class="py-2 sm:py-3 px-1 sm:px-2 rounded-lg font-medium transition-all transform hover:scale-105 border-2 border-transparent hover:border-pink-200">40 hạt</button>
                            <button @click="beadOptions.quantity = 45" :class="beadOptions.quantity === 45 ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' : 'bg-gray-100 hover:bg-pink-50 text-gray-700'" class="py-2 sm:py-3 px-1 sm:px-2 rounded-lg font-medium transition-all transform hover:scale-105 border-2 border-transparent hover:border-pink-200">45 hạt</button>
                            <button @click="beadOptions.quantity = 50" :class="beadOptions.quantity === 50 ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' : 'bg-gray-100 hover:bg-pink-50 text-gray-700'" class="py-2 sm:py-3 px-1 sm:px-2 rounded-lg font-medium transition-all transform hover:scale-105 border-2 border-transparent hover:border-pink-200">50 hạt</button>
                        </div>
                    </div>

                    <!-- Note Section -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">Ghi chú thêm (tùy chọn)</label>
                        <textarea x-model="beadOptions.note"
                                  placeholder="Ví dụ: Làm cẩn thận, chọn hạt đẹp..."
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-all resize-none"
                                  rows="2"></textarea>
                    </div>

                    <!-- Recommendation -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <div class="flex items-start space-x-2">
                            <svg class="w-5 h-5 text-blue-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <div class="text-sm text-blue-700">
                                <p class="font-medium">💡 Lưu ý cho mẹ:</p>
                                <p>Nên chọn tối thiểu <strong>14 hạt dâu</strong> để đủ làm vòng cho bé yêu nhà mình nhé!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer - Compact -->
            <div class="flex-shrink-0 p-3 border-t bg-white rounded-b-2xl">
                <div class="flex gap-3">
                    <button @click="closeBeadQuantityModal()"
                            class="flex-1 py-2.5 sm:py-3 px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg text-xs sm:text-sm transition-colors">
                        Hủy
                    </button>
                    <button @click="addBeadProductToCart()"
                            :disabled="beadOptions.quantity < 1"
                            class="flex-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg text-xs sm:text-sm shadow-md">
                        <span class="flex items-center justify-center">
                            <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            Thêm vào giỏ hàng
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Combo Detail Modal - Redesigned for Mom-Friendly Experience -->
    <div x-show="isComboImageModalOpen" @keydown.escape.window="if (!isQuickBuyModalOpen) closeComboImageModal()"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-3 sm:p-4 pt-safe-top pb-safe-bottom z-[9000]">
        <div x-show="isComboImageModalOpen" class="combo-modal-content bg-white rounded-3xl sm:rounded-2xl shadow-2xl w-full max-w-sm sm:max-w-2xl max-h-[85vh] sm:max-h-[90vh] flex flex-col my-4">

                <div class="flex flex-col h-full max-h-[85vh] sm:max-h-[90vh]">
                    <!-- Header - Simple & Compact -->
                    <div class="flex-shrink-0 flex items-center justify-between px-4 py-2 border-b border-gray-100">
                        <div class="flex-1 min-w-0">
                            <h2 class="text-sm sm:text-base font-bold text-gray-800 truncate" x-text="currentComboTitle"></h2>
                        </div>
                        <button @click="closeComboImageModal()"
                                class="ml-3 w-7 h-7 text-gray-400 hover:text-gray-600 rounded-full flex items-center justify-center transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Content - Optimized for Mobile Viewing -->
                    <div class="flex-1 overflow-y-auto modal-scroll">
                        <!-- Hero Product Images - Large & Attractive -->
                        <div class="p-3 sm:p-4">
                            <!-- Main Product Showcase - Mobile: 1 column, Desktop: 2 columns -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                                <!-- Product 1 - Large Image -->
                                <div class="relative group">
                                    <div class="relative overflow-hidden rounded-xl bg-gradient-to-br from-rose-50 to-pink-50 border border-rose-100">
                                        <img :src="currentComboImages.product1.image"
                                             :alt="currentComboImages.product1.name"
                                             class="combo-product-image w-full aspect-square object-cover group-hover:scale-105 transition-transform duration-300" loading="lazy">
                                        <!-- Product Badge -->
                                        <div class="absolute top-2 left-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white px-2 py-1 rounded-full text-xs font-bold shadow-lg">
                                            #1
                                        </div>
                                        <!-- Price Tag -->
                                        <div class="absolute bottom-2 right-2 bg-white/90 backdrop-blur-sm text-pink-600 px-2 py-1 rounded-lg text-xs font-bold shadow-md">
                                            <span x-text="formatCurrency(currentComboImages.product1.price)"></span>
                                        </div>
                                    </div>
                                    <!-- Product Info -->
                                    <div class="mt-2">
                                        <h4 class="font-bold text-gray-800 text-sm leading-tight" x-text="currentComboImages.product1.name"></h4>
                                        <p class="text-xs text-gray-500 mt-1 line-clamp-2" x-text="currentComboImages.product1.description"></p>
                                    </div>
                                </div>

                                <!-- Product 2 - Large Image -->
                                <div class="relative group">
                                    <div class="relative overflow-hidden rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100">
                                        <img :src="currentComboImages.product2.image"
                                             :alt="currentComboImages.product2.name"
                                             class="combo-product-image w-full aspect-square object-cover group-hover:scale-105 transition-transform duration-300" loading="lazy">
                                        <!-- Product Badge -->
                                        <div class="absolute top-2 left-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-2 py-1 rounded-full text-xs font-bold shadow-lg">
                                            #2
                                        </div>
                                        <!-- Price Tag -->
                                        <div class="absolute bottom-2 right-2 bg-white/90 backdrop-blur-sm text-blue-600 px-2 py-1 rounded-lg text-xs font-bold shadow-md">
                                            <span x-text="formatCurrency(currentComboImages.product2.price)"></span>
                                        </div>
                                    </div>
                                    <!-- Product Info -->
                                    <div class="mt-2">
                                        <h4 class="font-bold text-gray-800 text-sm leading-tight" x-text="currentComboImages.product2.name"></h4>
                                        <p class="text-xs text-gray-500 mt-1 line-clamp-2" x-text="currentComboImages.product2.description"></p>
                                    </div>
                                </div>
                            </div>



                            <!-- Cách sử dụng - Professional Guide -->
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 mb-4 border border-blue-100">
                                <div class="flex items-center mb-3">

                                    <h3 class="text-sm font-bold text-blue-800">📋 Hướng dẫn sử dụng</h3>
                                </div>

                                <div class="space-y-3">
                                    <!-- Vòng dâu tằm -->
                                    <div class="bg-white/70 rounded-lg p-3 border border-blue-200">
                                        <div class="flex items-start space-x-3">
                                            <div class="w-10 h-10 bg-gradient-to-br from-pink-100 to-rose-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <span class="text-lg">💍</span>
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="text-sm font-semibold text-gray-800 mb-1">Vòng Dâu Tằm</h4>
                                                <p class="text-xs text-gray-600 leading-relaxed">
                                                    Đeo vào <span class="font-medium text-pink-600">tay hoặc chân bé</span> để hỗ trợ giấc ngủ ngon và an thần tự nhiên
                                                </p>
                                                <div class="flex items-center mt-2 text-xs text-blue-600">
                                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                                    </svg>
                                                    <span>An toàn cho trẻ em</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Túi dâu tằm -->
                                    <div class="bg-white/70 rounded-lg p-3 border border-blue-200">
                                        <div class="flex items-start space-x-3">
                                            <div class="w-10 h-10 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <span class="text-lg">👜</span>
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="text-sm font-semibold text-gray-800 mb-1">Túi Dâu Tằm</h4>
                                                <p class="text-xs text-gray-600 leading-relaxed">
                                                    Đặt ở <span class="font-medium text-purple-600">đầu giường hoặc trong phòng</span> để tạo không gian thư giãn, giúp cả gia đình ngủ ngon
                                                </p>
                                                <div class="flex items-center mt-2 text-xs text-blue-600">
                                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                                    </svg>
                                                    <span>Tiện lợi sinh hoạt</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Lưu ý quan trọng -->
                                <div class="mt-3 p-3 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border border-amber-200">
                                    <div class="flex items-start space-x-2">

                                        <div>
                                            <p class="text-xs font-medium text-amber-800 mb-1">💡 Lưu ý quan trọng</p>
                                            <p class="text-xs text-amber-700 leading-relaxed">
                                                Số hạt dâu em làm vòng được làm theo "Sinh Lão Bệnh Tử", số hạt em làm đều là số đẹp rơi vào chữ "Sinh" hoặc chữ "Lão" (lấy số hạt dâu chia cho 4, nếu dư 1 là "Sinh", nếu dư 2 là "Lão" ạ) nên các mẹ yên tâm đeo cho bé nha.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Price Summary - Clean & Attractive -->
                            <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl p-4 border border-gray-100 shadow-sm">
                                <!-- Price Comparison - Easy to Understand -->
                                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 mb-3 border border-blue-100">
                                    <!-- So sánh giá rõ ràng -->
                                    <div class="space-y-3">
                                        <!-- Mua lẻ -->
                                        <div class="flex items-center justify-between p-3 bg-white/70 rounded-lg border border-gray-200">
                                            <div class="text-left">
                                                <p class="text-xs text-gray-500 mb-1 flex items-center">
                                                    <svg class="w-4 h-4 mr-1.5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path>
                                                    </svg>
                                                    Nếu mua lẻ:
                                                </p>
                                                <div class="text-sm text-gray-700">
                                                    <span x-text="formatCurrency(currentComboImages.originalPrice)"></span>
                                                    <span class="text-gray-500"> + </span>
                                                    <span x-text="formatCurrency(currentComboImages.shippingFee)"></span>
                                                    <span class="text-gray-500 text-xs"> ship</span>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-lg font-bold text-gray-600 line-through" x-text="formatCurrency(currentComboImages.totalWithoutCombo)"></div>
                                            </div>
                                        </div>

                                        <!-- Mua combo -->
                                        <div class="flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-green-50 rounded-lg border-2 border-emerald-200">
                                            <div class="text-left">
                                                <p class="text-xs text-emerald-600 mb-1 font-semibold flex items-center">
                                                    <svg class="w-4 h-4 mr-1.5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                                                    </svg>
                                                    Mua combo:
                                                </p>
                                                <div class="text-sm text-emerald-700">
                                                    <span x-text="formatCurrency(currentComboImages.comboPrice)"></span>
                                                    <span class="text-emerald-500"> + </span>
                                                    <span class="text-emerald-500 font-bold">0đ</span>
                                                    <span class="text-emerald-500 text-xs"> ship</span>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-xl font-bold text-emerald-600" x-text="formatCurrency(currentComboImages.comboPrice)"></div>
                                            </div>
                                        </div>

                                        <!-- Tiết kiệm -->
                                        <div class="text-center py-2">
                                            <div class="inline-flex items-center space-x-2 bg-gradient-to-r from-red-500 to-pink-500 text-white px-4 py-2 rounded-full shadow-lg">
                                                <span class="text-sm font-bold">💰 Tiết kiệm:</span>
                                                <span class="text-lg font-black" x-text="formatCurrency(currentComboImages.savings)"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Benefits Summary -->
                                <div class="flex flex-wrap items-center justify-center gap-2 mb-3">
                                    <div class="inline-flex items-center space-x-1 bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-full text-xs font-medium shadow-sm">
                                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span>Miễn phí ship</span>
                                    </div>
                                    <div class="inline-flex items-center space-x-1 bg-orange-100 text-orange-700 px-3 py-1.5 rounded-full text-xs font-medium shadow-sm">
                                        <span>🎫</span>
                                        <span>+ Mã giảm giá</span>
                                    </div>
                                    <div class="inline-flex items-center space-x-1 bg-pink-100 text-pink-700 px-3 py-1.5 rounded-full text-xs font-medium shadow-sm">
                                        <span>🛡️</span>
                                        <span>An toàn tuyệt đối</span>
                                    </div>
                                </div>

                                <!-- Social Proof -->
                                <div class="text-center bg-gradient-to-r from-pink-50 to-rose-50 rounded-lg p-3 border border-pink-100">
                                    <p class="text-xs text-gray-600 flex items-center justify-center space-x-1 font-medium">
                                        <span>💕</span>
                                        <span x-text="`Đã có ${currentComboImages.customerCount}+ mẹ bỉm lựa chọn combo này`"></span>
                                        <span>💕</span>
                                    </p>
                                    <p class="text-xs text-pink-600 mt-1 font-semibold">⭐ Đánh giá 4.9/5 sao từ các mẹ</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer - Simple Action Buttons -->
                    <div class="flex-shrink-0 bg-white border-t border-gray-100 p-3 rounded-b-3xl sm:rounded-b-2xl">
                        <div class="flex gap-2">
                            <button @click="closeComboImageModal()"
                                    class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 font-medium rounded-lg text-sm transition-colors">
                                Đóng
                            </button>
                            <button @click="buyComboEnhanced(currentComboType, currentComboTitle, currentComboImages.comboPrice)"
                                    class="flex-1 px-4 py-2 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white font-bold rounded-lg text-sm shadow-lg transition-all combo-action-button">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                        <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19H16.16a1.75 1.75 0 0 0 1.743-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5ZM7.5 10a2.5 2.5 0 0 0 5 0V8.75a.75.75 0 0 1 1.5 0V10a4 4 0 0 1-8 0V8.75a.75.75 0 0 1 1.5 0V10Z" clip-rule="evenodd" />
                                    </svg>
                                    <span x-text="`Mua ngay - Tiết kiệm ${Math.round(currentComboImages.savings / 1000)}K`"></span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
        </div>
    </div>


    <!-- FAQ Modal -->
    <div x-show="isFaqModalOpen" @keydown.escape.window="closeFaqModal()" class="fixed inset-0 z-[9992] flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm p-4 pt-safe-top pb-safe-bottom" style="display: none;">
        <div x-show="isFaqModalOpen"
             @click.outside="closeFaqModal()"
             class="relative w-full max-w-2xl bg-white rounded-3xl shadow-2xl overflow-hidden max-h-[85vh] sm:max-h-[90vh] flex flex-col my-4">

            <!-- Header - Compact -->
            <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white p-2 sm:p-4 rounded-t-2xl flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-1 sm:space-x-2">
                        <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-sm sm:text-base font-bold">Câu hỏi thường gặp</h3>
                        </div>
                    </div>
                    <button @click="closeFaqModal()" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto modal-scroll p-6 space-y-4">
                <!-- FAQ Item 1 -->
                <div class="bg-gradient-to-r from-pink-50 to-rose-50 rounded-2xl border border-pink-100 overflow-hidden">
                    <button @click="toggleFaqItem(1)" class="w-full text-left px-5 py-4 flex items-center justify-between hover:bg-pink-50 transition-colors">
                        <h4 class="font-semibold text-gray-800 pr-4">Vòng có phải làm từ cây dâu tằm thật hay không?</h4>
                        <svg class="w-5 h-5 text-pink-600 transform transition-transform duration-200" :class="{ 'rotate-180': faqOpenItems.includes(1) }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div x-show="faqOpenItems.includes(1)" class="overflow-hidden">
                        <div class="px-5 pb-4 text-gray-700 leading-relaxed border-t border-pink-100 pt-3 bg-white">
                            Em cam kết 100% vòng dâu tằm em làm đều làm thủ công từ cây dâu tằm thật, mà còn là cây dâu tằm đực, dương khi mạnh do chính nhà em trồng. Giống dâu tằm ta Việt Nam từ xưa mà các cụ hay dùng để làm vòng cho bé.
                        </div>
                    </div>
                </div>

                <!-- FAQ Item 2 -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100 overflow-hidden">
                    <button @click="toggleFaqItem(2)" class="w-full text-left px-5 py-4 flex items-center justify-between hover:bg-blue-50 transition-colors">
                        <h4 class="font-semibold text-gray-800 pr-4">Bạc mix vòng có phải bạc thật hay không?</h4>
                        <svg class="w-5 h-5 text-blue-600 transform transition-transform duration-200" :class="{ 'rotate-180': faqOpenItems.includes(2) }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div x-show="faqOpenItems.includes(2)" class="overflow-hidden">
                        <div class="px-5 pb-4 text-gray-700 leading-relaxed border-t border-blue-100 pt-3 bg-white">
                            Em cũng cam kết 100% là bạc thật, tất cả đều là bạc ta S999 (chỉ có charm hoa sen và charm chuông là bạc S925). Các mẹ có thể mang ra tiệm bạc để kiểm tra thoải mái ạ.
                        </div>
                    </div>
                </div>

                <!-- FAQ Item 3 -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl border border-green-100 overflow-hidden">
                    <button @click="toggleFaqItem(3)" class="w-full text-left px-5 py-4 flex items-center justify-between hover:bg-green-50 transition-colors">
                        <h4 class="font-semibold text-gray-800 pr-4">Vòng dính nước có làm sao không?</h4>
                        <svg class="w-5 h-5 text-green-600 transform transition-transform duration-200" :class="{ 'rotate-180': faqOpenItems.includes(3) }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div x-show="faqOpenItems.includes(3)" class="overflow-hidden">
                        <div class="px-5 pb-4 text-gray-700 leading-relaxed border-t border-green-100 pt-3 bg-white">
                            Vòng dâu em làm đều lấy từ phần gốc của cây dâu tằm, nên rất già chắc và đặc lõi, nên ngấm nước thoải mái không bị làm sao. Nhưng ngâm nước lâu và nhiều thì hạt dâu tằm sẽ đậm hơn vì không dùng hóa chất bảo quản gì cả.
                        </div>
                    </div>
                </div>

                <!-- FAQ Item 4 -->
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl border border-amber-100 overflow-hidden">
                    <button @click="toggleFaqItem(4)" class="w-full text-left px-5 py-4 flex items-center justify-between hover:bg-amber-50 transition-colors">
                        <h4 class="font-semibold text-gray-800 pr-4">Vòng mua cho bé sơ sinh thì bé lớn có đeo được tiếp không?</h4>
                        <svg class="w-5 h-5 text-amber-600 transform transition-transform duration-200" :class="{ 'rotate-180': faqOpenItems.includes(4) }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div x-show="faqOpenItems.includes(4)" class="overflow-hidden">
                        <div class="px-5 pb-4 text-gray-700 leading-relaxed border-t border-amber-100 pt-3 bg-white">
                            Các mẫu vòng dâu rút đỏ thì đều có thể nới rộng ra khi bé lớn, nên không sợ bị trật. Còn các mẫu vòng co giãn thì sẽ không nới rộng được, nên khi bé lớn tay to hơn hẳn lúc đầu thì có thể sẽ bị chật ạ.
                        </div>
                    </div>
                </div>

                <!-- FAQ Item 5 -->
                <div class="bg-gradient-to-r from-purple-50 to-violet-50 rounded-2xl border border-purple-100 overflow-hidden">
                    <button @click="toggleFaqItem(5)" class="w-full text-left px-5 py-4 flex items-center justify-between hover:bg-purple-50 transition-colors">
                        <h4 class="font-semibold text-gray-800 pr-4">Vòng không sử dụng để lâu ngày có mốc không?</h4>
                        <svg class="w-5 h-5 text-purple-600 transform transition-transform duration-200" :class="{ 'rotate-180': faqOpenItems.includes(5) }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div x-show="faqOpenItems.includes(5)" class="overflow-hidden">
                        <div class="px-5 pb-4 text-gray-700 leading-relaxed border-t border-purple-100 pt-3 bg-white">
                            Dạ, có thể ạ. Vì vòng em làm không dùng hóa chất chống mốc để an toàn cho bé. Nên nếu không sử dụng để ngoài không khí nồm ẩm có thể bị mốc. Còn nếu đeo trên bé hằng ngày, có hơi người thì vòng không bao giờ mốc được ạ.
                        </div>
                    </div>
                </div>

                <!-- Contact Section -->
                <div class="mt-8 bg-gradient-to-r from-pink-50 via-purple-50 to-indigo-50 rounded-2xl p-5 border border-pink-100">
                    <div class="text-center">
                        <h4 class="font-semibold text-gray-800 mb-2">Còn thắc mắc gì khác?</h4>
                        <p class="text-sm text-gray-600">Liên hệ trực tiếp với shop để được tư vấn chi tiết nhất</p>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="bg-white p-3 border-t border-gray-100 rounded-b-2xl flex-shrink-0">
                <div class="flex flex-row gap-2 sm:gap-3">
                    <a href="https://zalo.me/0972483892" target="_blank" rel="noopener noreferrer" class="flex-1 px-2 sm:px-4 py-2.5 sm:py-3 bg-blue-500 text-white text-xs sm:text-sm font-bold rounded-lg hover:bg-blue-600 transition-all flex items-center justify-center space-x-2 min-h-[40px] sm:min-h-[48px]">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4 sm:h-5 sm:w-5">
                            <path d="M3.505 2.365A41.369 41.369 0 0 1 9 2c1.863 0 3.697.124 5.495.365 1.247.167 2.18 1.108 2.435 2.268a4.45 4.45 0 0 0-.577-.069 43.141 43.141 0 0 0-4.706 0C9.229 4.696 7.5 6.727 7.5 8.998v2.24c0 1.413.67 2.735 1.76 3.562l-2.98 2.98A.75.75 0 0 1 5 17.25v-3.443c-.501-.048-1-.106-1.495-.172C2.033 13.438 1 12.162 1 10.72V5.28c0-1.441 1.033-2.717 2.505-2.914Z" />
                            <path d="M14 6c-.762 0-1.52.02-2.271.062C10.157 6.148 9 7.472 9 8.998v2.24c0 1.519 1.147 2.839 2.71 2.935.214.013.428.024.642.034.2.009.385.09.518.224l2.35 2.35a.75.75 0 0 0 1.28-.531v-2.07c1.453-.195 2.5-1.463 2.5-2.915V8.998c0-1.526-1.157-2.85-2.729-2.936A41.645 41.645 0 0 0 14 6Z" />
                        </svg>
                        <span>Chat Zalo ngay</span>
                    </a>
                    <button @click="closeFaqModal()" class="flex-1 px-2 sm:px-4 py-2.5 sm:py-3 bg-gray-100 text-gray-700 text-xs sm:text-sm font-bold rounded-lg hover:bg-gray-200 transition-all min-h-[40px] sm:min-h-[48px]">
                        Đóng
                    </button>
                </div>
            </div>
        </div>
    </div>



</body>
</html>

    <!-- Process Showcase Modal -->
    <div x-show="isProcessModalOpen" @keydown.escape.window="closeProcessModal()" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[10000]" x-cloak>
        <div class="bg-white w-full max-w-sm sm:max-w-lg lg:max-w-4xl rounded-2xl shadow-2xl overflow-hidden flex flex-col transform transition-all my-4 max-h-[85vh] sm:max-h-[90vh]" @click.away="closeProcessModal()">
            <!-- Header - Synced with Mini Cart -->
            <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-2 sm:p-4 rounded-t-2xl flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-1 sm:space-x-2">
                        <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-sm sm:text-base font-bold">Quy Trình Thủ Công</h3>
                        </div>
                    </div>
                    <button @click="closeProcessModal()" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-6 space-y-6">
                <!-- Step 1 -->
                <div class="flex items-start space-x-4">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-800 mb-1">Chọn Lọc Cành Dâu Tằm Gốc</h4>
                        <p class="text-sm text-gray-600">Chỉ những cành dâu tằm đực, đủ tuổi, được trồng tự nhiên tại Việt Nam mới được chọn để đảm bảo chất lượng và năng lượng tốt nhất.</p>
                        <img src="./assets/images/product_img/bo-dau-tam-de-phong.webp" alt="Chọn cành dâu" class="mt-2 rounded-lg shadow-md w-full h-auto object-cover" loading="lazy">
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="flex items-start space-x-4">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-800 mb-1">Chế Tác Thủ Công & Mài Mịn</h4>
                        <p class="text-sm text-gray-600">Từng hạt vòng được cắt, khoan lỗ và mài mịn hoàn toàn bằng tay bởi các nghệ nhân lành nghề, đảm bảo mỗi hạt đều tròn đẹp và an toàn cho da bé.</p>
                        <img src="./assets/images/product_img/hat_dau_tam.webp" alt="Chế tác thủ công" class="mt-2 rounded-lg shadow-md w-full h-auto object-cover" loading="lazy">
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="flex items-start space-x-4">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-800 mb-1">Xâu Vòng & Kết Hợp Bạc/Đá</h4>
                        <p class="text-sm text-gray-600">Vòng được xâu cẩn thận theo số hạt "Sinh - Lão", kết hợp với bạc ta 925 hoặc đá tự nhiên để tăng thêm tính thẩm mỹ và công dụng bảo vệ cho bé.</p>
                        <img src="./assets/images/product_img/vong_tron_co_dien_day_do.webp" alt="Xâu vòng" class="mt-2 rounded-lg shadow-md w-full h-auto object-cover" loading="lazy">
                    </div>
                </div>
            </div>

            <!-- Footer - Synced with Mini Cart -->
            <div class="flex-shrink-0 bg-gray-50 p-3 border-t border-gray-200 rounded-b-2xl">
                <button @click="closeProcessModal()" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center space-x-2 text-sm">
                    <span>Xem Danh Sách Sản Phẩm</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>
    </div>


    <!-- Modal Hướng dẫn đo size (New, Simplified Design) -->
    <div x-show="isSizingGuideModalOpen"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 pt-safe-top pb-safe-bottom z-[9950]"
         @click.self="closeSizingGuideModal()"
         @keydown.escape.window="closeSizingGuideModal()">

        <div x-show="isSizingGuideModalOpen"
             class="bg-white rounded-2xl shadow-xl w-full max-w-sm sm:max-w-md flex flex-col transform my-4 max-h-[85vh] sm:max-h-[90vh]">

            <!-- Header (Synced with Mini Cart) -->
            <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-3 sm:p-4 rounded-t-2xl flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-sm sm:text-base font-bold">Hướng dẫn đo size</h3>
                        </div>
                    </div>
                    <button @click="closeSizingGuideModal()" class="w-6 h-6 sm:w-8 sm:h-8 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition-all">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto modal-scroll p-4 sm:p-6 space-y-4">
                <!-- Cách đo -->
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <h4 class="font-semibold text-gray-800 mb-2">Cách đo:</h4>
                    <p class="text-sm text-gray-600">Cuốn thước dây sát cổ tay hoặc dùng sợi chỉ quấn sát cổ tay, sau đó đo độ dài sợi dây bằng thước kẻ.</p>
                </div>

                <!-- Mẹo -->
                <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                    <h4 class="font-semibold text-blue-800 mb-2">💡 Mẹo:</h4>
                    <p class="text-sm text-gray-600">Nếu không có thước, lấy tờ tiền 500k quấn sát cổ tay (tờ 500k dài 15cm), xem thừa thiếu bao nhiêu là ra size tay.</p>
                </div>

                <!-- Lưu ý -->
                <div class="bg-red-50 rounded-lg p-4 border border-red-200">
                    <h4 class="font-semibold text-red-800 mb-2">⚠️ Lưu ý:</h4>
                    <p class="text-sm text-gray-600">Quấn sát cổ tay không trừ hao, nếu không vòng sẽ bị rộng.</p>
                </div>
            </div>

            <!-- Footer (Synced with Mini Cart) -->
            <div class="flex-shrink-0 bg-gray-50 p-3 sm:p-4 border-t border-gray-200 rounded-b-2xl">
                <button @click="closeSizingGuideModal()"
                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold py-2.5 sm:py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center space-x-2 text-sm">
                    <span>Đã hiểu</span>
                </button>
            </div>
        </div>
    </div>


    <!-- Quick View Modal -->
    <div x-show="isQuickViewOpen"
         @keydown.escape.window="closeQuickView()"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 z-[9800]">

        <div @click.away="closeQuickView()"
             class="bg-white rounded-2xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col sm:flex-row transform"
             x-show="isQuickViewOpen">

            <!-- Image Section -->
            <div class="w-full sm:w-1/2 h-64 sm:h-auto relative bg-gray-100">
                <img :src="quickViewProduct?.image" :alt="quickViewProduct?.name"
                     @load="$el.classList.remove('opacity-0')"
                     class="w-full h-full object-cover rounded-t-2xl sm:rounded-l-2xl sm:rounded-tr-none opacity-0 transition-opacity duration-300" loading="lazy">
                <button @click="closeQuickView()" class="absolute top-3 right-3 bg-gray-800 bg-opacity-50 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-opacity-75 transition-all">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- Details Section -->
            <div class="w-full sm:w-1/2 p-6 flex flex-col justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900" x-text="quickViewProduct?.name"></h2>
                    <div class="flex items-baseline my-4">
                        <span class="text-3xl font-bold text-pink-600" x-text="formatCurrency(quickViewProduct?.price)"></span>
                        <span x-show="quickViewProduct?.original_price" class="ml-3 text-lg text-gray-400 line-through" x-text="formatCurrency(quickViewProduct?.original_price)"></span>
                    </div>
                    <p class="text-gray-600 text-sm" x-text="quickViewProduct?.description"></p>
                </div>

                <div class="mt-6 space-y-3">
                    <button @click="addToCart(quickViewProduct); closeQuickView();" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        <span>Thêm vào giỏ</span>
                    </button>
                    <button @click="openProductDetail(quickViewProduct); closeQuickView();" class="w-full bg-gray-100 text-gray-800 font-bold py-3 px-4 rounded-lg hover:bg-gray-200 transition-all">
                        Xem chi tiết sản phẩm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript đã được load tự động ở trên dựa trên môi trường -->
</body>
</html>