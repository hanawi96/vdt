<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vòng Dâu Tằm An Nhiên</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .view-hidden { display: none !important; }
    </style>
    <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body class="bg-gray-50 font-sans" x-data="shop" x-cloak>

    <div class="container mx-auto p-4">

        <!-- Modal Thông Báo - Thiết kế mới -->
        <div
            x-show="isAlertModalOpen"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform translate-y-[-20px] scale-95"
            x-transition:enter-end="opacity-100 transform translate-y-0 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 transform translate-y-0 scale-100"
            x-transition:leave-end="opacity-0 transform translate-y-[-20px] scale-95"
            class="fixed top-6 left-1/2 -translate-x-1/2 sm:left-auto sm:translate-x-0 sm:right-6 z-[9999] w-11/12 max-w-md sm:w-auto min-w-[320px]"
            style="display: none;"
        >
            <div class="bg-white rounded-xl shadow-2xl border-0 overflow-hidden backdrop-blur-sm"
                 :class="{
                   'bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-l-green-500': alertModalType === 'success',
                   'bg-gradient-to-r from-red-50 to-rose-50 border-l-4 border-l-red-500': alertModalType === 'error',
                   'bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-l-blue-500': alertModalType === 'info'
                 }">
                <div class="p-3 flex items-center space-x-3">
                    <!-- Icon Container -->
                    <div class="flex-shrink-0">
                        <!-- Success Icon -->
                        <div x-show="alertModalType === 'success'" class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                            <svg class="h-4 w-4 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                        <!-- Error Icon -->
                        <div x-show="alertModalType === 'error'" style="display: none;" class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                            <svg class="h-4 w-4 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </div>
                        <!-- Info Icon -->
                        <div x-show="alertModalType === 'info'" style="display: none;" class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <svg class="h-4 w-4 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                    <!-- Message -->
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium"
                           :class="{
                             'text-green-800': alertModalType === 'success',
                             'text-red-800': alertModalType === 'error',
                             'text-blue-800': alertModalType === 'info'
                           }"
                           x-text="alertModalMessage"></p>
                    </div>
                    <!-- Close Button -->
                    <button @click="isAlertModalOpen = false" class="flex-shrink-0 -mr-1 p-1 rounded-full hover:bg-gray-200/50 transition-colors duration-200">
                        <svg class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Shop Profile Section - WOW Design -->
        <div x-show="!loading && !error && view === 'products'" class="mb-8">
            <div class="bg-gradient-to-br from-pink-50 via-white to-purple-50 rounded-2xl shadow-sm border border-gray-100 p-6 md:p-8 relative overflow-hidden">
                <!-- Decorative elements -->
                <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-pink-100 rounded-full opacity-50"></div>
                <div class="absolute bottom-0 left-0 -mb-12 -ml-12 w-32 h-32 bg-purple-100 rounded-full opacity-50"></div>

                <div class="relative z-10 flex flex-col items-center text-center">
                    <!-- Avatar -->
                    <div class="relative mb-4">
                        <img :src="shopInfo.avatar_image" :alt="shopInfo.shop_name"
                             class="w-28 h-28 rounded-full border-4 border-white shadow-lg object-cover transform hover:scale-105 transition-transform duration-300">
                        <div class="absolute -bottom-2 -right-2 bg-gradient-to-tr from-pink-500 to-purple-500 text-white rounded-full w-10 h-10 flex items-center justify-center text-sm font-bold shadow-md border-2 border-white">
                            ✓
                        </div>
                    </div>

                    <!-- Brand Name & Slogan -->
                    <h1 class="text-3xl font-bold text-gray-800" x-text="shopInfo.shop_name"></h1>
                    <p class="text-gray-600 mt-1 mb-6" x-text="shopInfo.description"></p>

                    <!-- The 'Trust Bar' -->
                    <div class="w-full max-w-lg bg-white/60 backdrop-blur-sm rounded-xl shadow-sm border border-gray-200/80 p-4 grid grid-cols-3 gap-2 divide-x divide-gray-200/80 mb-6">
                        <div class="flex flex-col items-center justify-center px-2">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-pink-500 mr-1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                                </svg>
                                <span class="text-xl font-bold text-gray-800" x-text="shopInfo.stats.products || 0"></span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">Sản phẩm</div>
                        </div>
                        <div class="flex flex-col items-center justify-center px-2">
                            <div class="flex items-center">
                                 <svg class="w-5 h-5 text-red-500 mr-1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.934l.643 2.113a1 1 0 01-.814 1.259l-2.113-.643a1 1 0 00-.934.822c-.276.587-.558.915-.934 1.45a1 1 0 00.386 1.45l2.113.643a1 1 0 01-.643 2.113l-1.259-.814a1 1 0 00-1.259.814l-.643 2.113a1 1 0 00.822.934c.587.276.915.558 1.45.934a1 1 0 001.45-.385c.345-.23.614-.558.822-.934l-.643-2.113a1 1 0 01.814-1.259l2.113.643a1 1 0 00.934-.822c.276-.587.558-.915.934-1.45a1 1 0 00-.386-1.45l-2.113-.643a1 1 0 01.643-2.113l1.259.814a1 1 0 001.259-.814l.643-2.113a1 1 0 00-.822-.934c-.587-.276-.915-.558-1.45-.934zM7 12a1 1 0 11-2 0 1 1 0 012 0zm3 3a1 1 0 11-2 0 1 1 0 012 0zm2-5a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                </svg>
                                <span class="text-xl font-bold text-gray-800" x-text="shopInfo.stats.totalSales || 0"></span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">Lượt bán</div>
                        </div>
                        <div class="flex flex-col items-center justify-center px-2">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                                <span class="text-xl font-bold text-gray-800" x-text="shopInfo.stats.averageRating || 0"></span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">Đánh giá</div>
                        </div>
                    </div>

                    <!-- Search Bar -->
                    <div class="w-full max-w-lg">
                        <div class="relative flex items-center">
                            <input type="text" x-model="searchQuery" @keydown.enter="performSearch()" placeholder="Tìm vòng cho bé, vòng mix bạc..."
                                   class="w-full h-12 pl-4 pr-16 rounded-full border-2 border-white/80 bg-white/50 focus:border-pink-400 focus:ring-pink-400 transition-colors duration-300 shadow-sm">
                            <button @click="performSearch()" class="absolute right-2 h-9 w-9 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-colors shadow-md flex items-center justify-center">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div x-show="loading" class="text-center py-12">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"></div>
            <p class="text-gray-600">Đang tải dữ liệu...</p>
        </div>

        <!-- Error State -->
        <div x-show="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
            <p x-text="error"></p>
        </div>

        <!-- Floating Action Buttons -->
        <div class="fixed right-4 sm:right-5 z-40 flex flex-col items-center space-y-3 transition-all duration-300" :class="cart.length > 0 ? 'bottom-24 sm:bottom-20' : 'bottom-4 sm:bottom-5'">
            <!-- FAQ Icon -->
            <div @click="openFaqModal()" class="bg-white text-gray-700 w-12 h-12 sm:w-14 sm:h-14 rounded-full flex items-center justify-center shadow-lg cursor-pointer transform hover:scale-110 transition-transform border">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-7 sm:h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>

            <!-- Zalo Icon -->
            <a href="https://zalo.me/0972483892" target="_blank" rel="noopener noreferrer" class="block transform hover:scale-110 transition-transform">
                <div class="bg-blue-500 text-white w-12 h-12 sm:w-14 sm:h-14 rounded-full flex items-center justify-center shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-7 sm:h-7" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16.25,10.25H14.38V8.38a.5.5,0,0,0-.5-.5H12.38a.5.5,0,0,0-.5.5v1.87H10.38a.5.5,0,0,0-.5.5v1.5a.5.5,0,0,0,.5.5h1.5v3.25a.5.5,0,0,0,.5.5h1.5a.5.5,0,0,0,.5-.5V12.75h1.87a.5.5,0,0,0,.5-.5v-1.5A.5.5,0,0,0,16.25,10.25ZM12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z"/>
                    </svg>
                </div>
            </a>

            <!-- Cart Icon -->
            <div @click="toggleMiniCart()"
     :class="{ 'cart-bounce': isCartAnimating }"
     class="relative bg-pink-600 text-white w-14 h-14 sm:w-16 sm:h-16 rounded-full items-center justify-center shadow-lg cursor-pointer transform hover:scale-110 transition-transform hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 sm:h-8 sm:w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <span x-show="cart.length > 0" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-6 h-6 rounded-full flex items-center justify-center" x-text="cart.length"></span>
            </div>
        </div>

        <!-- Mobile Product View Bar -->
        <div x-show="view === 'products'"
             class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] p-2 z-40"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-full"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform translate-y-0"
             x-transition:leave-end="opacity-0 transform translate-y-full">
            <div class="container mx-auto">
                <div class="flex items-center justify-between flex-wrap">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-pink-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                        </div>
                        <div>
                            <p class="font-bold text-base text-pink-600" x-text="formatCurrency(cartTotal())"></p>
                        </div>
                    </div>
                    <button @click="toggleMiniCart()" class="bg-pink-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-pink-700 transition-colors shadow-md text-sm">
                        <span x-text="`Xem giỏ hàng (${trueTotalCartQuantity})`"></span>
                    </button>
                </div>
            </div>
        </div>



        <main>
            <!-- Products View -->
            <div x-show="!loading && !error && view === 'products'" :class="{'view-hidden': view !== 'products'}">



                <!-- Section Title: Categories -->
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800">Khu Vườn Sản Phẩm</h2>
                    <p class="text-gray-500 mt-2">Khám phá thế giới vòng dâu cho bé yêu của mẹ</p>
                </div>

                <!-- Category Filters -->
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8">
                    <template x-for="category in categories" :key="category.id">
                        <div @click="selectCategory(category)"
                             class="flex items-center bg-white rounded-lg shadow-sm overflow-hidden cursor-pointer border transition-all duration-200"
                             :class="{ 'border-pink-500 shadow-md': currentCategory.id === category.id, 'border-gray-200 hover:border-pink-300 hover:shadow-md': currentCategory.id !== category.id }">
                            <img :src="category.image || './assets/images/demo.jpg'" :alt="category.name" class="w-16 h-16 object-cover flex-shrink-0">
                            <div class="p-3 flex-grow">
                                <h4 class="font-semibold text-sm text-gray-800 leading-tight" x-text="category.name"></h4>
                                <div class="flex items-center space-x-2 text-xs text-gray-500 mt-1">
                                    <span>
                                        <span x-text="category.id === 'all' ? products.length : getProductCount(category.id)"></span> SP
                                    </span>
                                    <span class="text-gray-300">|</span>
                                    <span class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-0.5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.934l.643 2.113a1 1 0 01-.814 1.259l-2.113-.643a1 1 0 00-.934.822c-.276.587-.558.915-.934 1.45a1 1 0 00.386 1.45l2.113.643a1 1 0 01-.643 2.113l-1.259-.814a1 1 0 00-1.259.814l-.643 2.113a1 1 0 00.822.934c.587.276.915.558 1.45.934a1 1 0 001.45-.385c.345-.23.614-.558.822-.934l-.643-2.113a1 1 0 01.814-1.259l2.113.643a1 1 0 00.934-.822c.276-.587.558-.915.934-1.45a1 1 0 00-.386-1.45l-2.113-.643a1 1 0 01.643-2.113l1.259.814a1 1 0 001.259-.814l.643-2.113a1 1 0 00-.822-.934c-.587-.276-.915-.558-1.45-.934zM7 12a1 1 0 11-2 0 1 1 0 012 0zm3 3a1 1 0 11-2 0 1 1 0 012 0zm2-5a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                        </svg>
                                        <span x-text="getCategoryPurchases(category.id)"></span>+
                                    </span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>




                <h2 id="product-list-anchor" class="text-3xl font-bold text-center text-gray-800 mb-2" x-text="activeSearchQuery ? `Kết quả cho '${activeSearchQuery}'` : currentCategory?.name"></h2>
                <p class="text-center text-gray-500 mb-8" x-text="currentCategory?.description"></p>

                <!-- Sorting Filters -->
                <div class="flex items-center justify-center flex-wrap gap-2 mb-8 border-b pb-8">
                     <button @click="activeFilter = 'best_selling'"
                            :class="{ 'bg-pink-200 text-pink-800': activeFilter === 'best_selling', 'bg-white text-gray-600': activeFilter !== 'best_selling' }"
                            class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors duration-200">
                        🔥 Bán chạy
                    </button>
                    <button @click="activeFilter = 'newest'"
                            :class="{ 'bg-pink-200 text-pink-800': activeFilter === 'newest', 'bg-white text-gray-600': activeFilter !== 'newest' }"
                            class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors duration-200">
                        ✨ Hàng mới
                    </button>
                    <button @click="activeFilter = 'top_rated'"
                            :class="{ 'bg-pink-200 text-pink-800': activeFilter === 'top_rated', 'bg-white text-gray-600': activeFilter !== 'top_rated' }"
                            class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors duration-200">
                        ⭐ Đánh giá cao
                    </button>
                </div>

                <div id="product-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
                    <template x-for="product in filteredProducts()" :key="product.id">
                        <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden group">
                            <div @click="openQuickView(product)" class="relative overflow-hidden cursor-pointer">
                                <img :src="product.image" :alt="product.name" class="w-full aspect-square object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            <div class="p-4">
                                <h3 @click="openQuickView(product)" class="font-semibold text-gray-800 truncate group-hover:text-pink-600 transition-colors cursor-pointer" x-text="product.name"></h3>
                                <!-- Price, Rating, and Purchases -->
                                <div class="mt-2 space-y-2">
                                    <div class="flex items-baseline">
                                        <span class="text-pink-600 font-bold text-lg" x-text="formatCurrency(product.price)"></span>
                                        <template x-if="product.original_price">
                                            <span class="text-gray-400 line-through text-xs ml-2" x-text="formatCurrency(product.original_price)"></span>
                                        </template>
                                    </div>
                                    <div class="flex items-center text-xs text-gray-500">
                                        <div class="flex items-center">
                                            <template x-for="star in [1, 2, 3, 4, 5]" :key="star">
                                                <svg class="w-3.5 h-3.5" :class="star <= product.rating ? 'text-yellow-400' : 'text-gray-300'" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                                </svg>
                                            </template>
                                        </div>
                                        <div class="border-l h-3.5 mx-2 border-gray-300"></div>
                                        <span x-text="`Đã bán ${product.purchases}+`"></span>
                                    </div>
                                </div>
                                <!-- Action Buttons -->
                                <div class="mt-4 flex items-center space-x-2">
                                    <button @click.stop="openItemOptionsModal(product)" class="flex-shrink-0 bg-pink-100 text-pink-700 h-10 w-10 rounded-lg hover:bg-pink-200 transition-colors duration-300 flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
                                        </svg>
                                    </button>
                                    <button @click.stop="buyNow(product)" class="w-full bg-pink-600 text-white h-10 rounded-lg hover:bg-pink-700 transition-colors duration-300 font-semibold text-sm">
                                        Mua ngay

                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Nút Xem Thêm -->
                <div x-show="canLoadMore()" class="text-center mt-10">
                    <button @click="loadMoreProducts()"
                            class="bg-white hover:bg-pink-50 text-pink-600 font-semibold py-3 px-8 border border-pink-200 rounded-full shadow-sm transition-all duration-300 transform hover:scale-105">
                        Xem thêm sản phẩm
                    </button>
                </div>
            </div>


            <!-- Checkout Modal -->
            <div x-show="isCheckoutModalOpen" x-cloak class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <!-- Overlay -->
                    <div x-show="isCheckoutModalOpen"
                         x-transition:enter="ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         x-transition:leave="ease-in duration-200"
                         x-transition:leave-start="opacity-100"
                         x-transition:leave-end="opacity-0"
                         class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                         @click="isCheckoutModalOpen = false; isMiniCartOpen = true" aria-hidden="true"></div>

                    <!-- Modal Panel -->
                    <div x-show="isCheckoutModalOpen"
                         x-transition:enter="ease-out duration-300"
                         x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                         x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                         x-transition:leave="ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                         x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                         class="w-full h-full sm:h-auto sm:inline-block sm:align-middle bg-gray-50 sm:rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:max-w-5xl">

                        <!-- Modal Header -->
                        <div class="flex items-center justify-between p-4 border-b bg-gray-100 rounded-t-lg">
                            <h3 class="text-xl font-bold text-gray-800">Thông tin thanh toán</h3>
                            <button @click="isCheckoutModalOpen = false; isMiniCartOpen = true" class="text-gray-500 hover:text-gray-800">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <!-- Modal Content -->
                        <div class="p-4 sm:p-6 pb-24 sm:pb-28">
            <!-- Cart View Content -->
            <div>


                <!-- Empty Cart Message -->
                <div x-show="cart.length === 0" class="text-center text-gray-500 py-16 bg-white rounded-lg shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <p class="mt-4 text-lg">Giỏ hàng của bạn đang trống.</p>
                    <button @click="backToShopping()" class="mt-6 bg-pink-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-pink-700 transition-colors">Bắt đầu mua sắm</button>
                </div>

                <!-- No Selected Products Message -->
                <div x-show="cart.length > 0 && selectedCartProducts.length === 0" class="text-center text-gray-500 py-16 bg-white rounded-lg shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <p class="mt-4 text-lg">Bạn chưa chọn sản phẩm nào để thanh toán.</p>
                    <p class="mt-2 text-sm text-gray-400">Hãy quay lại mini cart để chọn sản phẩm bạn muốn mua nhé!</p>
                    <button @click="view = 'products'" class="mt-6 bg-pink-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-pink-700 transition-colors">Tiếp tục mua sắm nào</button>
                </div>

                <!-- Cart Content -->
                <div x-show="cart.length > 0 && selectedCartProducts.length > 0" class="grid grid-cols-1 gap-8 items-start">
                    <!-- Left Column: Addons & Shipping Form -->
                    <div class="space-y-6">


                        <!-- Sản phẩm bán kèm ở trang thanh toán - OPTIMIZED -->
                        <div class="checkout-card">
                            <div class="text-center mb-4 pb-4 border-b border-gray-100">
                                <h3 class="checkout-subtitle text-green-600 mb-2">
                                    Các mẹ mua kèm để <strong class="font-bold text-base">TIẾT KIỆM 21.000đ</strong> phí ship!
                                </h3>
                                <p class="text-xs text-gray-500">
                                    Ưu đãi kết thúc sau:
                                    <span x-text="countdownTimer.display" class="font-mono font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded ml-1"></span>
                                </p>
                            </div>
                            <div class="space-y-3">
                                <template x-for="(addon, index) in addonProducts" :key="addon.id">
                                    <div class="addon-card">
                                        <template x-if="index === 0">
                                            <div class="absolute -top-2 -left-2 bg-pink-500 text-white text-xs font-semibold px-2 py-0.5 rounded-full shadow-md z-10">✨ Đừng bỏ lỡ</div>
                                        </template>

                                        <!-- Product Image -->
                                        <img :src="addon.image" :alt="addon.name"
                                             class="addon-image cursor-pointer hover:opacity-80 transition-opacity border border-gray-200"
                                             @click="openAddonDetail(addon)">

                                        <!-- Product Info -->
                                        <div class="addon-content">
                                            <h4 class="product-name-truncate text-gray-800 text-sm mb-1" x-text="addon.name"></h4>
                                            <div class="flex items-baseline space-x-2 mb-1">
                                                <span class="text-sm text-pink-600 font-bold" x-text="formatCurrency(addon.price)"></span>
                                                <template x-if="addon.original_price">
                                                    <s class="text-xs text-gray-400" x-text="formatCurrency(addon.original_price)"></s>
                                                </template>
                                            </div>
                                            <button @click="openAddonDetail(addon)" class="text-xs text-blue-600 hover:text-blue-800 underline">
                                                Xem chi tiết
                                            </button>
                                        </div>

                                        <!-- Actions -->
                                        <div class="addon-actions">
                                            <button @click="addAddonToCart(addon)"
                                                    :disabled="isAddonInCart(addon.id)"
                                                    class="addon-button"
                                                    :class="isAddonInCart(addon.id) ? 'addon-button:disabled' : ''">
                                                <span x-text="isAddonInCart(addon.id) ? '✓ Đã thêm' : 'Thêm'"></span>
                                            </button>

                                            <!-- Benefits -->
                                            <template x-if="addon.id === 'addon_tui_dau_tam'">
                                                <div class="addon-benefit" x-text="isFreeshippingFromDiscount() ? '- 8.000đ' : '+ Freeship'"></div>
                                            </template>
                                            <template x-if="addon.id === 'addon_moc_chia_khoa'">
                                                <div class="addon-benefit">- 10.000đ</div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Shipping Info Card -->
                        <div class="checkout-card">
                            <div class="border-b pb-4 mb-6 border-gray-100">
                                <h3 class="checkout-title">Thông tin nhận hàng</h3>
                                <div class="mt-3 flex items-start p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg">
                                    <svg class="h-5 w-5 text-yellow-600 mr-3 mt-0.5 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                    </svg>
                                    <p class="text-sm text-yellow-800">
                                        <strong>Lưu ý:</strong> Hiện tại đơn vị vận chuyển chưa cập nhật địa chỉ hành chính mới, nên vẫn sử dụng địa chỉ hành chính cũ.
                                    </p>
                                </div>
                            </div>
                            <form id="shipping-form" @submit.prevent="validateAndShowConfirmModal()" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
                                    <div>
                                        <label for="fullName" class="block text-sm font-medium text-gray-700">Họ và tên</label>
                                        <div class="mt-1">
                                            <input type="text" x-model="customer.name" id="fullName" placeholder="Ví dụ: Nguyễn Thị An" class="block w-full border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent custom-input-indent" required>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="phone" class="block text-sm font-medium text-gray-700">Số điện thoại</label>
                                        <div class="mt-1">
                                            <input type="tel" x-model="customer.phone" id="phone" placeholder="SĐT 10 số để shop gọi xác nhận" class="block w-full border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent custom-input-indent" required pattern="(0[35789])+([0-9]{8})\b" title="Vui lòng nhập số điện thoại hợp lệ (10 số)." oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-5">
                                    <div>
                                        <label for="province" class="block text-sm font-medium text-gray-700">Tỉnh/Thành phố</label>
                                        <select id="province" x-model="selectedProvince" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent custom-input-indent" required>
                                            <option value="">-- Chọn Tỉnh/Thành phố --</option>
                                            <template x-for="province in provinces" :key="province.Id">
                                                <option :value="province.Id" x-text="province.Name"></option>
                                            </template>
                                        </select>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
                                        <div>
                                            <label for="district" class="block text-sm font-medium text-gray-700">Quận/Huyện</label>
                                            <select id="district" x-model="selectedDistrict" :disabled="!selectedProvince" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent disabled:bg-gray-100 custom-input-indent" required>
                                                <option value="">-- Chọn Quận/Huyện --</option>
                                                <template x-for="district in districts" :key="district.Id">
                                                    <option :value="district.Id" x-text="district.Name"></option>
                                                </template>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="ward" class="block text-sm font-medium text-gray-700">Phường/Xã</label>
                                            <select id="ward" x-model="selectedWard" :disabled="!selectedDistrict" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent disabled:bg-gray-100 custom-input-indent" required>
                                                <option value="">-- Chọn Phường/Xã --</option>
                                                <template x-for="ward in wards" :key="ward.Id">
                                                    <option :value="ward.Id" x-text="ward.Name"></option>
                                                </template>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="streetAddress" class="block text-sm font-medium text-gray-700">Số nhà, tên đường</label>
                                        <div class="mt-1">
                                            <input type="text" x-model="streetAddress" id="streetAddress" placeholder="Ví dụ: 123 Đường ABC" class="block w-full border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent custom-input-indent" required>
                                        </div>
                                    </div>
                                    <input type="hidden" x-model="customer.address">
                                </div>

                                <div>
                                    <label for="notes" class="block text-sm font-medium text-gray-700">Ghi chú (tùy chọn)</label>
                                    <div class="mt-1">
                                        <textarea x-model="customer.notes" id="notes" rows="3" placeholder="Ví dụ: Bé trai 5kg, quấn thêm chỉ đỏ..." class="block w-full border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent custom-input-indent"></textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- Social Proof -->
                        <div x-show="socialProofCount > 0"
                             class="bg-green-50 border border-green-200 text-green-900 px-4 py-3 rounded-lg text-sm flex items-start space-x-3 shadow-sm"
                             x-transition:enter="transition ease-out duration-300"
                             x-transition:enter-start="opacity-0 transform -translate-y-2"
                             x-transition:enter-end="opacity-100 transform translate-y-0">
                            <svg class="w-5 h-5 mt-0.5 flex-shrink-0 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.934l.643 2.113a1 1 0 01-.814 1.259l-2.113-.643a1 1 0 00-.934.822c-.276.587-.558.915-.934 1.45a1 1 0 00.386 1.45l2.113.643a1 1 0 01-.643 2.113l-1.259-.814a1 1 0 00-1.259.814l-.643 2.113a1 1 0 00.822.934c.587.276.915.558 1.45.934a1 1 0 001.45-.385c.345-.23.614-.558.822-.934l-.643-2.113a1 1 0 01.814-1.259l2.113.643a1 1 0 00.934-.822c.276-.587.558-.915.934-1.45a1 1 0 00-.386-1.45l-2.113-.643a1 1 0 01.643-2.113l1.259.814a1 1 0 001.259-.814l.643-2.113a1 1 0 00-.822-.934c-.587-.276-.915-.558-1.45-.934zM7 12a1 1 0 11-2 0 1 1 0 012 0zm3 3a1 1 0 11-2 0 1 1 0 012 0zm2-5a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                            </svg>
                            <p>Có <strong class="font-bold" x-text="socialProofCount"></strong> người đang thêm sản phẩm giống bạn vào giỏ hàng.</p>
                        </div>




                        <!-- Payment Method -->
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h3 class="text-xl font-semibold mb-4">Phương thức thanh toán</h3>
                            <div class="space-y-3">
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer transition-all" :class="{ 'bg-pink-50 border-pink-500': paymentMethod === 'cod' }">
                                    <input type="radio" x-model="paymentMethod" value="cod" name="paymentMethod" class="h-4 w-4 text-pink-600 focus:ring-pink-500 border-gray-300">
                                    <span class="ml-3 text-sm font-medium text-gray-700">Thanh toán khi nhận hàng (COD)</span>
                                </label>
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer transition-all" :class="{ 'bg-pink-50 border-pink-500': paymentMethod === 'bank_transfer' }">
                                    <input type="radio" x-model="paymentMethod" value="bank_transfer" name="paymentMethod" class="h-4 w-4 text-pink-600 focus:ring-pink-500 border-gray-300">
                                    <span class="ml-3 text-sm font-medium text-gray-700">Chuyển khoản ngân hàng</span>
                                </label>
                            </div>
                        </div>




                    </div>
                        <!-- Checkout Modal Footer -->
                                                <div class="absolute bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm border-t border-gray-200 px-4 py-3 sm:px-6 sm:py-4 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] sm:rounded-b-lg">
                            <div class="flex items-center justify-between gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">Tổng cộng</p>
                                    <p class="text-xl sm:text-2xl font-bold text-pink-600" x-text="formatCurrency(cartTotal())"></p>
                                </div>
                                <button type="submit" form="shipping-form" class="bg-pink-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-pink-700 transition-colors shadow-md text-base sm:text-lg flex items-center justify-center flex-grow sm:flex-grow-0 sm:w-auto" :disabled="isSubmitting" :class="{ 'opacity-50 cursor-not-allowed': isSubmitting }">
                                    <svg x-show="isSubmitting" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" style="display: none;">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <span x-show="!isSubmitting">
                                        Đặt Hàng
                                    </span>
                                    <span x-show="isSubmitting" style="display: none;">
                                        Đang xử lý...
                                    </span>
                                </button>
                            </div>
                        </div>

                </div> <!-- End Cart Content Grid -->
            </div> <!-- End Cart View -->
        </div> <!-- End Modal Content -->
    </div> <!-- End Modal Panel -->
</div> <!-- End Checkout Modal -->

        <!-- Order Confirmation Modal -->
        <div x-show="isConfirmModalOpen" @keydown.escape.window="isConfirmModalOpen = false" class="fixed inset-0 bg-gray-800 bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 z-50" style="display: none;" x-transition.opacity>
            <div @click.outside="isConfirmModalOpen = false" class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
                <div class="p-6 border-b">
                    <h2 class="text-2xl font-bold text-gray-800">Xác nhận thông tin đơn hàng</h2>
                    <p class="text-base font-semibold text-red-600 mt-1">Vui lòng kiểm tra thật kĩ thông tin một lần nữa!</p>
                </div>
                <div class="p-6 space-y-6 overflow-y-auto">
                    <!-- Customer Info -->
                    <div class="bg-slate-50 p-4 rounded-lg border">
                        <h3 class="font-semibold text-lg text-gray-800 mb-3">Thông tin người nhận</h3>


                        <div class="grid grid-cols-[max-content,1fr] gap-x-4 gap-y-3 text-base">
                            <span class="text-gray-500">Họ tên:</span>
                            <strong class="text-gray-900 text-left font-semibold" x-text="customer.name"></strong>

                            <span class="text-gray-500">Số điện thoại:</span>
                            <strong class="text-gray-900 text-left font-semibold" x-text="customer.phone"></strong>

                            <span class="text-gray-500 self-start">Địa chỉ:</span>
                            <strong class="text-gray-900 text-left font-semibold" x-text="customer.address"></strong>

                            <template x-if="customer.notes">



                                <div class="col-span-2 grid grid-cols-[max-content,1fr] gap-x-4">
                                    <span class="text-gray-500 self-start">Ghi chú:</span>
                                    <strong class="text-gray-900 text-left font-semibold" x-text="customer.notes"></strong>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Cart Items -->
                    <div>
                        <h3 class="font-semibold text-lg text-gray-700 mb-3 border-b pb-2">Sản phẩm đã chọn</h3>
                        <div class="space-y-4">
                            <template x-for="item in selectedCartProducts" :key="item.id">
                                <div class="flex items-start space-x-4">
                                    <img :src="item.image" class="w-16 h-16 rounded-lg object-cover border">
                                    <div class="flex-grow">
                                        <p class="font-semibold text-gray-800" x-text="item.name"></p>
                                        <p class="text-sm text-gray-500" x-text="`Số lượng: ${item.quantity}`"></p>
                                        <p class="text-sm text-gray-500" x-show="item.weight" x-text="`Cân nặng/Ghi chú SP: ${item.weight}`"></p>
                                    </div>
                                    <p class="font-semibold text-pink-600" x-text="formatCurrency(item.price * item.quantity)"></p>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Order Summary -->
                    <div>

                        <h3 class="font-semibold text-lg text-gray-700 mb-3 border-b pb-2">Tổng kết</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between"><span>Tạm tính:</span> <span x-text="formatCurrency(cartSubtotal())"></span></div>
                            <div class="flex justify-between" x-show="cart.length > 0"><span>Phí vận chuyển:</span> <span x-text="formatCurrency(shippingFee())"></span></div>
                            <template x-if="shippingDiscount > 0">
                                <div class="flex justify-between text-green-600">
                                    <span>Ưu đãi Freeship:</span>
                                    <span x-text="'-' + formatCurrency(shippingDiscount)"></span>
                                </div>
                            </template>
                            <template x-if="addonDiscount > 0">
                                <div class="flex justify-between text-green-600">
                                    <span>Giảm giá (Móc chìa khóa):</span>
                                    <span x-text="'-' + formatCurrency(addonDiscount)"></span>
                                </div>
                            </template>
                            <template x-if="tuiDauTamBonusDiscount > 0">
                                <div class="flex justify-between text-green-600">
                                    <span>Ưu đãi thêm (Túi dâu tằm):</span>
                                    <span x-text="'-' + formatCurrency(tuiDauTamBonusDiscount)"></span>
                                </div>
                            </template>

                            <template x-if="discountAmount > 0">
                                <div class="flex justify-between text-green-600">
                                    <span>Giảm giá của shop:</span>
                                    <span x-text="'-' + formatCurrency(discountAmount)"></span>
                                </div>
                            </template>
                            <div class="flex justify-between font-bold text-base pt-2 border-t">
                                <span>Tổng cộng:</span>
                                <span x-text="formatCurrency(cartTotal())"></span>
                            </div>
                        </div>
                    </div>
                     <!-- Payment Method -->
                    <div>
                        <h3 class="font-semibold text-lg text-gray-700 mb-3 border-b pb-2">Thanh toán</h3>
                        <p class="text-sm" x-text="paymentMethod === 'cod' ? 'Thanh toán khi nhận hàng (COD)' : 'Chuyển khoản ngân hàng'"></p>
                    </div>
                </div>
                <div class="p-6 bg-gray-50 border-t rounded-b-2xl flex flex-col sm:flex-row-reverse gap-3">
                    <button @click="confirmAndSubmitOrder()" :disabled="isSubmitting" class="w-full sm:w-auto bg-pink-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-pink-700 transition-colors flex items-center justify-center" :class="{ 'opacity-50 cursor-not-allowed': isSubmitting }">
                        <svg x-show="isSubmitting" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" style="display: none;"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        <span x-show="isSubmitting" style="display: none;">Đang xử lý...</span>
                        <span x-show="!isSubmitting">Xác nhận đặt hàng</span>
                    </button>
                    <button @click="isConfirmModalOpen = false" class="w-full sm:w-auto bg-white text-gray-700 font-semibold py-3 px-6 rounded-lg hover:bg-gray-100 transition-colors border">
                        Sửa lại thông tin
                    </button>
                </div>
            </div>
        </div>

        <!-- Order Success Modal -->
        <div x-show="isSuccessModalOpen"
             class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 z-[60]"
             style="display: none;"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0">
            <div @click.outside="closeSuccessModal()"
                 class="bg-white rounded-2xl shadow-2xl w-full max-w-md text-center p-8 transform transition-all"
                 x-show="isSuccessModalOpen"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95">

                <div class="mx-auto flex items-center justify-center h-24 w-24 rounded-full bg-green-100 mb-6">
                    <svg class="h-16 w-16 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>

                <h2 class="text-3xl font-bold text-gray-800 mb-3">Đặt hàng thành công!</h2>
                <p class="text-gray-600 mb-4">Cảm ơn bạn đã tin tưởng và đặt hàng các sản phẩm về dâu tằm của em làm. Em sẽ gọi điện xác nhận lại đơn hàng sau vài giờ nữa ạ.</p>
                <div class="bg-pink-50 border border-pink-200 rounded-lg px-4 py-3 mb-8">
                    <p class="text-sm text-gray-600">Mã đơn hàng của bạn là:</p>
                    <p class="text-2xl font-bold text-pink-600 tracking-wider" x-text="lastOrderId"></p>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 text-left space-y-3 mb-8">
                    <div class="flex items-start">
                        <svg class="h-5 w-5 text-pink-500 mr-3 mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 7.586V6z" clip-rule="evenodd" />
                        </svg>
                        <p class="text-gray-700">Thời gian giao hàng dự kiến là <strong>3 đến 5 ngày</strong> kể từ thời điểm đặt hàng.</p>
                    </div>
                    <div class="flex items-start">
                        <svg class="h-5 w-5 text-blue-500 mr-3 mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                             <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                        </svg>
                        <p class="text-gray-700">Nếu có bất kỳ thắc mắc gì, vui lòng liên hệ Zalo: <strong class="text-blue-600">0972.483.892</strong> (Ánh Vòng Dâu Tằm).</p>
                    </div>
                </div>

                <button @click="closeSuccessModal()" class="w-full bg-pink-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-pink-700 transition-colors duration-300 shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50">
                    Tiếp tục mua sắm
                </button>
            </div>
        </div>

        <!-- Bank Transfer Info Modal -->
        <div x-show="isBankTransferModalOpen"
             class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 z-[60]"
             style="display: none;"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0">
            <div @click.outside="closeBankTransferModal()"
                 class="bg-white rounded-2xl shadow-2xl w-full max-w-md text-center p-8 transform transition-all"
                 x-show="isBankTransferModalOpen"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95">

                <h2 class="text-2xl font-bold text-gray-800 mb-2">Quét mã QR để thanh toán</h2>
                <div class="px-4">
                    <img src="./assets/images/qrcode.jpeg" alt="Mã QR thanh toán" class="w-full max-w-[250px] h-auto mx-auto rounded-lg shadow-md border">
                </div>

                <div class="bg-red-50 border-l-4 border-red-500 text-red-800 p-4 my-6 text-left">
                    <p class="font-bold">Nội dung chuyển khoản:</p>
                    <div class="flex justify-between items-center mt-1">
                        <p class="text-xl font-mono tracking-widest" x-text="lastOrderId"></p>
                        <button @click="navigator.clipboard.writeText(lastOrderId); showAlert('Đã sao chép mã đơn hàng!')" class="bg-red-100 text-red-800 text-xs font-semibold px-2 py-1 rounded-md hover:bg-red-200">SAO CHÉP</button>
                    </div>
                </div>

                <div class="text-left text-sm space-y-2 text-gray-600">
                    <p><strong>Ngân hàng:</strong> TECHCOMBANK</p>
                    <p><strong>Chủ tài khoản:</strong> LE THI ANH</p>
                    <p><strong>Số tài khoản:</strong> 0972483892</p>
                </div>

                <p class="text-xs text-green-500 mt-8">Sau khi chuyển khoản thành công, hãy bấm "Xác nhận đã chuyển khoản".</p>
                <button @click="closeBankTransferModal()" class="mt-2 w-full bg-pink-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-pink-700 transition-colors duration-300 shadow-lg focus:outline-none">
                    Xác nhận đã chuyển khoản
                </button>
            </div>
        </div>

        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-pink-50 to-purple-50 border-t border-pink-100 mt-16 w-full" x-show="!loading">
        <div class="max-w-7xl mx-auto px-4 py-12">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Brand Section -->
                    <div class="text-center md:text-left">
                        <div class="flex items-center justify-center md:justify-start mb-4">
                            <div class="bg-gradient-to-r from-pink-500 to-purple-500 text-white w-12 h-12 rounded-full flex items-center justify-center mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800">Vòng Dâu Tằm By Ánh</h3>
                        </div>
                        <p class="text-gray-600 text-sm leading-relaxed mb-4">
                            Chuyên cung cấp các sản phẩm vòng dâu tằm chất lượng cao,
                            mang lại sức khỏe và may mắn cho bạn và gia đình.
                        </p>
                        <div class="flex justify-center md:justify-start space-x-4">
                            <a href="https://zalo.me/0972483892" target="_blank" rel="noopener noreferrer"
                               class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-full transition-colors duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16.25,10.25H14.38V8.38a.5.5,0,0,0-.5-.5H12.38a.5.5,0,0,0-.5.5v1.87H10.38a.5.5,0,0,0-.5.5v1.5a.5.5,0,0,0,.5.5h1.5v3.25a.5.5,0,0,0,.5.5h1.5a.5.5,0,0,0,.5-.5V12.75h1.87a.5.5,0,0,0,.5-.5v-1.5A.5.5,0,0,0,16.25,10.25ZM12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z"/>
                                </svg>
                            </a>
                            <a href="tel:0972483892"
                               class="bg-green-500 hover:bg-green-600 text-white p-2 rounded-full transition-colors duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                </svg>
                            </a>
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="text-center md:text-left">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Thông tin liên hệ</h4>
                        <div class="space-y-3">
                            <div class="flex items-start justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500 mr-3 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                <div>
                                    <p class="text-gray-600 text-sm leading-relaxed">
                                        Xóm 4, Đông Cao<br>
                                        Tráng Việt, Hà Nội
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                </svg>
                                <p class="text-gray-600 text-sm">0972.483.892</p>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <p class="text-gray-600 text-sm">Thứ 2 - Chủ nhật: 8:00 - 22:00</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Links -->
                    <div class="text-center md:text-left">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Dịch vụ</h4>
                        <div class="space-y-2">
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-gray-600 text-sm">Vòng dâu tằm chính hãng</p>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-gray-600 text-sm">Giao hàng toàn quốc</p>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-gray-600 text-sm">Tư vấn miễn phí</p>
                            </div>
                            <div class="flex items-center justify-center md:justify-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-gray-600 text-sm">Đổi trả trong 7 ngày</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Section -->
                <div class="border-t border-pink-200 mt-8 pt-6">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <p class="text-gray-500 text-sm text-center md:text-left mb-4 md:mb-0">
                            © 2024 Vòng Dâu Tằm By Ánh. Tất cả quyền được bảo lưu.
                        </p>
                        <div class="flex items-center space-x-4">
                            <span class="text-gray-400 text-xs">Được thiết kế với</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                            </svg>
                            <span class="text-gray-400 text-xs">tại Việt Nam</span>
                        </div>
                    </div>
                </div>
            </div>
    </footer>

    <div class="container mx-auto p-4" x-data="shop" x-cloak>
        <!-- Image Viewer Modal -->

        <!-- Social Proof Notification -->
        <div x-show="notification.visible"
             x-transition:enter="transition ease-out duration-300 transform"
             x-transition:enter-start="-translate-y-10 opacity-0"
             x-transition:enter-end="translate-y-0 opacity-100"
             x-transition:leave="transition ease-in duration-300 transform"
             x-transition:leave-start="translate-y-0 opacity-100"
             x-transition:leave-end="-translate-y-10 opacity-0"
             class="fixed top-4 left-1/2 -translate-x-1/2 sm:left-4 sm:translate-x-0 z-50 bg-white rounded-xl shadow-lg p-4 flex items-center space-x-3 border w-11/12 max-w-md sm:w-auto"
             style="display: none;">
            <div class="bg-pink-100 text-pink-600 p-2 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15h14a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" />
                </svg>
            </div>
            <p class="text-sm text-gray-700 font-medium" x-text="notification.message"></p>
        </div>

    </div>

    <!-- Image Viewer Modal -->
    <div x-show="isImageModalOpen" @keydown.escape.window="closeImageModal()" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm flex items-center justify-center p-4 z-50" style="display: none;" x-transition>
        <div @click.outside="closeImageModal()" class="relative">
            <img :src="currentImage" alt="Xem ảnh lớn" class="max-w-full max-h-[90vh] rounded-lg shadow-lg">
            <button @click="closeImageModal()" class="absolute -top-4 -right-4 bg-white text-black w-10 h-10 rounded-full flex items-center justify-center shadow-lg hover:bg-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <!-- FAQ Modal -->
    <div x-show="isFaqModalOpen" @keydown.escape.window="closeFaqModal()"
         class="fixed inset-0 bg-gray-800 bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 z-[60]"
         style="display: none;"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
        <div @click.outside="closeFaqModal()"
             class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col"
             x-show="isFaqModalOpen"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95">

            <!-- Header -->
            <div class="flex items-center justify-between p-6 border-b">
                <h3 class="text-xl font-bold text-gray-800">❔ Những câu hỏi thường gặp</h3>
                <button @click="closeFaqModal()" class="text-gray-500 hover:text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- FAQ List -->
            <div class="flex-grow p-6 overflow-y-auto space-y-4">
                <template x-for="(faq, index) in faqItems" :key="index">
                    <div class="border-b border-gray-200 pb-4">
                        <button @click="toggleFaq(index)" class="w-full flex justify-between items-center text-left">
                            <span class="font-semibold text-gray-800" x-text="faq.question"></span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 transition-transform" :class="{ 'rotate-180': openFaqIndex === index }" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div x-show="openFaqIndex === index" x-collapse class="mt-2 text-gray-600 text-sm" x-text="faq.answer"></div>
                    </div>
                </template>
            </div>

            <!-- Footer -->
            <div class="p-6 border-t bg-gray-50 rounded-b-2xl flex items-center space-x-3">
                <button @click="closeFaqModal()" class="flex-1 bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                    Đã hiểu
                </button>
                <a href="https://zalo.me/0972483892" target="_blank" rel="noopener noreferrer" class="flex-1 bg-blue-500 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-600 transition-colors text-center">
                    Kết nối Zalo
                </a>
            </div>
        </div>
    </div>

    <!-- Addon Detail Modal -->
    <div x-show="isAddonDetailModalOpen" @keydown.escape.window="closeAddonDetail()"
         class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm flex items-center justify-center p-4 z-[60]"
         style="display: none;"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
        <div @click.outside="closeAddonDetail()"
             class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-all"
             x-show="isAddonDetailModalOpen"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95">

            <template x-if="currentAddonDetail">
                <div>
                    <!-- Header with Image -->
                    <div class="relative">
                        <img :src="currentAddonDetail.image" :alt="currentAddonDetail.name"
                             class="w-full aspect-square object-cover rounded-t-2xl">
                        <button @click="closeAddonDetail()"
                                class="absolute top-4 right-4 bg-white bg-opacity-90 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center shadow-lg hover:bg-opacity-100 transition-all">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Content -->
                    <div class="p-6">
                        <!-- Title and Price -->
                        <div class="flex items-start justify-between mb-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800" x-text="currentAddonDetail.name"></h2>
                                <p class="text-lg text-gray-600 mt-1" x-text="currentAddonDetail.description"></p>
                            </div>
                            <div class="text-right">
                                <div class="flex items-baseline justify-end space-x-2">
                                    <p class="text-2xl font-bold text-pink-600" x-text="formatCurrency(currentAddonDetail.price)"></p>
                                    <template x-if="currentAddonDetail.original_price">
                                        <s class="text-lg text-gray-500" x-text="formatCurrency(currentAddonDetail.original_price)"></s>
                                    </template>
                                </div>




                            </div>
                        </div>
                        <!-- Freeship Banner -->
                        <div class="my-4 p-3 bg-green-100 border border-green-200 rounded-lg text-center">
                            <p class="text-sm text-green-800 font-semibold">🎁 Mua vòng dâu tằm kèm <span id="addon-product-name">Túi Dâu Tằm</span> sẽ được <span class="font-bold">freeship</span></p>
                        </div>







                        <!-- Full Description -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">📝 Mô tả chi tiết</h3>
                            <p class="text-gray-700 leading-relaxed" x-text="currentAddonDetail.detailedInfo?.fullDescription"></p>
                        </div>

                        <!-- Benefits -->

                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">✨ Lợi ích</h3>
                            <div class="space-y-2">
                                <template x-for="benefit in currentAddonDetail.detailedInfo?.benefits || []" :key="benefit">
                                    <div class="flex items-start space-x-2">
                                        <span class="text-green-500 mt-1">•</span>
                                        <span class="text-gray-700" x-text="benefit"></span>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Usage -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">📋 Cách sử dụng</h3>
                            <p class="text-gray-700 leading-relaxed" x-text="currentAddonDetail.detailedInfo?.usage"></p>
                        </div>

                        <!-- Materials and Origin -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">🧱 Chất liệu</h4>
                                <p class="text-gray-700 text-sm" x-text="currentAddonDetail.detailedInfo?.materials"></p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">🏭 Xuất xứ</h4>
                                <p class="text-gray-700 text-sm" x-text="currentAddonDetail.detailedInfo?.origin"></p>
                            </div>
                        </div>

                        <!-- Cam kết -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">🛡️ Cam kết từ shop</h3>
                            <div class="space-y-2">
                                <div class="flex items-start space-x-2">
                                    <span class="text-green-500 mt-1">✓</span>
                                    <span class="text-gray-700">Làm thủ công bằng tay 100%</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-green-500 mt-1">✓</span>
                                    <span class="text-gray-700">Dâu tằm đực Việt Nam, không ra quả</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-green-500 mt-1">✓</span>
                                    <span class="text-gray-700">Được kiểm tra hàng trước khi thanh toán</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-green-500 mt-1">✓</span>
                                    <span class="text-gray-700">Không hóa chất, không chất bảo quản, an toàn tuyệt đối</span>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Action Buttons - Footer -->
                    <div class="p-4 bg-white border-t sticky bottom-0 rounded-b-2xl">
                        <div class="flex space-x-3">
                            <button @click="closeAddonDetail()"
                                    class="w-2/5 bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                                Đóng
                            </button>
                            <button @click="addAddonToCart(currentAddonDetail); closeAddonDetail()"
                                    :disabled="isAddonInCart(currentAddonDetail.id)"
                                    class="w-3/5 font-semibold py-3 px-4 rounded-lg transition-colors"
                                    :class="isAddonInCart(currentAddonDetail.id) ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-pink-600 text-white hover:bg-pink-700'">
                                <span x-show="!isAddonInCart(currentAddonDetail.id)">🛒 Thêm vào giỏ</span>
                                <span x-show="isAddonInCart(currentAddonDetail.id)">✓ Đã có trong giỏ</span>
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Discount Code Modal -->
    <div x-show="isDiscountModalOpen" @keydown.escape.window="closeDiscountModal()"
         class="fixed inset-0 bg-gray-800 bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 z-[60]"
         style="display: none;"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
        <div @click.outside="closeDiscountModal()"
             class="bg-white rounded-2xl shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col transform transition-all"
             x-show="isDiscountModalOpen"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95">

            <!-- Header -->
            <div class="flex items-center justify-between p-4 bg-pink-50 rounded-t-lg">
                <div class="flex items-center space-x-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pink-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                    </svg>
                    <h3 class="text-lg font-bold text-slate-800">Chọn mã giảm giá</h3>
                </div>
                <button @click="closeDiscountModal()" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center self-start">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>

            <!-- Discount Codes List -->
            <div class="flex-grow p-6 overflow-y-auto">
                <!-- Manual Input -->
                <div class="mb-6">
                    <div class="flex space-x-2">
                        <input type="text" x-model="discountCode" placeholder="Nhập mã giảm giá tại đây"
                               class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-0 focus:border-pink-400 focus:outline-none text-sm h-11">
                        <button @click="applySelectedDiscount(true)"
                                class="bg-pink-600 text-white font-semibold px-5 rounded-md hover:bg-pink-700 transition-colors text-sm whitespace-nowrap">
                            Áp dụng
                        </button>
                    </div>
                        <p x-show="discountError" x-text="discountError" class="text-red-500 text-sm mt-2"></p>
                </div>
                <div class="space-y-4">
                    <template x-for="discount in sortedDiscounts" :key="discount.code">
                        <div @click="discount.availability.available ? selectDiscount(discount.code) : null"
                             class="border rounded-lg p-4 transition-all duration-200"
                             :class="{
                                 'border-pink-500 bg-pink-50 shadow-md': discountCode === discount.code,
                                 'border-gray-200 bg-white': discountCode !== discount.code,
                                 'opacity-60': !discount.availability.available,
                                 'cursor-pointer hover:border-pink-300 hover:bg-pink-50/50': discount.availability.available,
                                 'cursor-not-allowed': !discount.availability.available
                             }">
                            <div class="flex items-start space-x-4">
                                <!-- Radio button -->
                                <div class="flex-shrink-0 pt-1">
                                    <div class="w-5 h-5 rounded-full border-2 flex items-center justify-center"
                                         :class="discountCode === discount.code ? 'border-pink-500 bg-pink-500' : 'border-gray-300 bg-white'">
                                        <svg x-show="discountCode === discount.code" class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                                    </div>
                                </div>
                                <!-- Content -->
                                <div class="flex-grow">
                                    <!-- Tags -->
                                    <div class="flex items-center flex-wrap gap-2 mb-2">
                                        <span class="bg-gradient-to-r from-pink-500 to-purple-500 text-white px-3 py-1 rounded-full text-xs font-bold tracking-wide" x-text="discount.code"></span>
                                        <template x-if="discount.type === 'gift'"><span class="bg-blue-100 text-blue-600 px-2 py-0.5 rounded text-xs font-medium">🎁 Quà tặng</span></template>
                                        <template x-if="discount.type === 'shipping'"><span class="bg-green-100 text-green-700 px-2 py-0.5 rounded text-xs font-medium">Freeship</span></template>
                                        <template x-if="discount.type === 'percentage'"><span class="bg-red-100 text-red-600 px-2 py-0.5 rounded text-xs font-medium" x-text="discount.value + '% OFF'"></span></template>
                                        <template x-if="discount.type === 'fixed'"><span class="bg-indigo-100 text-indigo-600 px-2 py-0.5 rounded text-xs font-medium" x-text="'-' + formatCurrency(discount.value)"></span></template>
                                    </div>
                                    <!-- Description -->
                                    <p class="text-gray-700 text-sm mb-3" x-text="discount.description"></p>
                                    <!-- Details -->
                                    <div class="text-xs space-y-1 border-l-2 border-gray-200 pl-3">
                                        <p class="text-gray-600">
                                            Đơn tối thiểu: <strong class="font-semibold text-gray-800" x-text="formatCurrency(discount.minOrder)"></strong>
                                            <template x-if="discount.minItems"><span x-text="` / ${discount.minItems} sản phẩm`"></span></template>
                                        </p>
                                        <p x-show="discount.availability.available && discount.effectiveValue > 0" class="text-green-600">
                                            Tiết kiệm: <strong class="font-semibold" x-text="formatCurrency(discount.effectiveValue)"></strong>
                                        </p>
                                    </div>
                                    <!-- Status -->
                                    <div class="mt-3">
                                        <span x-show="discount.availability.available" class="inline-flex items-center bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-1 rounded-full">
                                            <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-green-500" fill="currentColor" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3" /></svg>
                                            Đủ điều kiện
                                        </span>
                                        <p x-show="!discount.availability.available" class="text-xs text-red-600 font-semibold" x-text="discount.availability.reason"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Footer -->
            <div class="p-6 border-t bg-gray-50 rounded-b-2xl flex space-x-3">
                <button @click="closeDiscountModal()" class="flex-1 bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                    Hủy
                </button>
                <button @click="applySelectedDiscount(true)" class="flex-1 bg-pink-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-pink-700 transition-colors">
                    Áp dụng mã
                </button>
            </div>
        </div>
    </div>

    </div>

    <script src="./assets/js/app.js"></script>

        <!-- Mini Cart Modal -->
        <div x-show="isMiniCartOpen" @keydown.escape.window="isMiniCartOpen = false"
             class="fixed inset-0 bg-gray-800 bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 z-50"
             style="display: none;"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0">
            <div @click.outside="if (!preventMiniCartCloseOnClickOutside) isMiniCartOpen = false"
                 class="bg-white rounded-2xl shadow-xl w-full max-w-md sm:max-w-2xl max-h-[90vh] flex flex-col transform transition-all"
                 x-show="isMiniCartOpen"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95">

                <!-- Header -->
                <div class="flex items-center justify-between p-4 bg-pink-50 rounded-t-lg">
                    <div class="flex items-center space-x-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pink-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <h3 class="text-lg font-bold text-slate-800">Giỏ Hàng Của Bạn</h3>
                    </div>
                    <button @click="isMiniCartOpen = false" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center self-start">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                </div>

                <!-- Body (Scrollable Content) -->
                <div class="flex-grow overflow-y-auto p-6">
                    <template x-if="cart.length === 0">
                        <div class="text-center py-10 px-6">
                            <div class="flex justify-center mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">Giỏ hàng của bạn đang trống</h3>
                            <p class="text-gray-500 text-sm mb-6">Hãy để chúng tôi gợi ý những sản phẩm được yêu thích nhất nhé!</p>
                            <button @click="showBestSellers()" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 ease-in-out">
                                <span class="flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.28 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>10 sản phẩm bán chạy nhất</span>
                            </button>
                        </div>
                    </template>

                    <div x-show="cart.length > 0" class="space-y-4">
                        <!-- Cart Items List -->
                        <div class="flex items-center justify-between pb-3 border-b border-gray-200">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" :checked="isAllSelected" @change="toggleSelectAll()" class="h-4 w-4 text-pink-600 focus:ring-pink-500 border-gray-300 rounded">
                                <label class="text-sm font-medium text-gray-700 cursor-pointer" @click="toggleSelectAll()">Chọn tất cả</label>
                            </div>
                            <button @click="clearCart()" class="text-sm text-gray-500 hover:text-red-600 font-medium transition-colors flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg><span>Xóa hết</span></button>
                        </div>
                        <template x-for="item in cart" :key="item.id">
                            <div class="flex items-start space-x-3">
                                <input type="checkbox" :checked="selectedCartItems.includes(item.id)" @change="toggleCartItemSelection(item.id)" class="mt-1 h-4 w-4 text-pink-600 focus:ring-pink-500 border-gray-300 rounded">
                                <img :src="item.image" class="w-16 h-16 rounded-lg object-cover border flex-shrink-0">
                                <div class="flex-grow">
                                    <p class="font-semibold text-gray-800 text-sm" x-text="item.name"></p>
                                    <p class="text-sm text-gray-500 mt-1" x-text="formatCurrency(item.price)"></p>
                                    <div class="flex items-center justify-between mt-2">
                                        <div class="flex items-center space-x-2">
                                            <button @click="decreaseQuantity(item.id)" class="w-6 h-6 bg-gray-200 text-gray-700 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors text-lg font-bold leading-none pb-1">-</button>
                                            <span x-text="item.quantity" class="font-semibold text-sm text-gray-800 w-5 text-center"></span>
                                            <button @click="increaseQuantity(item.id)" class="w-6 h-6 bg-gray-200 text-gray-700 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors text-base font-bold">+</button>
                                        </div>
                                        <p class="font-bold text-pink-600 text-sm" x-text="formatCurrency(item.price * item.quantity)"></p>
                                    </div>
                                    <div class="mt-3">
                                        <input type="text" x-model="item.weight" placeholder="Ghi chú: bé 5kg, hạt to..." class="block w-full border-gray-200 rounded-md shadow-sm focus:ring-pink-300 focus:border-pink-300 text-xs h-8 placeholder-gray-400">
                                    </div>
                                </div>
                                <button @click="removeFromCart(item.id)" class="text-gray-400 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                            </div>
                        </template>

                        <!-- Upsell, Discount, and Summary Section -->
                        <div class="pt-4 space-y-4">
                            <!-- Upsell -->
                            <div>
                                <div class="text-center mb-3">
                                    <p class="text-sm font-medium text-green-600">Các mẹ mua kèm để <strong class="font-bold">TIẾT KIỆM 21.000đ</strong> phí ship!</p>
                                    <p class="text-xs text-gray-500 mt-1.5">Ưu đãi kết thúc sau: <span x-text="countdownTimer.display" class="font-mono font-semibold text-gray-700 bg-gray-100 px-1.5 py-0.5 rounded"></span></p>
                                </div>
                                <div class="space-y-2">
                                    <template x-for="(addon, index) in addonProducts" :key="addon.id">
                                        <div class="relative flex items-center space-x-3 p-2.5 bg-pink-50 rounded-lg border border-pink-100">
                                            <template x-if="index === 0"><div class="absolute -top-2 -left-2 bg-pink-500 text-white text-xs font-semibold px-2 py-0.5 rounded-full shadow-md">✨ Đừng bỏ lỡ...</div></template>
                                            <img :src="addon.image" :alt="addon.name" class="w-12 h-12 rounded-md object-cover border flex-shrink-0 cursor-pointer hover:opacity-80 transition-opacity" @click="openAddonDetail(addon)">
                                            <div class="flex-grow">
                                                <p class="font-semibold text-gray-800 text-sm leading-tight" x-text="addon.name"></p>
                                                <div class="flex items-baseline space-x-1.5">
                                                    <p class="text-sm text-pink-600 font-bold" x-text="formatCurrency(addon.price)"></p>
                                                    <template x-if="addon.original_price"><s class="text-xs text-gray-500" x-text="formatCurrency(addon.original_price)"></s></template>
                                                </div>
                                                <button @click="openAddonDetail(addon)" class="text-xs text-blue-600 hover:text-blue-800 underline mt-1">Xem chi tiết</button>
                                            </div>
                                            <div class="flex flex-col items-center w-20 text-center">
                                                <button @click="addAddonToCart(addon)" :disabled="isAddonInCart(addon.id)" class="flex-shrink-0 text-xs font-medium rounded-lg transition-colors h-8 w-full flex items-center justify-center" :class="isAddonInCart(addon.id) ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-pink-600 text-white hover:bg-pink-700'">
                                                    <span x-text="isAddonInCart(addon.id) ? '✓' : 'Thêm'"></span>
                                                </button>
                                                <template x-if="addon.id === 'addon_tui_dau_tam'"><p class="text-xs text-green-600 font-semibold mt-1" x-text="isFreeshippingFromDiscount() ? '- 8.000đ' : '+ Freeship'"></p></template>
                                                <template x-if="addon.id === 'addon_moc_chia_khoa'"><p class="text-xs text-green-600 font-semibold mt-1">- 5.000đ</p></template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Discount Code -->
                            <div class="pt-4 border-t">
                                <p x-show="isEligibleForAnyDiscount" class="text-green-700 text-sm text-center font-medium mb-2">🎉 Đủ điều kiện nhận mã giảm giá và quà tặng!</p>
                                <div class="border border-dashed border-pink-300 p-3 rounded-lg flex justify-between items-center">
                                    <div class="flex items-center">
                                        <svg x-show="!discountCode" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg>
                                        <svg x-show="discountCode && !appliedGift" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                        <svg x-show="appliedGift" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" /></svg>
                                        <p class="font-semibold text-gray-700 text-sm"><span x-show="!discountCode">Mã giảm giá / Quà tặng</span><span x-show="discountCode" x-text="discountCode"></span></p>
                                    </div>
                                    <button @click="openDiscountModal()" class="bg-pink-600 text-white font-bold py-2 px-3 rounded-lg hover:bg-pink-700 transition-colors text-xs sm:text-sm flex-shrink-0">
                                        <span x-show="!appliedDiscountCode && !appliedGift">Chọn</span><span x-show="appliedDiscountCode || appliedGift">Thay đổi</span>
                                    </button>
                                </div>
                                <div x-show="appliedGift" class="text-gray-600 text-sm flex items-center space-x-2 mt-2">
                                    <span>🎁</span>
                                    <span>Quà tặng: <strong class="font-semibold text-blue-600" x-text="appliedGift?.title"></strong></span>
                                </div>
                            </div>

                            <!-- Order Summary -->
                            <div class="space-y-2 pt-4 border-t">
                                <div class="flex justify-between text-sm text-gray-600"><span>Tạm tính</span><span x-text="formatCurrency(cartSubtotal())"></span></div>
                                <div class="flex justify-between text-sm text-gray-600"><span>Phí vận chuyển</span><span x-text="formatCurrency(shippingFee())"></span></div>
                                <template x-if="tuiDauTamBonusDiscount > 0"><div class="flex justify-between text-green-600 font-medium text-sm"><span>Ưu đãi thêm (Túi dâu tằm)</span><span x-text="'-' + formatCurrency(tuiDauTamBonusDiscount)"></span></div></template>
                                <template x-if="shippingDiscount > 0"><div class="flex justify-between text-green-600 font-medium text-sm"><span>Ưu đãi Freeship</span><span x-text="'-' + formatCurrency(shippingDiscount)"></span></div></template>
                                <template x-if="discountAmount > 0"><div class="flex justify-between text-green-600 font-medium"><span>Giảm giá của shop</span><span x-text="'-' + formatCurrency(discountAmount)"></span></div></template>
                                <template x-if="addonDiscount > 0"><div class="flex justify-between text-green-600 font-medium text-sm"><span>Giảm giá (Móc chìa khóa)</span><span x-text="'-' + formatCurrency(addonDiscount)"></span></div></template>
                                <div class="flex justify-between font-bold text-base pt-2 border-t mt-2"><span>Tổng cộng</span><span class="text-pink-600" x-text="formatCurrency(cartTotal())"></span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer (Sticky) -->
                <div class="flex-shrink-0 p-4 border-t bg-gray-50 rounded-b-2xl">
                    <div x-show="cart.length > 0">
                        <!-- Error Message -->
                        <div x-show="miniCartError" class="bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-sm mb-3"><p x-text="miniCartError"></p></div>

                        <!-- Checkout Button -->
                        <button @click="isMiniCartOpen = false; isCheckoutModalOpen = true;" class="w-full bg-pink-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-pink-700 transition-colors text-base">
                            Thanh toán
                        </button>
                    </div>
                </div>
        </div>
    </div>

</body>



    <!-- Product Quick View Modal -->
    <div x-show="isQuickViewOpen" @keydown.escape.window="closeQuickView()"
         class="fixed inset-0 bg-gray-800 bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 z-[70]"
         style="display: none;"

         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
        <div @click.outside="closeQuickView()"
             class="bg-white rounded-2xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col transform transition-all"
             x-show="isQuickViewOpen"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-95"

             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95">

            <template x-if="quickViewProduct">
                <div class="overflow-y-auto">
                    <!-- Header with Image -->
                    <div class="relative">
                        <img :src="quickViewProduct.image" :alt="quickViewProduct.name" class="w-full aspect-square object-cover">
                        <button @click="closeQuickView()" class="absolute top-4 right-4 bg-white bg-opacity-90 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center shadow-lg hover:bg-opacity-100 transition-all">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                    </div>

                    <!-- Content -->
                    <div class="p-6">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2" x-text="quickViewProduct.name"></h2>

                        <div class="flex items-baseline space-x-2 mb-4">
                            <span class="text-3xl font-bold text-pink-600" x-text="formatCurrency(quickViewProduct.price)"></span>
                            <template x-if="quickViewProduct.original_price">
                                <s class="text-xl text-gray-500" x-text="formatCurrency(quickViewProduct.original_price)"></s>
                            </template>
                        </div>

                        <div class="bg-pink-50 border-l-4 border-pink-400 p-4 rounded-r-lg mb-6 space-y-2 text-sm text-gray-700">
                            <template x-for="benefit in sharedDetails.benefits" :key="benefit">
                                <p class="flex items-start"><span class="mr-2">✨</span><span x-text="benefit"></span></p>
                            </template>
                        </div>

                        <div class="space-y-3 mb-8">
                            <button @click="openItemOptionsModal(quickViewProduct)" class="w-full bg-pink-100 text-pink-700 h-12 rounded-lg hover:bg-pink-200 transition-colors duration-300 font-semibold text-lg flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path></svg>
                                Thêm vào giỏ
                            </button>
                            <button @click="buyNow(quickViewProduct)" class="w-full bg-pink-600 text-white h-12 rounded-lg hover:bg-pink-700 transition-colors duration-300 font-semibold text-lg">
                                Mua ngay
                            </button>
                        </div>

                        <div class="text-sm text-gray-600 space-y-3">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3 border-b pb-2">Cam kết từ An Nhiên</h3>
                            <p x-text="sharedDetails.full_description"></p>
                            <p><strong class="font-semibold text-gray-800">Chất liệu:</strong> <span x-text="sharedDetails.materials"></span></p>
                            <p><strong class="font-semibold text-gray-800">Xuất xứ:</strong> <span x-text="sharedDetails.origin"></span></p>
                        </div>
                    </div>

                </div>
            </template>
        </div>
    </div>


    <!-- Item Options Modal -->
    <div x-show="isItemOptionsModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" @click.away="closeItemOptionsModal()">
        <div x-show="isItemOptionsModalOpen" class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-auto" @click.stop x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform scale-90" x-transition:enter-end="opacity-100 transform scale-100"
             x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 transform scale-100"
             x-transition:leave-end="opacity-0 transform scale-90">

            <!-- Header -->
            <div class="flex items-center justify-between p-4 bg-pink-50 rounded-t-lg">
                <div class="flex items-center space-x-4">
                    <img :src="currentItemForOptions?.image" alt="Product Image" class="w-14 h-14 rounded-md object-cover shadow-sm border border-pink-100">
                    <div>
                        <h3 class="text-lg font-bold text-slate-800" x-text="currentItemForOptions?.name || 'Tùy chỉnh sản phẩm'"></h3>
                        <p class="text-pink-600 font-bold text-base" x-text="formatCurrency(currentItemForOptions?.price || 0)"></p>
                    </div>
                </div>
                <button @click="closeItemOptionsModal()" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center self-start">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>

            <!-- Body -->
            <div class="p-6 space-y-6">
                <!-- Quantity Selector -->
                <div>
                    <label class="block mb-2 text-sm font-medium text-gray-900">Số lượng</label>
                    <div class="flex items-center">
                        <button @click="itemOptions.quantity = Math.max(1, itemOptions.quantity - 1)" class="h-11 w-11 flex items-center justify-center text-xl bg-gray-100 rounded-l-lg hover:bg-gray-200 focus:outline-none">-</button>
                        <input type="text" x-model.number="itemOptions.quantity" class="w-16 h-11 text-center border-t border-b border-gray-200 focus:outline-none">
                        <button @click="itemOptions.quantity++" class="h-11 w-11 flex items-center justify-center text-xl bg-gray-100 rounded-r-lg hover:bg-gray-200 focus:outline-none">+</button>
                    </div>
                </div>

                <!-- Note/Weight Input -->
                <div>
                    <label for="itemNote" class="block mb-2 text-sm font-medium text-gray-900">Cân nặng của bé và ghi chú</label>
                    <textarea id="itemNote" x-model="itemOptions.note" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent focus:outline-none block w-full p-2.5" placeholder="Ví dụ: Bé 15kg, làm cẩn thận tỉ mỉ và giao hàng giờ hành chính..."></textarea>
                    <p class="mt-2 text-xs text-gray-500 flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5 text-blue-400 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                        </svg>
                        <span class="text-green-600 font-medium text-xs">Lưu ý càng đầy đủ chi tiết thì em sẽ làm vòng càng vừa vặn hơn ạ.</span>
                    </p>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex items-center p-6 space-x-2 border-t border-gray-200 rounded-b">
                <button @click="addItemWithOptions()" class="w-full text-white bg-pink-600 hover:bg-pink-700 focus:ring-4 focus:outline-none focus:ring-pink-300 font-bold rounded-lg text-base px-5 py-3 text-center">Thêm vào giỏ</button>
            </div>
        </div>
    </div>

</html>
